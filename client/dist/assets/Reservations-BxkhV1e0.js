import{u as B,a as E,_ as N}from"./top-u5QhyBZ6.js";import{B as T}from"./Breadcrumbs-Dge8vmtX.js";import{H as x,N as L}from"./Navigation-BVn4kgAI.js";import{R as P}from"./ReservationList-BuoVP4ot.js";import{S as k}from"./SPHeaderBar-Pd3aV6q5.js";import{a as H}from"./ReservationDetailDrawer-BEQU-4Ki.js";import{I as O,W as r,N as y,M as U,P as F,a5 as M,p as l,ay as g,$ as V}from"./SnackbarsStore-C4icXDBu.js";import"./logo-C44CNDXu.js";import"./ssrBoot-1Cb84yR7.js";import"./VersionStore-CJVA931X.js";import"./VSwitch-CqANnSqs.js";import"./VTextField-DHhKPbp8.js";import"./VAvatar-QCa-eAgf.js";import"./VChip-GSzvAc2g.js";import"./VSelect-CMGdv1lZ.js";import"./VPagination-CMp5rTwE.js";import"./VSlider-D8cxT9b2.js";import"./VDialog-CCdXSuz3.js";import"./VCard-DwyjBCI2.js";const $={class:"route-container"},C={class:"reservations-all-container-wrapper"},G={class:"reservations-all-container"},W=30*1e3,h=25,j=O({__name:"Reservations",setup(z){const a=B(),_=E(),c=r([]),p=r(0),s=r(1),n=r("asc"),u=r(!0),o=r([]),R=r(),i=r(null);async function q(){const e=await H.fetchReservations();e&&(o.value=e.reservations)}function v(){if(o.value.length===0){c.value=[],p.value=0;return}let e=[...o.value];n.value==="asc"?e.sort((d,f)=>new Date(d.program.start_time).getTime()-new Date(f.program.start_time).getTime()):e.sort((d,f)=>new Date(f.program.start_time).getTime()-new Date(d.program.start_time).getTime());const t=(s.value-1)*h,A=t+h;c.value=e.slice(t,A),p.value=e.length}async function I(e){s.value=e,await _.replace({query:{...a.query,page:e.toString()}})}async function w(e){n.value=e,s.value=1,await _.replace({query:{...a.query,order:e,page:"1"}})}function S(e){o.value=o.value.filter(t=>t.id!==e),v(),console.log(`Reservation ${e} deleted, refreshing list...`),m()}const m=async()=>{try{await q(),u.value=!1}catch(e){console.error("Failed to update reservation list:",e),u.value=!1}},b=()=>{i.value===null&&(m(),i.value=window.setInterval(m,W))},D=()=>{i.value!==null&&(clearInterval(i.value),i.value=null)};return y(()=>a.query,async e=>{if(e.page){const t=parseInt(String(e.page),10);Number.isFinite(t)&&t>0&&(s.value=t)}if(e.order){const t=String(e.order);(t==="asc"||t==="desc")&&(n.value=t)}v()},{deep:!0}),y(()=>o.value,()=>{v()},{deep:!0}),U(async()=>{a.query.page&&typeof a.query.page=="string"&&(s.value=parseInt(a.query.page,10)),a.query.order&&typeof a.query.order=="string"&&(n.value=a.query.order),b()}),F(()=>{D()}),(e,t)=>(V(),M("div",$,[l(x),g("main",null,[l(L),g("div",C,[l(k),g("div",G,[l(T,{crumbs:[{name:"ホーム",path:"/"},{name:"録画予約",path:"/reservations/"},{name:"録画予約一覧",path:"/reservations/all",disabled:!0}]}),l(P,{ref_key:"reservationList",ref:R,title:"録画予約一覧",reservations:c.value,total:p.value,page:s.value,"sort-order":n.value,"is-loading":u.value,"show-back-button":!0,"show-empty-message":!u.value,"onUpdate:page":I,"onUpdate:sortOrder":w,onDelete:S},null,8,["reservations","total","page","sort-order","is-loading","show-empty-message"])])])])]))}}),me=N(j,[["__scopeId","data-v-b7f46042"]]);export{me as default};
