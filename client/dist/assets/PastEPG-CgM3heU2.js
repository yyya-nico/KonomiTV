import{g as Z,p as ee,k as te,l as ne,n as ae,d as U,m as se,q as ie,s as re,t as oe,i as z,V as le,a as J,R as A,_ as K,u as ce}from"./top-mZzYfND4.js";import{B as ue}from"./Breadcrumbs-BOzn-dSQ.js";import{H as de,N as me}from"./Navigation-B9D3tTL9.js";import{W as S,al as P,ai as E,M as Q,N as x,p as c,az as H,D as F,I as X,a5 as h,a6 as T,ay as o,a4 as q,a2 as G,ax as M,ad as V,_ as W,a8 as b,F as L,a9 as C,ae as O,$ as f}from"./SnackbarsStore-BWrzfOQC.js";import{V as ve}from"./Videos-fhNRhef3.js";import"./logo-BGou-Ra-.js";import"./ssrBoot-DSfSYcIF.js";import"./VersionStore-CY9AnbST.js";const ge=ee({color:String,direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},side:{type:String,default:"end",validator:e=>["start","end","both"].includes(e)},mode:{type:String,default:"intersect",validator:e=>["intersect","manual"].includes(e)},margin:[Number,String],loadMoreText:{type:String,default:"$vuetify.infiniteScroll.loadMore"},emptyText:{type:String,default:"$vuetify.infiniteScroll.empty"},...ie(),...se()},"VInfiniteScroll"),j=re({name:"VInfiniteScrollIntersect",props:{side:{type:String,required:!0},rootMargin:String},emits:{intersect:(e,l)=>!0},setup(e,l){let{emit:u}=l;const{intersectionRef:m,isIntersecting:s}=oe();return x(s,async p=>{u("intersect",e.side,p)}),U(()=>c("div",{class:"v-infinite-scroll-intersect",style:{"--v-infinite-margin-size":e.rootMargin},ref:m},[H(" ")])),{}}}),fe=Z()({name:"VInfiniteScroll",props:ge(),emits:{load:e=>!0},setup(e,l){let{slots:u,emit:m}=l;const s=S(),p=P("ok"),y=P("ok"),v=E(()=>te(e.margin)),w=P(!1);function n(a){if(!s.value)return;const d=e.direction==="vertical"?"scrollTop":"scrollLeft";s.value[d]=a}function r(){if(!s.value)return 0;const a=e.direction==="vertical"?"scrollTop":"scrollLeft";return s.value[a]}function _(){if(!s.value)return 0;const a=e.direction==="vertical"?"scrollHeight":"scrollWidth";return s.value[a]}function i(){if(!s.value)return 0;const a=e.direction==="vertical"?"clientHeight":"clientWidth";return s.value[a]}Q(()=>{s.value&&(e.side==="start"?n(_()):e.side==="both"&&n(_()/2-i()/2))});function t(a,d){a==="start"?p.value=d:a==="end"&&(y.value=d)}function I(a){return a==="start"?p.value:y.value}let $=0;function D(a,d){w.value=d,w.value&&B(a)}function B(a){if(e.mode!=="manual"&&!w.value)return;const d=I(a);if(!s.value||["empty","loading"].includes(d))return;$=_(),t(a,"loading");function k(g){t(a,g),F(()=>{g==="empty"||g==="error"||(g==="ok"&&a==="start"&&n(_()-$+r()),e.mode!=="manual"&&F(()=>{window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{B(a)})})})}))})}m("load",{side:a,done:k})}const{t:R}=ne();function N(a,d){if(e.side!==a&&e.side!=="both")return;const k=()=>B(a),g={side:a,props:{onClick:k,color:e.color}};return d==="error"?u.error?.(g):d==="empty"?u.empty?.(g)??c("div",null,[R(e.emptyText)]):e.mode==="manual"?d==="loading"?u.loading?.(g)??c(z,{indeterminate:!0,color:e.color},null):u["load-more"]?.(g)??c(le,{variant:"outlined",color:e.color,onClick:k},{default:()=>[R(e.loadMoreText)]}):u.loading?.(g)??c(z,{indeterminate:!0,color:e.color},null)}const{dimensionStyles:Y}=ae(e);U(()=>{const a=e.tag,d=e.side==="start"||e.side==="both",k=e.side==="end"||e.side==="both",g=e.mode==="intersect";return c(a,{ref:s,class:["v-infinite-scroll",`v-infinite-scroll--${e.direction}`,{"v-infinite-scroll--start":d,"v-infinite-scroll--end":k}],style:Y.value},{default:()=>[c("div",{class:"v-infinite-scroll__side"},[N("start",p.value)]),d&&g&&c(j,{key:"start",side:"start",onIntersect:D,rootMargin:v.value},null),u.default?.(),k&&g&&c(j,{key:"end",side:"end",onIntersect:D,rootMargin:v.value},null),c("div",{class:"v-infinite-scroll__side"},[N("end",y.value)])]})})}}),pe={class:"past-epg-viewer"},_e={key:0,class:"past-epg-viewer__header"},he={class:"past-epg-viewer__title"},ye={class:"past-epg-viewer__title-text"},we={class:"past-epg-viewer__empty-content"},Se=["innerHTML"],ke=["innerHTML"],Me={class:"past-epg-viewer__grid-content"},Ie={id:"channels"},Te={id:"times"},xe={class:"program-title"},Be={class:"program-start-time"},Pe={class:"program-description"},Ve=X({__name:"PastEPGViewer",props:{title:{},programs:{},total:{},updatePage:{},page:{default:1},hideHeader:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:warning-20-regular"},emptyMessage:{default:"録画番組が見つかりませんでした。"},emptySubMessage:{default:'サーバー設定で録画フォルダのパスを<br class="d-sm-none">正しく設定できているか確認してください。'},isLoading:{type:Boolean,default:!1}},setup(e){J();const l=e,u=S(l.page),m=S([...l.programs]),s=S(l.total);x(()=>l.page,n=>{u.value=n}),x(()=>l.programs,n=>{m.value=[...n]}),x(()=>l.total,n=>{s.value=n});const p=E(()=>[...new Set(m.value.toSorted((n,r)=>n.channel&&r.channel?n.channel.display_channel_id.localeCompare(r.channel.display_channel_id):0).map(n=>n.channel?.name))]),y=E(()=>{if(m.value.length===0)return[];const n=m.value.map(i=>new Date(i.start_time)).reduce((i,t)=>i<t?i:t),r=m.value.map(i=>new Date(i.end_time)).reduce((i,t)=>i>t?i:t),_=[];for(let i=new Date(n.setMinutes(0,0,0));i<=r;i.setHours(i.getHours()+1))_.push(new Date(i));return _}),v=n=>{switch(n.genres[0]?.major){case"スポーツ":return"genre_sports";case"ドラマ":return"genre_drama";case"音楽":return"genre_music";case"映画":return"genre_movie";case"アニメ・特撮":return"genre_anime";default:return"genre_none"}},w=async({done:n})=>{if(u.value>=Math.ceil(s.value/90)){n("empty");return}await l.updatePage(u.value+1),n("ok")};return(n,r)=>{const _=G("Icon"),i=G("router-link");return f(),h("div",pe,[e.hideHeader?T("",!0):(f(),h("div",_e,[o("h2",he,[e.showBackButton?q((f(),h("div",{key:0,class:"past-epg-viewer__title-back",onClick:r[0]||(r[0]=t=>n.$router.back())},[c(_,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[A]]):T("",!0),o("span",ye,M(e.title),1)])])),o("div",{class:V(["past-epg-viewer__grid",{"past-epg-viewer__grid--loading":e.isLoading,"past-epg-viewer__grid--empty":s.value===0&&e.showEmptyMessage}])},[o("div",{class:V(["past-epg-viewer__empty",{"past-epg-viewer__empty--show":s.value===0&&e.showEmptyMessage}])},[o("div",we,[c(_,{class:"past-epg-viewer__empty-icon",icon:e.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),o("h2",{innerHTML:e.emptyMessage},null,8,Se),e.emptySubMessage?(f(),h("div",{key:0,class:"past-epg-viewer__empty-submessage",innerHTML:e.emptySubMessage},null,8,ke)):T("",!0)])],2),o("div",Me,[e.isLoading?T("",!0):(f(),W(fe,{key:0,id:"epg-container",side:"start",onLoad:w},{empty:b(()=>[...r[1]||(r[1]=[H("すべて読み込みました",-1)])]),default:b(()=>[o("div",Ie,[r[2]||(r[2]=o("div",{class:"dummy"},null,-1)),(f(!0),h(L,null,C(p.value,t=>(f(),h("div",{key:t,class:"channel-name"},M(t),1))),128))]),o("div",Te,[(f(!0),h(L,null,C(y.value,(t,I)=>(f(),h("div",{key:I,class:"time-label"},M(t.getHours()===0||I===0?t.toLocaleString([],{month:"numeric",day:"numeric",weekday:"short",hour:"numeric"}):t.toLocaleTimeString([],{hour:"numeric"})),1))),128))]),o("div",{id:"schedule",style:O({"--minute-sum":60*y.value.length})},[(f(!0),h(L,null,C(m.value,t=>q((f(),W(i,{class:V(["program",["program",v(t)]]),key:t.id,title:t.title,style:O({gridColumn:p.value.indexOf(t.channel?.name)+1,gridRowStart:Math.floor((new Date(t.start_time).getTime()-new Date(y.value[0]).getTime())/(60*1e3))+1,gridRowEnd:`span ${Math.ceil(t.duration/60)}`}),to:t.recorded_video.status==="Recording"||!t.recorded_video.has_key_frames?{path:""}:`/videos/watch/${t.id}`},{default:b(()=>[o("div",xe,[o("div",Be,M(new Date(t.start_time).getMinutes().toString().padStart(2,"0")),1),H(" "+M(t.title),1)]),o("div",Pe,M(t.description),1)]),_:2},1032,["title","class","style","to"])),[[A]])),128))],4)]),_:1}))])],2)])}}}),be=K(Ve,[["__scopeId","data-v-75c39cfa"]]),Le={class:"route-container"},Ce={class:"pastepg-container-wrapper"},Ee={class:"pastepg-container"},He=X({__name:"PastEPG",setup(e){ce(),J();const l=S([]),u=S(0),m=S(!0),s=S(1),p=async()=>{let v=[];const w=s.value;for(let n=(w-1)*3+1;n<=w*3;n++){const r=await ve.fetchVideos("desc",n);r&&(v=[...v,...r.recorded_programs],u.value=r.total)}v=v.reverse(),l.value=[...v,...l.value],m.value=!1},y=async v=>{s.value=v,await p()};return Q(async()=>{await p()}),(v,w)=>(f(),h("div",Le,[c(de),o("main",null,[c(me),o("div",Ce,[o("div",Ee,[c(ue,{crumbs:[{name:"ホーム",path:"/"},{name:"過去番組表",path:"/pastepg/",disabled:!0}]}),c(be,{title:"過去番組表",programs:l.value,total:u.value,page:s.value,isLoading:m.value,showBackButton:!0,showEmptyMessage:!m.value,updatePage:y},null,8,["programs","total","page","isLoading","showEmptyMessage"])])])])]))}}),Ge=K(He,[["__scopeId","data-v-ad38e667"]]);export{Ge as default};
