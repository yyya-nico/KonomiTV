import{ai as T,p as a,ab as Q,aW as y,I as N,aA as te,W as $,N as U,a4 as G,a5 as u,ad as P,ay as e,ax as g,G as R,aN as I,a8 as D,az as x,a2 as j,aD as M,a6 as V,aL as F,$ as d,F as z,a9 as W,m as J,M as re,aO as se,_ as A}from"./SnackbarsStore-D2723teg.js";import{V as ee}from"./VSwitch-DtHkgpW-.js";import{c as ae}from"./VChip-CCklXAW-.js";import{g as ie,p as ne,f as oe,e as le,d as de,o as ce,h as ue,R as O,_ as q,V as H}from"./top-Ra0pbfKg.js";import{u as ve}from"./VersionStore-Vd_xoAev.js";import{V as ge}from"./VSlider-BbPoAWGa.js";import{u as me,m as _e,b as X,a as L}from"./VTextField-B6HwneY5.js";import{m as pe,e as Y,d as K}from"./VSelect-Ci4G1wYq.js";import{V as fe}from"./VDialog-Bp2QFNGD.js";import{a as he,V as be,b as ye,c as we}from"./VCard-D_Ycheih.js";import{V as ke}from"./ssrBoot-9bFU7tTc.js";import{V as Ve}from"./VPagination-Da-TfPkq.js";const $e=ne({..._e(),...ce(pe(),["inline"])},"VCheckbox"),xe=ie()({name:"VCheckbox",inheritAttrs:!1,props:$e(),emits:{"update:modelValue":t=>!0,"update:focused":t=>!0},setup(t,m){let{attrs:i,slots:w}=m;const n=oe(t,"modelValue"),{isFocused:s,focus:_,blur:f}=me(t),h=le(),C=T(()=>t.id||`checkbox-${h}`);return de(()=>{const[E,B]=ue(i),S=X.filterProps(t),o=Y.filterProps(t);return a(X,Q({class:["v-checkbox",t.class]},E,S,{modelValue:n.value,"onUpdate:modelValue":l=>n.value=l,id:C.value,focused:s.value,style:t.style}),{...w,default:l=>{let{id:v,messagesId:b,isDisabled:p,isReadonly:r,isValid:k}=l;return a(Y,Q(o,{id:v.value,"aria-describedby":b.value,disabled:p.value,readonly:r.value},B,{error:k.value===!1,modelValue:n.value,"onUpdate:modelValue":c=>n.value=c,onFocus:_,onBlur:f}),w)}})}),{}}});class Z{static async fetchReservations(){const m=await y.get("/recording/reservations");return m.type==="error"?(y.showGenericError(m,"録画予約一覧を取得できませんでした。"),null):m.data}static async fetchReservation(m){const i=await y.get(`/recording/reservations/${m}`);return i.type==="error"?(y.showGenericError(i,"録画予約情報を取得できませんでした。"),null):i.data}static async addReservation(m,i){const w={program_id:m,record_settings:i},n=await y.post("/recording/reservations",w);if(n.type==="error"){switch(n.data.detail){case"This API is only available when the backend is EDCB":y.showGenericError(n,"この機能は EDCB バックエンド利用時のみ使用できます。");break;case"Specified program was not found":y.showGenericError(n,"指定された番組が見つかりませんでした。");break;case"Specified channel was not found":y.showGenericError(n,"指定されたチャンネルが見つかりませんでした。");break;case"The same program_id is already reserved":y.showGenericError(n,"この番組は既に録画予約されています。");break;case"Failed to add a recording reservation":y.showGenericError(n,"録画予約の追加に失敗しました。");break;default:y.showGenericError(n,"録画予約の追加に失敗しました。");break}return!1}return!0}static async updateReservation(m,i){const w={record_settings:i},n=await y.put(`/recording/reservations/${m}`,w);if(n.type==="error"){switch(n.data.detail){case"This API is only available when the backend is EDCB":y.showGenericError(n,"この機能は EDCB バックエンド利用時のみ使用できます。");break;case"Specified reservation_id was not found":y.showGenericError(n,"指定された録画予約が見つかりませんでした。");break;case"Failed to update the specified recording reservation":y.showGenericError(n,"録画予約の更新に失敗しました。");break;default:y.showGenericError(n,"録画予約の更新に失敗しました。");break}return null}return n.data}static async deleteReservation(m){const i=await y.delete(`/recording/reservations/${m}`);if(i.type==="error"){switch(i.data.detail){case"This API is only available when the backend is EDCB":y.showGenericError(i,"この機能は EDCB バックエンド利用時のみ使用できます。");break;case"Specified reservation_id was not found":y.showGenericError(i,"指定された録画予約が見つかりませんでした。");break;case"Failed to delete the specified recording reservation":y.showGenericError(i,"録画予約の削除に失敗しました。");break;default:y.showGenericError(i,`録画予約 (ID: ${m}) の削除に失敗しました。`);break}return!1}return!0}}const Ce={class:"reservation__container"},Ee={class:"reservation__controls"},Re={class:"reservation__priority"},Se={class:"reservation__priority-badge"},De={class:"reservation__toggle-label"},Be={key:1,class:"reservation__recording"},Ue={class:"reservation__content"},Pe={class:"reservation__content-header"},Ie=["innerHTML"],Me={class:"reservation__content-status"},Te={class:"reservation__content-meta"},Le={class:"reservation__content-meta-broadcaster"},Fe=["src"],Ae={class:"reservation__content-meta-broadcaster-name"},He={class:"reservation__content-meta-time"},Ge={class:"reservation__content-meta-size-comment"},Oe={key:0,class:"reservation__content-meta-comment"},ze={class:"reservation__content-meta-comment-text"},Ne={class:"reservation__content-meta-size"},je={class:"reservation__content-meta-time-pc"},qe={class:"reservation__content-description-container"},Je=["innerHTML"],Ke={class:"reservation__content-description-size-pc"},We=N({__name:"Reservation",props:{reservation:{}},emits:["deleted","click"],setup(t,{emit:m}){const i=t,w=m;te();const n=$(i.reservation.record_settings.is_enabled),s=$(!1);U(()=>i.reservation.record_settings.is_enabled,o=>{n.value=o});const _=o=>{const l=o.target;l.src=`${M.getApiBaseUrl()}/channels/gr001/logo`},f=o=>{if(o.is_recording_in_progress)return"録画中";switch(o.recording_availability){case"Full":return"録画可能";case"Partial":return"一部のみ録画可能";case"Unavailable":return"チューナー不足";default:return"不明"}},h=o=>{if(o.is_recording_in_progress)return"fluent:record-16-filled";switch(o.recording_availability){case"Full":return"fluent:checkmark-16-filled";case"Partial":return"fluent:warning-16-filled";case"Unavailable":return"fluent:dismiss-circle-16-filled";default:return"fluent:question-circle-16-filled"}},C=o=>{if(o.is_recording_in_progress)return"primary";switch(o.recording_availability){case"Full":return"success";case"Partial":return"warning";case"Unavailable":return"error";default:return"grey"}},E=()=>{w("click",i.reservation)},B=async()=>{if(!s.value){s.value=!0;try{const o={...i.reservation.record_settings,is_enabled:n.value};if(await Z.updateReservation(i.reservation.id,o)){const v=n.value?`録画予約を有効にしました。
番組開始時刻になると自動的に録画が開始されます。`:`録画予約を無効にしました。
番組開始時刻までに再度予約を有効にしない限り、この番組は録画されません。`;F.success(v)}else n.value=i.reservation.record_settings.is_enabled}catch(o){console.error("Failed to update reservation:",o),n.value=i.reservation.record_settings.is_enabled}finally{s.value=!1}}},S=o=>{o.stopPropagation()};return(o,l)=>{const v=j("Icon");return G((d(),u("div",{class:P(["reservation",{"reservation--disabled":!n.value}]),onClick:E},[e("div",Ce,[e("div",Ee,[e("div",Re,[e("div",Se,g(t.reservation.record_settings.priority),1),l[1]||(l[1]=e("div",{class:"reservation__priority-label"},"優先度",-1))]),t.reservation.is_recording_in_progress?(d(),u("div",Be,[...l[2]||(l[2]=[e("div",{class:"reservation__recording-icon"},null,-1)])])):(d(),u("div",{key:0,class:"reservation__toggle",onClick:S},[a(ee,{modelValue:n.value,"onUpdate:modelValue":[l[0]||(l[0]=b=>n.value=b),B],color:"primary",density:"compact","hide-details":"",onClick:S},null,8,["modelValue"]),e("div",De,g(n.value?"有効":"無効"),1)]))]),e("div",Ue,[e("div",Pe,[e("div",{class:"reservation__content-title",innerHTML:R(I).decorateProgramInfo(t.reservation.program,"title")},null,8,Ie),e("div",Me,[a(ae,{color:C(t.reservation),size:"small",variant:"tonal"},{default:D(()=>[a(v,{icon:h(t.reservation),width:"12px",height:"12px",class:"mr-1"},null,8,["icon"]),x(" "+g(f(t.reservation)),1)]),_:1},8,["color"])])]),e("div",Te,[e("div",Le,[e("img",{class:"reservation__content-meta-broadcaster-icon",loading:"lazy",decoding:"async",src:`${R(M).getApiBaseUrl()}/channels/${t.reservation.channel.id}/logo`,onError:_},null,40,Fe),e("span",Ae,"Ch: "+g(t.reservation.channel.channel_number)+" "+g(t.reservation.channel.name),1)]),e("div",He,g(R(I).getProgramTime(t.reservation.program)),1),e("div",Ge,[t.reservation.comment?(d(),u("div",Oe,[a(v,{icon:"fluent:note-20-filled",width:"14px",height:"14px",class:"reservation__content-meta-comment-icon"}),e("span",ze,g(t.reservation.comment),1)])):V("",!0),e("div",Ne,[a(v,{icon:"fluent:hard-drive-20-filled",width:"14px",height:"14px",class:"reservation__content-meta-size-icon"}),x(" 約 "+g(R(M).formatBytes(t.reservation.estimated_recording_file_size,1,!0)),1)])]),e("div",je,g(R(I).getProgramTime(t.reservation.program)),1)]),e("div",qe,[e("div",{class:"reservation__content-description",innerHTML:R(I).decorateProgramInfo(t.reservation.program,"description")},null,8,Je),e("div",Ke,[a(v,{icon:"fluent:hard-drive-20-filled",width:"14px",height:"14px",class:"reservation__content-description-size-icon"}),x(" 約 "+g(R(M).formatBytes(t.reservation.estimated_recording_file_size,1,!0)),1)])])])])],2)),[[O]])}}}),Ze=q(We,[["__scopeId","data-v-a399b3b7"]]),Qe=N({name:"ReservationProgramInfo",props:{reservation:{type:Object,required:!0}},data(){return{Utils:Object.freeze(M),ProgramUtils:Object.freeze(I)}},methods:{onLogoError(t){const m=t.target;m.src=`${M.getApiBaseUrl()}/channels/gr001/logo`}}}),Xe={class:"program-container"},Ye={class:"program-info"},et=["innerHTML"],tt={class:"program-info__broadcaster"},rt=["src"],st={class:"program-info__broadcaster-container"},at={class:"d-flex align-center"},it={class:"program-info__broadcaster-number"},nt={class:"program-info__broadcaster-name"},ot={class:"program-info__broadcaster-time"},lt=["innerHTML"],dt={class:"program-info__genre-container"},ct={class:"mt-5"},ut={class:"program-info__status"},vt={class:"ml-2"},gt={class:"program-info__status"},mt={class:"ml-2"},_t={key:0,class:"program-info__status"},pt={class:"ml-2"},ft={class:"program-detail-container"},ht={class:"program-detail__heading"},bt=["innerHTML"];function yt(t,m,i,w,n,s){const _=j("Icon");return d(),u("div",Xe,[e("section",Ye,[e("h1",{class:"program-info__title",innerHTML:t.ProgramUtils.decorateProgramInfo(t.reservation.program,"title")},null,8,et),e("div",tt,[e("img",{class:"program-info__broadcaster-icon",src:`${t.Utils.getApiBaseUrl()}/channels/${t.reservation.channel.id}/logo`,onError:m[0]||(m[0]=(...f)=>t.onLogoError&&t.onLogoError(...f))},null,40,rt),e("div",st,[e("div",at,[e("div",it,"Ch: "+g(t.reservation.channel.channel_number),1),e("div",nt,g(t.reservation.channel.name),1)]),e("div",ot,g(t.ProgramUtils.getProgramTime(t.reservation.program)),1)])]),e("div",{class:"program-info__description",innerHTML:t.ProgramUtils.decorateProgramInfo(t.reservation.program,"description")},null,8,lt),e("div",dt,[(d(!0),u(z,null,W(t.reservation.program.genres??[],(f,h)=>(d(),u("div",{class:"program-info__genre",key:h},g(f.major)+" / "+g(f.middle),1))),128))]),e("div",ct,[e("div",ut,[a(_,{icon:"fluent:video-16-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",vt,"映像: "+g(t.reservation.program.video_codec)+" / "+g(t.reservation.program.video_resolution),1)]),e("div",gt,[a(_,{icon:"fluent:headphones-sound-wave-20-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",mt,"主音声: "+g(t.reservation.program.primary_audio_type)+" "+g(t.reservation.program.primary_audio_sampling_rate||"Unknown")+" / "+g(t.reservation.program.primary_audio_language),1)]),t.reservation.program.secondary_audio_type?(d(),u("div",_t,[a(_,{icon:"fluent:headphones-sound-wave-20-filled",height:"17px",style:{"margin-left":"-2px","margin-right":"-1.7px","margin-bottom":"-3px"}}),e("span",pt,"副音声: "+g(t.reservation.program.secondary_audio_type)+" "+g(t.reservation.program.secondary_audio_sampling_rate||"Unknown")+" / "+g(t.reservation.program.secondary_audio_language),1)])):V("",!0)])]),e("section",ft,[(d(!0),u(z,null,W(t.reservation.program.detail??{},(f,h)=>(d(),u("div",{class:"program-detail",key:h},[e("h2",ht,g(h),1),e("div",{class:"program-detail__text",innerHTML:t.Utils.URLtoLink(f)},null,8,bt)]))),128))])])}const wt=q(Qe,[["render",yt],["__scopeId","data-v-78f9b8b8"]]),kt={class:"reservation-recording-settings"},Vt={key:0,class:"recording-warning-banner"},$t={class:"reservation-recording-settings__section"},xt={class:"reservation-recording-settings__header"},Ct={class:"reservation-recording-settings__section"},Et={class:"reservation-recording-settings__slider"},Rt={class:"reservation-recording-settings__section"},St={class:"reservation-recording-settings__section"},Dt={class:"reservation-recording-settings__section"},Bt={class:"reservation-recording-settings__margin-default"},Ut={class:"reservation-recording-settings__margin-controls"},Pt={class:"reservation-recording-settings__section"},It={class:"reservation-recording-settings__section"},Mt={class:"reservation-recording-settings__section"},Tt={class:"reservation-recording-settings__section"},Lt={class:"reservation-recording-settings__description"},Ft=N({__name:"ReservationRecordingSettings",props:{reservation:{},hasChanges:{type:Boolean}},emits:["updateSettings","changesDetected"],setup(t,{emit:m}){const i=t,w=m,n=ve(),s=$(structuredClone(J(i.reservation.record_settings))),_=$(structuredClone(J(i.reservation.record_settings))),f=T({get:()=>s.value.recording_folders.length>0?s.value.recording_folders[0].recording_folder_path:"",set:p=>{C(p,h.value)}}),h=T({get:()=>s.value.recording_folders.length>0&&s.value.recording_folders[0].recording_file_name_template||"",set:p=>{C(f.value,p)}}),C=(p,r)=>{const k=p.trim()!=="",c=r.trim()!=="";!k&&!c?s.value.recording_folders=[]:(s.value.recording_folders.length===0&&s.value.recording_folders.push({recording_folder_path:"",recording_file_name_template:null,is_oneseg_separate_recording_folder:!1}),s.value.recording_folders[0].recording_folder_path=p,s.value.recording_folders[0].recording_file_name_template=r||null)},E=$(s.value.recording_start_margin===null&&s.value.recording_end_margin===null),B=[{title:"デフォルト設定を使う",value:"Default"},{title:"録画する",value:"Enable"},{title:"録画しない",value:"Disable"}],S=[{title:"デフォルト設定を使う",value:"Default"},{title:"録画する",value:"Enable"},{title:"録画しない",value:"Disable"}],o=[{title:"デフォルト設定を使う",value:"Default"},{title:"何もしない",value:"Nothing"},{title:"スタンバイ",value:"Standby"},{title:"スタンバイ(復帰後再起動)",value:"StandbyAndReboot"},{title:"サスペンド",value:"Suspend"},{title:"サスペンド(復帰後再起動)",value:"SuspendAndReboot"},{title:"シャットダウン",value:"Shutdown"}],l=T(()=>JSON.stringify(s.value)!==JSON.stringify(_.value));U(l,p=>{w("changesDetected",p)});const v=()=>{w("updateSettings",s.value)},b=()=>{E.value?(s.value.recording_start_margin=null,s.value.recording_end_margin=null):(s.value.recording_start_margin=10,s.value.recording_end_margin=5),v()};return U(()=>i.reservation,p=>{s.value=structuredClone(J(p.record_settings)),_.value=structuredClone(J(p.record_settings))},{deep:!0}),re(async()=>{await n.fetchServerVersion()}),(p,r)=>{const k=j("Icon");return d(),u("div",kt,[t.reservation.is_recording_in_progress?(d(),u("div",Vt,[a(k,{icon:"fluent:warning-16-filled",class:"recording-warning-banner__icon"}),r[11]||(r[11]=e("span",{class:"recording-warning-banner__text"}," 録画中の録画設定の変更はできません。 ",-1))])):V("",!0),e("div",$t,[e("div",xt,[r[12]||(r[12]=e("div",{class:"reservation-recording-settings__label"},"録画予約の有効/無効",-1)),a(ee,{disabled:t.reservation.is_recording_in_progress,style:{height:"0","margin-top":"-40px","margin-right":"6px"},modelValue:s.value.is_enabled,"onUpdate:modelValue":[r[0]||(r[0]=c=>s.value.is_enabled=c),v],color:"primary",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),r[13]||(r[13]=e("div",{class:"reservation-recording-settings__description mb-0"},[x(" 予約が無効なときは、この番組の録画動作を行いません。"),e("br"),x(" キーワード自動予約条件により不必要な番組が予約されてしまっているときは、予約を無効にしてみてください。(予約削除ではすぐ再追加されてしまい意味がありません。) ")],-1))]),e("div",Ct,[r[14]||(r[14]=e("div",{class:"reservation-recording-settings__label"},"録画予約の優先度",-1)),r[15]||(r[15]=e("div",{class:"reservation-recording-settings__description mb-0"}," 放送時間が重なりチューナーが足りないときは、より優先度が高い予約から優先的に録画します。 ",-1)),e("div",Et,[a(ge,{disabled:t.reservation.is_recording_in_progress,modelValue:s.value.priority,"onUpdate:modelValue":[r[1]||(r[1]=c=>s.value.priority=c),v],min:1,max:5,step:1,color:"primary",density:"compact","show-ticks":"always","thumb-label":"","hide-details":""},null,8,["disabled","modelValue"])])]),e("div",Rt,[r[16]||(r[16]=e("div",{class:"reservation-recording-settings__label"},"録画フォルダのパス",-1)),r[17]||(r[17]=e("div",{class:"reservation-recording-settings__description"}," 空欄にすると、デフォルトの録画フォルダに保存されます。 ",-1)),a(L,{disabled:t.reservation.is_recording_in_progress,modelValue:f.value,"onUpdate:modelValue":[r[2]||(r[2]=c=>f.value=c),v],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:R(n).is_linux_environment?"/mnt/hdd/Records/2025年春アニメ":"E:\\Records\\2025年春アニメ"},null,8,["disabled","modelValue","placeholder"])]),e("div",St,[r[18]||(r[18]=se('<div class="reservation-recording-settings__label" data-v-de631340>録画ファイル名テンプレート (マクロ)</div><div class="reservation-recording-settings__description" data-v-de631340> 空欄にすると、デフォルトの録画ファイル名テンプレート (マクロ) が録画ファイル名の変更に利用されます。<br data-v-de631340><div class="mt-1" data-v-de631340><a class="link" href="https://github.com/xtne6f/EDCB/blob/work-plus-s/Document/Readme_EpgTimer.txt#L929-L1008" target="_blank" data-v-de631340>テンプレート構文の一覧</a> / <a class="link" href="https://github.com/xtne6f/EDCB/blob/work-plus-s/Document/Readme_Mod.txt#%E3%83%9E%E3%82%AF%E3%83%AD" target="_blank" data-v-de631340>xtne6f 版での追加差分</a></div></div>',2)),a(L,{disabled:t.reservation.is_recording_in_progress,modelValue:h.value,"onUpdate:modelValue":[r[3]||(r[3]=c=>h.value=c),v],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:"$ZtoH(Title)$.ts"},null,8,["disabled","modelValue"])]),e("div",Dt,[r[20]||(r[20]=e("div",{class:"reservation-recording-settings__label"},"録画マージン (秒)",-1)),r[21]||(r[21]=e("div",{class:"reservation-recording-settings__description"}," 番組開始時刻の何秒前から録画を開始し、番組終了時刻の何秒後に録画を終了するかの設定です。最低でも5秒以上をおすすめします。(0秒だと番組の冒頭/末尾が欠けてしまいます。) ",-1)),e("div",Bt,[a(xe,{disabled:t.reservation.is_recording_in_progress,id:"use-default-margin",modelValue:E.value,"onUpdate:modelValue":[r[4]||(r[4]=c=>E.value=c),b],color:"primary",density:"compact","hide-details":""},null,8,["disabled","modelValue"]),r[19]||(r[19]=e("label",{class:"reservation-recording-settings__margin-default-text",for:"use-default-margin",style:{"user-select":"none"}}," デフォルト設定を使う ",-1))]),e("div",Ut,[a(L,{disabled:t.reservation.is_recording_in_progress||E.value,modelValue:s.value.recording_start_margin,"onUpdate:modelValue":[r[5]||(r[5]=c=>s.value.recording_start_margin=c),v],modelModifiers:{number:!0},color:"primary",variant:"outlined",density:"compact",type:"number","hide-details":"",prefix:"番組開始",suffix:"秒前",style:{width:"160px"}},null,8,["disabled","modelValue"]),a(L,{disabled:t.reservation.is_recording_in_progress||E.value,modelValue:s.value.recording_end_margin,"onUpdate:modelValue":[r[6]||(r[6]=c=>s.value.recording_end_margin=c),v],modelModifiers:{number:!0},color:"primary",variant:"outlined",density:"compact",type:"number","hide-details":"",prefix:"番組終了",suffix:"秒後",style:{width:"166px"}},null,8,["disabled","modelValue"])])]),e("div",Pt,[r[22]||(r[22]=e("div",{class:"reservation-recording-settings__label"},"字幕データ録画設定",-1)),r[23]||(r[23]=e("div",{class:"reservation-recording-settings__description"},[x(" 字幕データはほとんど録画容量を消費しません。"),e("br"),x(" [録画する] に設定しておくことを強くおすすめします。 ")],-1)),a(K,{disabled:t.reservation.is_recording_in_progress,modelValue:s.value.caption_recording_mode,"onUpdate:modelValue":[r[7]||(r[7]=c=>s.value.caption_recording_mode=c),v],items:B,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),e("div",It,[r[24]||(r[24]=e("div",{class:"reservation-recording-settings__label"},"データ放送録画設定",-1)),r[25]||(r[25]=e("div",{class:"reservation-recording-settings__description"},[x(" データ放送は30分で 500MB 以上録画容量を消費する上、KonomiTV は録画再生時のデータ放送表示に非対応です。"),e("br"),x(" [録画しない] に設定しておくことを強くおすすめします。 ")],-1)),a(K,{disabled:t.reservation.is_recording_in_progress,modelValue:s.value.data_broadcasting_recording_mode,"onUpdate:modelValue":[r[8]||(r[8]=c=>s.value.data_broadcasting_recording_mode=c),v],items:S,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),e("div",Mt,[r[26]||(r[26]=e("div",{class:"reservation-recording-settings__label"},"録画後動作設定",-1)),r[27]||(r[27]=e("div",{class:"reservation-recording-settings__description"}," 通常は [何もしない] のままで大丈夫です。録画後に録画 PC をスリープさせておきたい方のみ設定してください。環境によっては復帰できず以降の録画に失敗することがあります。 ",-1)),a(K,{disabled:t.reservation.is_recording_in_progress,modelValue:s.value.post_recording_mode,"onUpdate:modelValue":[r[9]||(r[9]=c=>s.value.post_recording_mode=c),v],items:o,color:"primary",variant:"outlined",density:"compact","hide-details":""},null,8,["disabled","modelValue"])]),e("div",Tt,[r[28]||(r[28]=e("div",{class:"reservation-recording-settings__label"},"録画後実行スクリプトのパス",-1)),e("div",Lt," 通常は空欄のままで大丈夫です。録画後に指定の "+g(R(n).is_linux_environment?".sh / .lua":".bat / .ps1 / .lua")+" スクリプトを実行させたい方のみ設定してください。 ",1),a(L,{disabled:t.reservation.is_recording_in_progress,modelValue:s.value.post_recording_bat_file_path,"onUpdate:modelValue":[r[10]||(r[10]=c=>s.value.post_recording_bat_file_path=c),v],color:"primary",variant:"outlined",density:"compact","hide-details":"",placeholder:R(n).is_linux_environment?"/var/local/edcb/transcode.sh":"C:\\DTV\\EDCB\\Transcode.bat"},null,8,["disabled","modelValue","placeholder"])])])}}}),At=q(Ft,[["__scopeId","data-v-de631340"]]),Ht={class:"reservation-detail-drawer__header"},Gt={class:"reservation-detail-drawer__tabs"},Ot={class:"reservation-detail-drawer__content"},zt={key:0,class:"reservation-detail-drawer__info"},Nt={key:1,class:"reservation-detail-drawer__settings"},jt={class:"reservation-detail-drawer__footer"},qt={class:"reservation-detail-drawer__actions"},Jt={key:0,class:"mb-4"},Kt=["innerHTML"],Wt={class:"text-body-2 text-text-darken-1"},Zt={key:1,class:"warning-banner warning-banner--recording"},Qt={key:2,class:"warning-banner warning-banner--normal"},Xt={key:3,class:"warning-banner warning-banner--keyword mt-3"},Yt=N({__name:"ReservationDetailDrawer",props:{reservation:{},modelValue:{type:Boolean}},emits:["update:modelValue","updated","deleted"],setup(t,{emit:m}){const i=t,w=m,n=T({get:()=>i.modelValue,set:p=>w("update:modelValue",p)}),s=$("info"),_=$(!1),f=$(!1),h=$(null),C=$(!1),E=T(()=>i.reservation?.comment.includes("EPG自動予約")??!1),B=T(()=>i.reservation?.is_recording_in_progress??!1);U(n,p=>{p?(s.value="info",_.value=!1,document.documentElement.classList.add("v-overlay-scroll-blocked")):document.documentElement.classList.remove("v-overlay-scroll-blocked")});const S=()=>{_.value&&!confirm("変更が保存されていません。ドロワーを閉じますか？")||(n.value=!1)},o=p=>{h.value=p},l=async()=>{if(!_.value||f.value||!h.value||!i.reservation)return;const p=h.value.caption_recording_mode==="Default",r=h.value.data_broadcasting_recording_mode==="Default";if(p!==r){F.warning("字幕データ録画設定・データ放送録画設定を明示的に設定する際は、両方とも「デフォルト設定を使う」以外に設定してください。");return}f.value=!0;try{if(await Z.updateReservation(i.reservation.id,h.value)){F.success("録画設定の変更を保存しました。");const c={...i.reservation,record_settings:h.value};w("updated",c),_.value=!1}}catch(k){console.error("Failed to save settings:",k),F.error("録画設定の保存に失敗しました。")}finally{f.value=!1}},v=()=>{C.value=!0},b=async()=>{if(C.value=!1,!!i.reservation)try{await Z.deleteReservation(i.reservation.id)&&(F.success("録画予約を削除しました。"),w("deleted",i.reservation.id),n.value=!1)}catch(p){console.error("Failed to delete reservation:",p)}};return(p,r)=>{const k=j("Icon");return d(),u(z,null,[e("div",{class:P(["reservation-detail-drawer__scrim",{"reservation-detail-drawer__scrim--visible":n.value}]),onClick:S},null,2),e("div",{class:P(["reservation-detail-drawer",{"reservation-detail-drawer--visible":n.value}])},[e("div",Ht,[e("div",Gt,[G((d(),u("div",{class:P(["reservation-detail-drawer__tab",{"reservation-detail-drawer__tab--active":s.value==="info"}]),onClick:r[0]||(r[0]=c=>s.value="info")},[a(k,{icon:"fluent:info-12-regular",width:"20px",height:"20px"}),r[5]||(r[5]=e("span",{class:"reservation-detail-drawer__tab-text"},"番組情報",-1))],2)),[[O]]),G((d(),u("div",{class:P(["reservation-detail-drawer__tab",{"reservation-detail-drawer__tab--active":s.value==="settings"}]),onClick:r[1]||(r[1]=c=>s.value="settings")},[a(k,{icon:"material-symbols:settings-video-camera-outline-rounded",width:"20px",height:"20px"}),r[6]||(r[6]=e("span",{class:"reservation-detail-drawer__tab-text"},"録画設定",-1))],2)),[[O]])]),G((d(),u("div",{class:"reservation-detail-drawer__close",onClick:S},[a(k,{icon:"fluent:dismiss-16-filled",width:"22px",height:"22px"})])),[[O]])]),e("div",Ot,[s.value==="info"&&t.reservation?(d(),u("div",zt,[a(wt,{reservation:t.reservation},null,8,["reservation"])])):V("",!0),s.value==="settings"&&t.reservation?(d(),u("div",Nt,[a(At,{reservation:t.reservation,"has-changes":_.value,onUpdateSettings:o,onChangesDetected:r[2]||(r[2]=c=>_.value=c)},null,8,["reservation","has-changes"])])):V("",!0)]),e("div",jt,[e("div",qt,[a(H,{class:"px-3",variant:"text",onClick:v},{default:D(()=>[a(k,{icon:"fluent:delete-16-regular",width:"20px",height:"20px"}),r[7]||(r[7]=e("span",{class:"ml-1"},"予約を削除",-1))]),_:1}),s.value==="settings"?(d(),A(H,{key:0,class:"px-3",color:"secondary",variant:"flat",disabled:!_.value,loading:f.value,onClick:l},{default:D(()=>[a(k,{icon:"fluent:save-16-regular",width:"20px",height:"20px"}),r[8]||(r[8]=e("span",{class:"ml-1"},"変更を保存",-1))]),_:1},8,["disabled","loading"])):V("",!0)])])],2),a(fe,{modelValue:C.value,"onUpdate:modelValue":r[4]||(r[4]=c=>C.value=c),"max-width":"715"},{default:D(()=>[a(he,null,{default:D(()=>[a(be,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:D(()=>[...r[9]||(r[9]=[x(" 録画予約を削除しますか？ ",-1)])]),_:1}),a(ye,{class:"pt-2 pb-0"},{default:D(()=>[t.reservation?(d(),u("div",Jt,[e("div",{class:"text-h6 text-text mb-2",innerHTML:R(I).decorateProgramInfo(t.reservation.program,"title")},null,8,Kt),e("div",Wt,g(R(I).getProgramTime(t.reservation.program)),1)])):V("",!0),B.value&&t.reservation?(d(),u("div",Zt,[a(k,{icon:"fluent:warning-16-filled",class:"warning-banner__icon"}),r[10]||(r[10]=e("span",{class:"warning-banner__text"},[x(" この番組は現在録画中です。"),e("br"),x(" 予約を削除すると、現在までの録画ファイルは残りますが、残りの期間の録画は中断されます。 ")],-1))])):t.reservation?(d(),u("div",Qt,[a(k,{icon:"fluent:info-16-regular",class:"warning-banner__icon"}),r[11]||(r[11]=e("span",{class:"warning-banner__text"}," 録画予約を削除すると、番組開始時刻までに再度予約を追加しない限り、この番組は録画されません。 ",-1))])):V("",!0),E.value&&t.reservation?(d(),u("div",Xt,[a(k,{icon:"fluent:warning-16-filled",class:"warning-banner__icon"}),r[12]||(r[12]=e("span",{class:"warning-banner__text"},[x(" この予約はキーワード自動予約で追加されました。削除してもすぐに再追加される可能性があります。"),e("br"),x(" 録画が不要な場合は削除ではなく「無効」にすることをおすすめします。 ")],-1))])):V("",!0)]),_:1}),a(we,{class:"pt-4 px-6 pb-6"},{default:D(()=>[a(ke),a(H,{color:"text",variant:"text",onClick:r[3]||(r[3]=c=>C.value=!1)},{default:D(()=>[a(k,{icon:"fluent:dismiss-20-regular",width:"18px",height:"18px"}),r[13]||(r[13]=e("span",{class:"ml-1"},"キャンセル",-1))]),_:1}),a(H,{class:"px-3",color:"error",variant:"flat",onClick:b},{default:D(()=>[a(k,{icon:"fluent:delete-20-regular",width:"18px",height:"18px"}),r[14]||(r[14]=e("span",{class:"ml-1"},"予約を削除",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),er=q(Yt,[["__scopeId","data-v-f3f81b6e"]]),tr={key:0,class:"reservation-list__header"},rr={class:"reservation-list__title"},sr={class:"reservation-list__title-text"},ar={key:1,class:"reservation-list__title-count"},ir={class:"reservation-list__actions"},nr={class:"reservation-list__empty-content"},or=["innerHTML"],lr=["innerHTML"],dr={class:"reservation-list__grid-content"},cr={key:1,class:"reservation-list__pagination"},ur=N({__name:"ReservationList",props:{title:{},reservations:{},total:{},page:{default:1},sortOrder:{default:"desc"},hideHeader:{type:Boolean,default:!1},hideSort:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showMoreButton:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:timer-20-regular"},emptyMessage:{default:"まだ録画予約がありません。"},emptySubMessage:{default:"番組表から録画予約を追加できます。"},isLoading:{type:Boolean,default:!1}},emits:["update:page","update:sortOrder","more","delete"],setup(t,{emit:m}){const i=t,w=$(i.page),n=$(i.sortOrder),s=$([...i.reservations]),_=$(i.total),f=$(!1),h=$(null);U(()=>i.page,o=>{w.value=o}),U(()=>i.sortOrder,o=>{n.value=o}),U(()=>i.reservations,o=>{s.value=[...o]}),U(()=>i.total,o=>{_.value=o});const C=m,E=o=>{h.value=o,f.value=!0},B=o=>{s.value=s.value.filter(l=>l.id!==o),_.value=Math.max(0,_.value-1),f.value=!1,C("delete",o)},S=o=>{const l=s.value.findIndex(v=>v.id===o.id);l!==-1&&(s.value[l]=o),h.value=o};return(o,l)=>{const v=j("Icon");return d(),u("div",{class:P(["reservation-list",{"reservation-list--show-sort":!t.hideSort}])},[t.hideHeader?V("",!0):(d(),u("div",tr,[e("h2",rr,[t.showBackButton?G((d(),u("div",{key:0,class:"reservation-list__title-back",onClick:l[0]||(l[0]=b=>o.$router.back())},[a(v,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[O]]):V("",!0),e("span",sr,g(t.title),1),t.showMoreButton?V("",!0):(d(),u("div",ar,[t.isLoading?(d(),A(v,{key:0,icon:"line-md:loading-twotone-loop",class:"mr-1 spin",width:"20px",height:"20px"})):(d(),u(z,{key:1},[x(g(_.value)+"件",1)],64))]))]),e("div",ir,[t.hideSort?V("",!0):(d(),A(K,{key:0,modelValue:n.value,"onUpdate:modelValue":[l[1]||(l[1]=b=>n.value=b),l[2]||(l[2]=b=>o.$emit("update:sortOrder",b))],items:[{title:"放送が近い順",value:"asc"},{title:"放送が遠い順",value:"desc"}],"item-title":"title","item-value":"value",class:"reservation-list__sort",color:"primary","bg-color":"background-lighten-1",variant:"solo",density:"comfortable","hide-details":""},null,8,["modelValue"])),t.showMoreButton?(d(),A(H,{key:1,variant:"text",class:"reservation-list__more",onClick:l[3]||(l[3]=b=>o.$emit("more"))},{default:D(()=>[l[7]||(l[7]=e("span",{class:"text-primary"},"もっと見る",-1)),a(v,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1})):V("",!0)])])),e("div",{class:P(["reservation-list__grid",{"reservation-list__grid--loading":t.isLoading,"reservation-list__grid--empty":_.value===0&&t.showEmptyMessage}])},[e("div",{class:P(["reservation-list__empty",{"reservation-list__empty--show":_.value===0&&t.showEmptyMessage&&!t.isLoading}])},[e("div",nr,[a(v,{class:"reservation-list__empty-icon",icon:t.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),e("h2",{innerHTML:t.emptyMessage},null,8,or),t.emptySubMessage?(d(),u("div",{key:0,class:"reservation-list__empty-submessage",innerHTML:t.emptySubMessage},null,8,lr)):V("",!0)])],2),e("div",dr,[(d(!0),u(z,null,W(s.value,b=>(d(),A(Ze,{key:b.id,reservation:b,onDeleted:B,onClick:E},null,8,["reservation"]))),128))])],2),!t.hidePagination&&_.value>0?(d(),u("div",cr,[a(Ve,{modelValue:w.value,"onUpdate:modelValue":[l[4]||(l[4]=b=>w.value=b),l[5]||(l[5]=b=>o.$emit("update:page",b))],"active-color":"primary",density:"comfortable",length:Math.ceil(_.value/30),"total-visible":R(M).isSmartphoneVertical()?5:7},null,8,["modelValue","length","total-visible"])])):V("",!0),a(er,{modelValue:f.value,"onUpdate:modelValue":l[6]||(l[6]=b=>f.value=b),reservation:h.value,onDeleted:B,onUpdated:S},null,8,["modelValue","reservation"])],2)}}}),$r=q(ur,[["__scopeId","data-v-0e683281"]]);export{$r as R,Z as a};
