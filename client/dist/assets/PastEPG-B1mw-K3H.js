import{g as ie,p as re,k as se,l as oe,n as le,e as X,m as ce,q as ue,s as de,t as me,j,V as ve,a as Y,R as O,_ as ee,u as ge}from"./top-C1n74bbd.js";import{B as pe}from"./Breadcrumbs-3hwVn__q.js";import{H as fe,N as _e}from"./Navigation-aYOy3zzz.js";import{V as S,ak as P,ah as D,M as te,N as b,p as u,ax as $,D as W,I as ne,a4 as h,a5 as V,aw as l,a3 as U,a1 as Z,ay as I,ac as L,Z as J,a7 as C,F as E,a8 as H,ad as K,_ as p}from"./SnackbarsStore-Buj_rJWA.js";import{V as he}from"./Videos-D7fTiRjA.js";import"./logo-DxZsBYPl.js";import"./ssrBoot-B3OjYwjG.js";import"./VersionStore-fcAF5g0F.js";const ye=re({color:String,direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},side:{type:String,default:"end",validator:e=>["start","end","both"].includes(e)},mode:{type:String,default:"intersect",validator:e=>["intersect","manual"].includes(e)},margin:[Number,String],loadMoreText:{type:String,default:"$vuetify.infiniteScroll.loadMore"},emptyText:{type:String,default:"$vuetify.infiniteScroll.empty"},...ue(),...ce()},"VInfiniteScroll"),Q=de({name:"VInfiniteScrollIntersect",props:{side:{type:String,required:!0},rootMargin:String},emits:{intersect:(e,c)=>!0},setup(e,c){let{emit:a}=c;const{intersectionRef:m,isIntersecting:s}=me();return b(s,async f=>{a("intersect",e.side,f)}),X(()=>u("div",{class:"v-infinite-scroll-intersect",style:{"--v-infinite-margin-size":e.rootMargin},ref:m},[$(" ")])),{}}}),we=ie()({name:"VInfiniteScroll",props:ye(),emits:{load:e=>!0},setup(e,c){let{slots:a,emit:m}=c;const s=S(),f=P("ok"),y=P("ok"),v=D(()=>se(e.margin)),w=P(!1);function t(i){if(!s.value)return;const d=e.direction==="vertical"?"scrollTop":"scrollLeft";s.value[d]=i}function r(){if(!s.value)return 0;const i=e.direction==="vertical"?"scrollTop":"scrollLeft";return s.value[i]}function _(){if(!s.value)return 0;const i=e.direction==="vertical"?"scrollHeight":"scrollWidth";return s.value[i]}function o(){if(!s.value)return 0;const i=e.direction==="vertical"?"clientHeight":"clientWidth";return s.value[i]}te(()=>{s.value&&(e.side==="start"?t(_()):e.side==="both"&&t(_()/2-o()/2))});function n(i,d){i==="start"?f.value=d:i==="end"&&(y.value=d)}function k(i){return i==="start"?f.value:y.value}let R=0;function N(i,d){w.value=d,w.value&&B(i)}function B(i){if(e.mode!=="manual"&&!w.value)return;const d=k(i);if(!s.value||["empty","loading"].includes(d))return;R=_(),n(i,"loading");function M(g){n(i,g),W(()=>{g==="empty"||g==="error"||(g==="ok"&&i==="start"&&t(_()-R+r()),e.mode!=="manual"&&W(()=>{window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{B(i)})})})}))})}m("load",{side:i,done:M})}const{t:x}=oe();function z(i,d){var T,A,F,q,G;if(e.side!==i&&e.side!=="both")return;const M=()=>B(i),g={side:i,props:{onClick:M,color:e.color}};return d==="error"?(T=a.error)==null?void 0:T.call(a,g):d==="empty"?((A=a.empty)==null?void 0:A.call(a,g))??u("div",null,[x(e.emptyText)]):e.mode==="manual"?d==="loading"?((F=a.loading)==null?void 0:F.call(a,g))??u(j,{indeterminate:!0,color:e.color},null):((q=a["load-more"])==null?void 0:q.call(a,g))??u(ve,{variant:"outlined",color:e.color,onClick:M},{default:()=>[x(e.loadMoreText)]}):((G=a.loading)==null?void 0:G.call(a,g))??u(j,{indeterminate:!0,color:e.color},null)}const{dimensionStyles:ae}=le(e);X(()=>{const i=e.tag,d=e.side==="start"||e.side==="both",M=e.side==="end"||e.side==="both",g=e.mode==="intersect";return u(i,{ref:s,class:["v-infinite-scroll",`v-infinite-scroll--${e.direction}`,{"v-infinite-scroll--start":d,"v-infinite-scroll--end":M}],style:ae.value},{default:()=>{var T;return[u("div",{class:"v-infinite-scroll__side"},[z("start",f.value)]),d&&g&&u(Q,{key:"start",side:"start",onIntersect:N,rootMargin:v.value},null),(T=a.default)==null?void 0:T.call(a),M&&g&&u(Q,{key:"end",side:"end",onIntersect:N,rootMargin:v.value},null),u("div",{class:"v-infinite-scroll__side"},[z("end",y.value)])]}})})}}),Se={class:"past-epg-viewer"},ke={key:0,class:"past-epg-viewer__header"},Me={class:"past-epg-viewer__title"},Ie={class:"past-epg-viewer__title-text"},Te={class:"past-epg-viewer__empty-content"},Ve=["innerHTML"],be=["innerHTML"],Be={class:"past-epg-viewer__grid-content"},Pe={id:"channels"},Le={id:"times"},Ce={class:"program-title"},Ee={class:"program-start-time"},He={class:"program-description"},De=ne({__name:"PastEPGViewer",props:{title:{},programs:{},total:{},updatePage:{},page:{default:1},hideHeader:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:warning-20-regular"},emptyMessage:{default:"録画番組が見つかりませんでした。"},emptySubMessage:{default:'サーバー設定で録画フォルダのパスを<br class="d-sm-none">正しく設定できているか確認してください。'},isLoading:{type:Boolean,default:!1}},setup(e){Y();const c=e,a=S(c.page),m=S([...c.programs]),s=S(c.total);b(()=>c.page,t=>{a.value=t}),b(()=>c.programs,t=>{m.value=[...t]}),b(()=>c.total,t=>{s.value=t});const f=D(()=>[...new Set(m.value.toSorted((t,r)=>t.channel&&r.channel?t.channel.display_channel_id.localeCompare(r.channel.display_channel_id):0).map(t=>{var r;return(r=t.channel)==null?void 0:r.name}))]),y=D(()=>{if(m.value.length===0)return[];const t=m.value.map(o=>new Date(o.start_time)).reduce((o,n)=>o<n?o:n),r=m.value.map(o=>new Date(o.end_time)).reduce((o,n)=>o>n?o:n),_=[];for(let o=new Date(t.setMinutes(0,0,0));o<=r;o.setHours(o.getHours()+1))_.push(new Date(o));return _}),v=t=>{var r;switch((r=t.genres[0])==null?void 0:r.major){case"スポーツ":return"genre_sports";case"ドラマ":return"genre_drama";case"音楽":return"genre_music";case"映画":return"genre_movie";case"アニメ・特撮":return"genre_anime";default:return"genre_none"}},w=async({done:t})=>{if(a.value>=Math.ceil(s.value/90)){t("empty");return}await c.updatePage(a.value+1),t("ok")};return(t,r)=>{const _=Z("Icon"),o=Z("router-link");return p(),h("div",Se,[t.hideHeader?V("",!0):(p(),h("div",ke,[l("h2",Me,[t.showBackButton?U((p(),h("div",{key:0,class:"past-epg-viewer__title-back",onClick:r[0]||(r[0]=n=>t.$router.back())},[u(_,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[O]]):V("",!0),l("span",Ie,I(t.title),1)])])),l("div",{class:L(["past-epg-viewer__grid",{"past-epg-viewer__grid--loading":t.isLoading,"past-epg-viewer__grid--empty":s.value===0&&t.showEmptyMessage}])},[l("div",{class:L(["past-epg-viewer__empty",{"past-epg-viewer__empty--show":s.value===0&&t.showEmptyMessage}])},[l("div",Te,[u(_,{class:"past-epg-viewer__empty-icon",icon:t.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),l("h2",{innerHTML:t.emptyMessage},null,8,Ve),t.emptySubMessage?(p(),h("div",{key:0,class:"past-epg-viewer__empty-submessage",innerHTML:t.emptySubMessage},null,8,be)):V("",!0)])],2),l("div",Be,[t.isLoading?V("",!0):(p(),J(we,{key:0,id:"epg-container",side:"start",onLoad:w},{empty:C(()=>r[1]||(r[1]=[$("すべて読み込みました")])),default:C(()=>[l("div",Pe,[r[2]||(r[2]=l("div",{class:"dummy"},null,-1)),(p(!0),h(E,null,H(f.value,n=>(p(),h("div",{key:n,class:"channel-name"},I(n),1))),128))]),l("div",Le,[(p(!0),h(E,null,H(y.value,(n,k)=>(p(),h("div",{key:k,class:"time-label"},I(n.getHours()===0||k===0?n.toLocaleString([],{month:"numeric",day:"numeric",weekday:"short",hour:"numeric"}):n.toLocaleTimeString([],{hour:"numeric"})),1))),128))]),l("div",{id:"schedule",style:K({"--minute-sum":60*y.value.length})},[(p(!0),h(E,null,H(m.value,n=>{var k;return U((p(),J(o,{class:L(["program",["program",v(n)]]),key:n.id,title:n.title,style:K({gridColumn:f.value.indexOf((k=n.channel)==null?void 0:k.name)+1,gridRowStart:Math.floor((new Date(n.start_time).getTime()-new Date(y.value[0]).getTime())/(60*1e3))+1,gridRowEnd:`span ${Math.ceil(n.duration/60)}`}),to:n.recorded_video.status==="Recording"||!n.recorded_video.has_key_frames?{path:""}:`/videos/watch/${n.id}`},{default:C(()=>[l("div",Ce,[l("div",Ee,I(new Date(n.start_time).getMinutes().toString().padStart(2,"0")),1),$(" "+I(n.title),1)]),l("div",He,I(n.description),1)]),_:2},1032,["title","class","style","to"])),[[O]])}),128))],4)]),_:1}))])],2)])}}}),$e=ee(De,[["__scopeId","data-v-f7377b42"]]),Re={class:"route-container"},Ne={class:"pastepg-container-wrapper"},xe={class:"pastepg-container"},ze=ne({__name:"PastEPG",setup(e){ge(),Y();const c=S([]),a=S(0),m=S(!0),s=S(1),f=async()=>{let v=[];const w=s.value;for(let t=(w-1)*3+1;t<=w*3;t++){const r=await he.fetchVideos("desc",t);r&&(v=[...v,...r.recorded_programs],a.value=r.total)}v=v.reverse(),c.value=[...v,...c.value],m.value=!1},y=async v=>{s.value=v,await f()};return te(async()=>{await f()}),(v,w)=>(p(),h("div",Re,[u(fe),l("main",null,[u(_e),l("div",Ne,[l("div",xe,[u(pe,{crumbs:[{name:"ホーム",path:"/"},{name:"過去番組表",path:"/pastepg/",disabled:!0}]}),u($e,{title:"過去番組表",programs:c.value,total:a.value,page:s.value,isLoading:m.value,showBackButton:!0,showEmptyMessage:!m.value,updatePage:y},null,8,["programs","total","page","isLoading","showEmptyMessage"])])])])]))}}),Ze=ee(ze,[["__scopeId","data-v-ad38e667"]]);export{Ze as default};
