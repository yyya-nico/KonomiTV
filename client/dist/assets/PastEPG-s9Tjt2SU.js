import{a as E,R as B,_ as H,u as P}from"./top-B5QCD-px.js";import{B as V}from"./Breadcrumbs-Da1NqJ76.js";import{H as C,N as I}from"./Navigation-mG3T-0I0.js";import{I as T,V as v,N as D,ah as b,a4 as l,a5 as w,aw as a,a3 as L,p,a1 as S,ay as g,ac as y,F as f,a8 as M,Z as N,a7 as $,ax as R,ad as G,_ as o,M as x}from"./SnackbarsStore-Buj_rJWA.js";import{V as z}from"./Videos-D7fTiRjA.js";import"./logo-DvDS4_yC.js";import"./ssrBoot-CrxWfIJS.js";import"./VersionStore-fcAF5g0F.js";const F={class:"past-epg-viewer"},j={key:0,class:"past-epg-viewer__header"},O={class:"past-epg-viewer__title"},Z={class:"past-epg-viewer__title-text"},q={class:"past-epg-viewer__empty-content"},A=["innerHTML"],J=["innerHTML"],K={id:"epg-container"},Q={id:"channels"},U={id:"times"},W={id:"schedule"},X={class:"start-time"},Y=T({__name:"PastEPGViewer",props:{title:{},programs:{},total:{},hideHeader:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:warning-20-regular"},emptyMessage:{default:"録画番組が見つかりませんでした。"},emptySubMessage:{default:'サーバー設定で録画フォルダのパスを<br class="d-sm-none">正しく設定できているか確認してください。'},isLoading:{type:Boolean,default:!1}},setup(k){E();const r=k,i=v([...r.programs]),c=v(r.total);D(()=>r.programs,e=>{i.value=[...e]}),D(()=>r.total,e=>{c.value=e});const h=b(()=>[...new Set(i.value.toSorted((e,s)=>e.channel&&s.channel?e.channel.remocon_id-s.channel.remocon_id:0).map(e=>{var s;return(s=e.channel)==null?void 0:s.name}))]),d=b(()=>{if(i.value.length===0)return[];const e=new Date(i.value.reduce((n,t)=>new Date(n.start_time)<new Date(t.start_time)?n:t).start_time),s=new Date(i.value.reduce((n,t)=>new Date(n.end_time)>new Date(t.end_time)?n:t).end_time),m=[];for(let n=new Date(e.setMinutes(0,0,0));n<=s;n.setHours(n.getHours()+1))m.push(new Date(n));return m}),u=e=>{var s;switch((s=e.genres[0])==null?void 0:s.major){case"スポーツ":return"genre_sports";case"ドラマ":return"genre_drama";case"音楽":return"genre_music";case"映画":return"genre_movie";case"アニメ・特撮":return"genre_anime";default:return"genre_none"}};return(e,s)=>{const m=S("Icon"),n=S("router-link");return o(),l("div",F,[e.hideHeader?w("",!0):(o(),l("div",j,[a("h2",O,[e.showBackButton?L((o(),l("div",{key:0,class:"past-epg-viewer__title-back",onClick:s[0]||(s[0]=t=>e.$router.back())},[p(m,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[B]]):w("",!0),a("span",Z,g(e.title),1)])])),a("div",{class:y(["past-epg-viewer__grid",{"past-epg-viewer__grid--loading":e.isLoading,"past-epg-viewer__grid--empty":c.value===0&&e.showEmptyMessage}])},[a("div",{class:y(["past-epg-viewer__empty",{"past-epg-viewer__empty--show":c.value===0&&e.showEmptyMessage}])},[a("div",q,[p(m,{class:"past-epg-viewer__empty-icon",icon:e.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),a("h2",{innerHTML:e.emptyMessage},null,8,A),e.emptySubMessage?(o(),l("div",{key:0,class:"past-epg-viewer__empty-submessage",innerHTML:e.emptySubMessage},null,8,J)):w("",!0)])],2),a("div",K,[a("div",Q,[s[1]||(s[1]=a("div",{class:"dummy"},null,-1)),(o(!0),l(f,null,M(h.value,t=>(o(),l("div",{key:t,class:"channel-name"},g(t),1))),128))]),a("div",U,[(o(!0),l(f,null,M(d.value,(t,_)=>(o(),l("div",{key:_,class:"time-label"},g(t.getHours()===0||_===0?t.toLocaleString([],{month:"numeric",day:"numeric",weekday:"short",hour:"numeric"}):t.toLocaleTimeString([],{hour:"numeric"})),1))),128))]),a("div",W,[(o(!0),l(f,null,M(i.value,t=>{var _;return L((o(),N(n,{class:y(["program",["program",u(t)]]),key:t.id,style:G({gridColumn:h.value.indexOf((_=t.channel)==null?void 0:_.name)+1,gridRowStart:Math.floor((new Date(t.start_time).getTime()-new Date(d.value[0]).getTime())/(60*1e3))+1,gridRowEnd:`span ${Math.ceil(t.duration/60)}`}),to:t.recorded_video.status==="Recording"||!t.recorded_video.has_key_frames?{path:""}:`/videos/watch/${t.id}`},{default:$(()=>[a("div",X,g(new Date(t.start_time).getMinutes().toString().padStart(2,"0")),1),R(" "+g(t.title),1)]),_:2},1032,["class","style","to"])),[[B]])}),128))])])],2)])}}}),ee=H(Y,[["__scopeId","data-v-e593e1f1"]]),te={class:"route-container"},se={class:"pastepg-container-wrapper"},ae={class:"pastepg-container"},ne=T({__name:"PastEPG",setup(k){P(),E();const r=v([]),i=v(1/0),c=v(!0),h=async()=>{for(let d=1;d<=i.value/100;d++){const u=await z.fetchVideos("desc",d);u&&(r.value=[...r.value,...u.recorded_programs],i.value=u.total)}r.value=r.value.reverse(),c.value=!1};return x(async()=>{await h()}),(d,u)=>(o(),l("div",te,[p(C),a("main",null,[p(I),a("div",se,[a("div",ae,[p(V,{crumbs:[{name:"ホーム",path:"/"},{name:"過去番組表",path:"/pastepg/",disabled:!0}]}),p(ee,{title:"過去番組表",programs:r.value,total:i.value,isLoading:c.value,showBackButton:!0,showEmptyMessage:!c.value},null,8,["programs","total","isLoading","showEmptyMessage"])])])])]))}}),me=H(ne,[["__scopeId","data-v-bb0edcc9"]]);export{me as default};
