import{I as te,W as U,N as H,aP as ve,_ as se,a8 as v,p as n,ay as t,a4 as O,a2 as W,a5 as $,a6 as le,az as o,F as j,a9 as z,ax as ne,G as E,cd as G,aL as S,aD as L,$ as C,aW as B,aT as ie,M as ge,au as fe,ad as R,D as pe,ce as _e,cc as ae}from"./SnackbarsStore-D2723teg.js";import{V as q}from"./VDialog-Bp2QFNGD.js";import{a as Q,V as J,b as be,c as Ve}from"./VCard-D_Ycheih.js";import{V as X}from"./ssrBoot-9bFU7tTc.js";import{d as Y}from"./VSelect-Ci4G1wYq.js";import{V as I,R as N,_ as ce}from"./top-Ra0pbfKg.js";import{F as oe}from"./index-BTEqWmPx.js";import{a as ye,V as re}from"./VTabs-RV2CGgTl.js";import{V as Z}from"./VSwitch-DtHkgpW-.js";import{V as ke}from"./VersionStore-Vd_xoAev.js";import{S as we}from"./Base-CCTg61rY.js";import{a as K}from"./VTextField-B6HwneY5.js";import{V as de}from"./VSlider-BbPoAWGa.js";import"./VChip-CCklXAW-.js";import"./VAvatar-Dxt8YX1N.js";import"./logo-DS3Ny_pw.js";import"./Navigation-BG-VQcp_.js";const xe={class:"px-5 pb-6"},Te={key:0,class:"user-manage-settings__label"},Ce={key:1,class:"user-accounts"},he=["src"],Se={class:"user-account__info"},Ue={class:"user-account__name"},Ee={class:"user-account__id"},$e=["disabled","onClick"],Be=te({__name:"AccountManageSettings",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(c,{emit:i}){const d=c,u=i,s=U(!1);H(()=>d.modelValue,e=>{s.value=e}),H(s,e=>{u("update:modelValue",e)});const w=ve(),r=U([]),_=U({}),p=U({});H(p,e=>{for(const[a,T]of Object.entries(e)){const l=r.value.find(b=>b.id===Number(a));if(l){const b=T==="管理者";l.is_admin!==b&&G.updateSpecifiedUser(l.name,b).then(m=>{m?(S.success(`ユーザー ${l.name} の権限を ${T} に変更しました。`),y()):p.value[l.id]=l.is_admin?"管理者":"一般"}).catch(()=>{p.value[l.id]=l.is_admin?"管理者":"一般"})}}},{deep:!0});function y(){G.fetchAllUsers().then(async e=>{if(e!==null){r.value=e;for(const a of r.value)G.fetchSpecifiedUserIcon(a.name).then(T=>{_.value[a.id]=T??""}),p.value[a.id]=a.is_admin?"管理者":"一般"}else{const a=await w.fetchUser(!0);a!==null&&a.name===w.user?.name&&!a.is_admin&&(S.warning("ログイン中ユーザーの管理者権限が剥奪されました。3秒後にリロードします。"),await L.sleep(3),location.reload())}})}w.fetchUser().then(e=>{e?.is_admin&&y()});const k=U(!1),x=U(null);function M(e){x.value=e,k.value=!0}function V(){x.value&&G.deleteSpecifiedUser(x.value).then(e=>{e&&(r.value=r.value.filter(a=>a.name!==x.value),S.success(`ユーザー ${x.value} を削除しました。`),y()),k.value=!1})}return(e,a)=>{const T=W("Icon");return C(),se(q,{"max-width":"570",transition:"slide-y-transition",modelValue:s.value,"onUpdate:modelValue":a[4]||(a[4]=l=>s.value=l)},{default:v(()=>[n(Q,{class:"user-manage-settings"},{default:v(()=>[n(J,{class:"px-5 pt-6 pb-3 d-flex align-center font-weight-bold",style:{height:"60px"}},{default:v(()=>[n(T,{icon:"fluent:person-board-20-filled",height:"26px"}),a[5]||(a[5]=t("span",{class:"ml-3"},"アカウントの管理",-1)),n(X),O((C(),$("div",{class:"d-flex align-center rounded-circle cursor-pointer px-2 py-2",onClick:a[0]||(a[0]=l=>s.value=!1)},[n(T,{icon:"fluent:dismiss-12-filled",width:"23px",height:"23px"})])),[[N]])]),_:1}),t("div",xe,[a[8]||(a[8]=t("div",{class:"user-manage-settings__label"},[o(" 管理者ユーザーには、サーバー設定やアカウントの管理権限が与えられます。"),t("br"),o(" 変更内容はすぐに反映されます。"),t("br")],-1)),a[9]||(a[9]=t("div",{class:"user-manage-settings__label text-error-lighten-1"},[t("strong",null,"アカウントを削除すると、そのアカウントに紐づくすべてのユーザーデータが削除されます。元に戻すことはできません。")],-1)),r.value.length===0?(C(),$("div",Te,[...a[6]||(a[6]=[t("div",null,[t("b",null,"まだ KonomiTV アカウントが一つも作成されていません。")],-1),t("div",{class:"mt-1"},"KonomiTV アカウントを作成すると、より便利な機能が使えます！ぜひログインしての利用をおすすめします。",-1)])])):le("",!0),r.value.length>0?(C(),$("div",Ce,[(C(!0),$(j,null,z(r.value,l=>(C(),$("div",{key:l.id,class:"user-account"},[t("img",{class:"user-account__icon",src:_.value[l.id]},null,8,he),t("div",Se,[t("span",Ue,ne(l.name),1),t("span",Ee,"User ID: "+ne(l.id),1)]),n(Y,{class:"user-account__role",color:"primary",density:"compact",variant:"outlined","hide-details":"",items:["一般","管理者"],modelValue:p.value[l.id],"onUpdate:modelValue":b=>p.value[l.id]=b},null,8,["modelValue","onUpdate:modelValue"]),O((C(),$("button",{class:"user-account__delete-button",disabled:l.name===E(w).user?.name,onClick:b=>M(l.name)},[...a[7]||(a[7]=[t("svg",{class:"iconify iconify--fluent",width:"20px",height:"20px",viewBox:"0 0 16 16"},[t("path",{fill:"currentColor",d:"M7 3h2a1 1 0 0 0-2 0ZM6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1h4Zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0v-5ZM9.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 1 0v-5a.5.5 0 0 0-.5-.5Z"})],-1)])],8,$e)),[[N]])]))),128))])):le("",!0)])]),_:1}),n(q,{"max-width":"385",modelValue:k.value,"onUpdate:modelValue":a[3]||(a[3]=l=>k.value=l)},{default:v(()=>[n(Q,null,{default:v(()=>[n(J,{class:"d-flex justify-center pt-6 font-weight-bold"},{default:v(()=>[...a[10]||(a[10]=[o("本当にアカウントを削除しますか？",-1)])]),_:1}),n(be,{class:"pt-2 pb-0"},{default:v(()=>[...a[11]||(a[11]=[o(" アカウントに紐づくすべてのユーザーデータが削除されます。元に戻すことはできません。",-1),t("br",null,null,-1),o(" 本当にアカウントを削除しますか？ ",-1)])]),_:1}),n(Ve,{class:"pt-4 px-6 pb-6"},{default:v(()=>[n(X),n(I,{color:"text",variant:"text",onClick:a[1]||(a[1]=l=>k.value=!1)},{default:v(()=>[...a[12]||(a[12]=[o("キャンセル",-1)])]),_:1}),n(I,{color:"error",variant:"flat",onClick:a[2]||(a[2]=l=>V())},{default:v(()=>[...a[13]||(a[13]=[o("削除",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])}}}),Ie=ce(Be,[["__scopeId","data-v-b8565d8d"]]);async function Me(c,i){const d=c.getReader();let u;for(;!(u=await d.read()).done;)i(u.value)}function Ae(c){let i,d,u,s=!1;return function(r){i===void 0?(i=r,d=0,u=-1):i=Ke(i,r);const _=i.length;let p=0;for(;d<_;){s&&(i[d]===10&&(p=++d),s=!1);let y=-1;for(;d<_&&y===-1;++d)switch(i[d]){case 58:u===-1&&(u=d-p);break;case 13:s=!0;case 10:y=d;break}if(y===-1)break;c(i.subarray(p,y),u),p=d,u=-1}p===_?i=void 0:p!==0&&(i=i.subarray(p),d-=p)}}function Pe(c,i,d){let u=ue();const s=new TextDecoder;return function(r,_){if(r.length===0)d?.(u),u=ue();else if(_>0){const p=s.decode(r.subarray(0,_)),y=_+(r[_+1]===32?2:1),k=s.decode(r.subarray(y));switch(p){case"data":u.data=u.data?u.data+`
`+k:k;break;case"event":u.event=k;break;case"id":c(u.id=k);break;case"retry":const x=parseInt(k,10);isNaN(x)||i(u.retry=x);break}}}}function Ke(c,i){const d=new Uint8Array(c.length+i.length);return d.set(c),d.set(i,c.length),d}function ue(){return{data:"",event:"",id:"",retry:void 0}}var Le=function(c,i){var d={};for(var u in c)Object.prototype.hasOwnProperty.call(c,u)&&i.indexOf(u)<0&&(d[u]=c[u]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,u=Object.getOwnPropertySymbols(c);s<u.length;s++)i.indexOf(u[s])<0&&Object.prototype.propertyIsEnumerable.call(c,u[s])&&(d[u[s]]=c[u[s]]);return d};const ee="text/event-stream",De=1e3,me="last-event-id";function Oe(c,i){var{signal:d,headers:u,onopen:s,onmessage:w,onclose:r,onerror:_,openWhenHidden:p,fetch:y}=i,k=Le(i,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((x,M)=>{const V=Object.assign({},u);V.accept||(V.accept=ee);let e;function a(){e.abort(),document.hidden||h()}p||document.addEventListener("visibilitychange",a);let T=De,l=0;function b(){document.removeEventListener("visibilitychange",a),window.clearTimeout(l),e.abort()}d?.addEventListener("abort",()=>{b(),x()});const m=y??window.fetch,g=s??Ne;async function h(){var f;e=new AbortController;try{const A=await m(c,Object.assign(Object.assign({},k),{headers:V,signal:e.signal}));await g(A),await Me(A.body,Ae(Pe(P=>{P?V[me]=P:delete V[me]},P=>{T=P},w))),r?.(),b(),x()}catch(A){if(!e.signal.aborted)try{const P=(f=_?.(A))!==null&&f!==void 0?f:T;window.clearTimeout(l),l=window.setTimeout(h,P)}catch(P){b(),M(P)}}}h()})}function Ne(c){const i=c.headers.get("content-type");if(!i?.startsWith(ee))throw new Error(`Expected content-type to be ${ee}, Actual: ${i}`)}class D{static streamLogs(i,d,u){const s=new AbortController,w=L.getAccessToken();return w===null?(S.error(`サーバーログの表示には管理者権限が必要です。
管理者アカウントでログインし直してください。`),null):(Oe(`${L.getApiBaseUrl()}/maintenance/logs/${i}`,{method:"GET",signal:s.signal,headers:{Authorization:`Bearer ${w}`,"X-KonomiTV-Version":L.version},openWhenHidden:!0,onmessage:r=>{r.event==="initial_log_update"?d(JSON.parse(r.data)):r.event==="log_update"&&u(JSON.parse(r.data))},onerror:r=>{if(console.error("Log stream error:",r),r instanceof Response&&(r.status===401||r.status===403)){S.error(`サーバーログの表示には管理者権限が必要です。
管理者アカウントでログインし直してください。`),s.abort();return}}}),s)}static async updateDatabase(){const i=await B.post("/maintenance/update-database");if(i.type==="error")switch(i.data.detail){default:B.showGenericError(i,"データベースを更新できませんでした。");break}}static async runBatchScan(){const i=await B.post("/maintenance/run-batch-scan",void 0,{timeout:864e5});if(i.type==="error"){switch(i.data.detail){case"Batch scan of recording folders is already running":B.showGenericError(i,"録画フォルダの一括スキャンは既に実行中です。");break;default:B.showGenericError(i,"録画フォルダの一括スキャンを開始できませんでした。");break}return!1}return!0}static async startBackgroundAnalysis(){const i=await B.post("/maintenance/run-background-analysis",void 0,{timeout:864e5});if(i.type==="error"){switch(i.data.detail){case"Background analysis task is already running":B.showGenericError(i,"バックグラウンド解析タスクは既に実行中です。");break;default:B.showGenericError(i,"バックグラウンド解析タスクを開始できませんでした。");break}return!1}return!0}static async restartServer(){const i=await B.post("/maintenance/restart");if(i.type==="error"){switch(i.data.detail){default:B.showGenericError(i,"サーバーを再起動できませんでした。");break}return!1}return!0}static async shutdownServer(){const i=await B.post("/maintenance/shutdown");if(i.type==="error"){switch(i.data.detail){default:B.showGenericError(i,"サーバーをシャットダウンできませんでした。");break}return!1}return!0}}const He={class:"px-5 pb-6"},Re={class:"server-log-dialog__label-container"},Ge={class:"server-log-dialog__auto-scroll-control"},Fe={class:"server-log-dialog__console-container"},Ze=["innerHTML"],We=["innerHTML"],F=1e4,je=te({__name:"ServerLogDialog",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(c,{emit:i}){const d=c,u=i,s=U(!1);H(()=>d.modelValue,m=>{s.value=m,m?e():l()}),H(s,m=>{u("update:modelValue",m)});const w=U([]),r=U([]),_=ie("server_scroller"),p=ie("access_scroller"),y=U("server"),k=U(!0);let x=null,M=null;function V(m){const g=/(DEBUG|INFO|WARNING|ERROR|CRITICAL):/,h=m.match(g);if(h){const f=h[1];let A="";switch(f){case"DEBUG":A="#7cbfcb";break;case"INFO":A="#aeca91";break;case"WARNING":A="#e5cb95";break;case"ERROR":A="#da8789";break}return m.replace(g,`<span style="color: ${A};">${f}</span>:`)}return m}function e(){a("server"),a("access")}function a(m){m==="server"&&x!==null?T("server"):m==="access"&&M!==null&&T("access");const g=D.streamLogs(m,h=>{const f=m==="server"?w:r;f.value=h,f.value.length>F&&(f.value=f.value.slice(-F)),k.value&&b(m)},h=>{const f=m==="server"?w:r;f.value.push(h),f.value.length>F&&(f.value=f.value.slice(-F)),k.value&&b(m)});if(g===null){const h=`サーバーログの表示には管理者権限が必要です。
管理者アカウントでログインし直してください。`;m==="server"?w.value=[h]:r.value=[h];return}m==="server"?x=g:M=g}function T(m){m==="server"&&x!==null?(x.abort(),x=null):m==="access"&&M!==null&&(M.abort(),M=null)}function l(){T("server"),T("access")}function b(m){pe(()=>{m==="server"&&_.value?_.value.scrollToIndex(w.value.length-1,{align:"end"}):m==="access"&&p.value&&p.value.scrollToIndex(r.value.length-1,{align:"end"})})}return ge(()=>{s.value&&e()}),fe(()=>{l()}),(m,g)=>{const h=W("Icon");return C(),se(q,{"max-width":"900",transition:"slide-y-transition",modelValue:s.value,"onUpdate:modelValue":g[3]||(g[3]=f=>s.value=f)},{default:v(()=>[n(Q,{class:"server-log-dialog"},{default:v(()=>[n(J,{class:"px-5 pt-6 pb-0 d-flex align-center font-weight-bold",style:{height:"60px"}},{default:v(()=>[n(h,{icon:"fluent:document-text-16-regular",height:"26px"}),g[4]||(g[4]=t("span",{class:"ml-3"},"サーバーログ",-1)),n(X),O((C(),$("div",{class:"d-flex align-center rounded-circle cursor-pointer px-2 py-2",onClick:g[0]||(g[0]=f=>s.value=!1)},[n(h,{icon:"fluent:dismiss-12-filled",width:"23px",height:"23px"})])),[[N]])]),_:1}),n(ye,{class:"server-log-dialog__tabs",color:"primary","bg-color":"transparent","align-tabs":"center",modelValue:y.value,"onUpdate:modelValue":g[1]||(g[1]=f=>y.value=f)},{default:v(()=>[n(re,{style:{"text-transform":"none !important"},value:"server"},{default:v(()=>[...g[5]||(g[5]=[o("サーバーログ",-1)])]),_:1}),n(re,{style:{"text-transform":"none !important"},value:"access"},{default:v(()=>[...g[6]||(g[6]=[o("アクセスログ",-1)])]),_:1})]),_:1},8,["modelValue"]),t("div",He,[t("div",Re,[g[8]||(g[8]=t("div",{class:"server-log-dialog__label"}," リアルタイムでログを表示しています。最新のログが下部に表示されます。 ",-1)),t("div",Ge,[g[7]||(g[7]=t("label",{for:"auto_scroll_enabled",class:"server-log-dialog__auto-scroll-label"},"自動スクロール",-1)),n(Z,{id:"auto_scroll_enabled",modelValue:k.value,"onUpdate:modelValue":g[2]||(g[2]=f=>k.value=f),class:"server-log-dialog__auto-scroll-switch",color:"primary",density:"compact","hide-details":""},null,8,["modelValue"])])]),t("div",Fe,[n(E(oe),{ref_key:"server_scroller",ref:_,class:R(["server-log-dialog__console",{hidden:y.value!=="server"}]),data:w.value},{default:v(({item:f})=>[t("div",{class:"server-log-dialog__line",innerHTML:V(f)},null,8,Ze)]),_:1},8,["class","data"]),n(E(oe),{ref_key:"access_scroller",ref:p,class:R(["server-log-dialog__console",{hidden:y.value!=="access"}]),data:r.value},{default:v(({item:f})=>[t("div",{class:"server-log-dialog__line",innerHTML:V(f)},null,8,We)]),_:1},8,["class","data"])])])]),_:1})]),_:1},8,["modelValue"])}}}),ze=ce(je,[["__scopeId","data-v-c122b597"]]),qe={class:"settings__heading"},Qe={class:"settings__content-heading"},Je={class:"settings__item"},Xe={class:"settings__item"},Ye={class:"settings__item"},et={class:"settings__item"},tt={class:"settings__item"},st={class:"settings__item settings__item--switch"},lt={class:"settings__item settings__item--switch"},nt={class:"settings__content-heading mt-6"},it={class:"settings__item"},at={class:"settings__item"},ot={class:"settings__content-heading mt-6"},rt={class:"settings__item settings__item--switch"},dt={class:"settings__item"},ut={class:"settings__content-heading mt-6"},mt={class:"settings__item"},vt={class:"d-flex align-center mt-3"},ct=["onClick"],gt={class:"settings__content-heading mt-6"},ft={class:"settings__item"},pt={class:"settings__item-label"},_t={class:"d-flex align-center mt-3"},bt=["onClick"],Vt={class:"settings__content-heading mt-8"},yt={class:"settings__item"},kt={class:"settings__item-label mt-1"},wt={class:"settings__content"},xt={class:"settings__content-heading mt-8"},Tt={class:"settings__content"},Rt=te({__name:"Server",setup(c){const i=L.isSmartphoneHorizontal(),d=U(!0);ve().fetchUser().then(V=>{V&&V.is_admin&&(d.value=!1)});const s=U(structuredClone(_e));ae.fetchServerSettings().then(V=>{V&&(s.value=V)});async function w(){s.value.server.custom_https_certificate===""&&(s.value.server.custom_https_certificate=null),s.value.server.custom_https_private_key===""&&(s.value.server.custom_https_private_key=null),await ae.updateServerSettings(s.value)===!0&&S.success(`サーバー設定を更新しました。
変更を反映するためには、KonomiTV サーバーを再起動してください。`)}const r=U(!1),_=U(!1);async function p(){S.show("データベースを更新しています..."),await D.updateDatabase(),S.success("データベースを更新しました。")}async function y(){S.info(`録画フォルダの一括スキャンを開始しています...
大量の録画ファイルが保存されている環境では、処理完了まで数時間〜数日以上かかることがあります。`),await D.runBatchScan()===!0&&S.success(`録画フォルダの一括スキャンが完了しました。
すべての録画ファイルがデータベースに同期されているはずです。`)}async function k(){S.info(`バックグラウンド解析タスクを開始しています...
大量の録画ファイルが保存されている環境では、処理完了まで数時間〜数日以上かかることがあります。`),await D.startBackgroundAnalysis()===!0&&S.success(`バックグラウンド解析タスクの実行が完了しました。
すべての録画番組のメタデータ解析/サムネイル生成が完了しているはずです。`)}async function x(){if(await D.restartServer()===!0){for(S.show("KonomiTV サーバーを再起動しています..."),await L.sleep(1);await ke.fetchServerVersion(!0)===null;)await L.sleep(1);S.success("KonomiTV サーバーを再起動しました。")}}async function M(){await D.shutdownServer()===!0&&S.success("KonomiTV サーバーをシャットダウンしました。")}return(V,e)=>{const a=W("Icon"),T=W("router-link");return C(),se(we,null,{default:v(()=>[t("h2",qe,[O((C(),$("a",{class:"settings__back-button",onClick:e[0]||(e[0]=l=>V.$router.back())},[n(a,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[N]]),n(a,{icon:"fluent:server-surface-16-filled",width:"22px"}),e[25]||(e[25]=t("span",{class:"ml-2"},"サーバー設定",-1))]),e[92]||(e[92]=t("div",{class:"settings__description"},[o(" サーバー設定を変更するには、管理者アカウントでログインしている必要があります。"),t("br")],-1)),e[93]||(e[93]=t("div",{class:"settings__description mt-1"},[o(" [サーバー設定を更新] ボタンを押さずにこのページから離れると、変更内容は破棄されます。"),t("br"),o(" 変更を反映するには KonomiTV サーバーの再起動が必要です。"),t("br")],-1)),t("div",{class:R(["settings__content",{"settings__content--disabled":d.value}])},[t("div",Qe,[n(a,{icon:"fa-solid:sliders-h",width:"22px",style:{padding:"0 3px"}}),e[26]||(e[26]=t("span",{class:"ml-2"},"全般",-1))]),t("div",Je,[e[27]||(e[27]=t("div",{class:"settings__item-heading"},"利用するバックエンド",-1)),e[28]||(e[28]=t("div",{class:"settings__item-label"},[o(" EDCB・Mirakurun のいずれかを選択してください。"),t("br"),o(" バックエンドに Mirakurun が選択されているときは、録画予約機能は利用できません。"),t("br")],-1)),n(Y,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",density:E(i)?"compact":"default",items:["EDCB","Mirakurun"],modelValue:s.value.general.backend,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.general.backend=l)},null,8,["density","modelValue"])]),t("div",Xe,[e[29]||(e[29]=t("div",{class:"settings__item-heading"},"EDCB (EpgTimerNW) の TCP API の URL",-1)),e[30]||(e[30]=t("div",{class:"settings__item-label"},[o(" バックエンドに EDCB が選択されているときに利用されます。"),t("br"),o(" tcp://edcb-namedpipe/ と指定すると、TCP API の代わりに名前付きパイプを使って通信します (ローカルのみ)。"),t("br")],-1)),e[31]||(e[31]=t("div",{class:"settings__item-label mt-1"},[o(" 一部 Windows 環境では localhost の名前解決が遅いため、ストリーミング開始までの待機時間が長くなる場合があります。 EDCB と同じ PC に KonomiTV をインストールしている場合、localhost ではなく 127.0.0.1 の利用を推奨します。"),t("br")],-1)),n(K,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",density:E(i)?"compact":"default",modelValue:s.value.general.edcb_url,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.general.edcb_url=l)},null,8,["density","modelValue"])]),t("div",Ye,[e[32]||(e[32]=t("div",{class:"settings__item-heading"},"Mirakurun / mirakc の HTTP API の URL",-1)),e[33]||(e[33]=t("div",{class:"settings__item-label"},[o(" バックエンドに Mirakurun が選択されているときに利用されます。"),t("br")],-1)),e[34]||(e[34]=t("div",{class:"settings__item-label mt-1"},[o(" 一部 Windows 環境では localhost の名前解決が遅いため、ストリーミング開始までの待機時間が長くなる場合があります。 Mirakurun / mirakc と同じ PC に KonomiTV をインストールしている場合、localhost ではなく 127.0.0.1 の利用を推奨します。"),t("br")],-1)),n(K,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",density:E(i)?"compact":"default",modelValue:s.value.general.mirakurun_url,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.general.mirakurun_url=l)},null,8,["density","modelValue"])]),t("div",et,[e[35]||(e[35]=t("div",{class:"settings__item-heading"},"利用するエンコーダー",-1)),e[36]||(e[36]=t("div",{class:"settings__item-label"},[o(" FFmpeg はソフトウェアエンコーダーです。"),t("br"),o(" すべての PC で利用できますが、CPU に多大な負荷がかかり、パフォーマンスが悪いです。"),t("br")],-1)),e[37]||(e[37]=t("div",{class:"settings__item-label mt-1"},[o(" QSVEncC・NVEncC・VCEEncC・rkmppenc はハードウェアエンコーダーです。"),t("br"),o(" CPU 負荷が低く、パフォーマンスがとても高いです（おすすめ）。"),t("br")],-1)),n(Y,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",density:E(i)?"compact":"default",items:[{title:"FFmpeg : ソフトウェアエンコーダー",value:"FFmpeg"},{title:"QSVEncC : Intel Graphics 搭載 CPU / Intel Arc GPU で利用可能",value:"QSVEncC"},{title:"NVEncC : NVIDIA GPU で利用可能",value:"NVEncC"},{title:"VCEEncC : AMD GPU で利用可能",value:"VCEEncC"},{title:"rkmppenc : Rockchip RK3588 系 SoC 搭載 SBC で利用可能",value:"rkmppenc"}],modelValue:s.value.general.encoder,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.general.encoder=l)},null,8,["density","modelValue"])]),t("div",tt,[e[38]||(e[38]=t("div",{class:"settings__item-heading"},"番組情報の更新間隔 (分)",-1)),e[39]||(e[39]=t("div",{class:"settings__item-label"},[o(" 番組情報を EDCB または Mirakurun / mirakc から取得する間隔を設定します。デフォルトは 5 (分) です。"),t("br")],-1)),n(de,{class:"settings__item-form",color:"primary","show-ticks":"always","thumb-label":"","hide-details":"",min:.5,max:60,step:.5,density:E(i)?"compact":"default",modelValue:s.value.general.program_update_interval,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.general.program_update_interval=l)},null,8,["density","modelValue"])]),t("div",st,[e[40]||(e[40]=t("label",{class:"settings__item-heading",for:"debug"},"デバッグモードを有効にする",-1)),e[41]||(e[41]=t("label",{class:"settings__item-label",for:"debug"},[o(" 有効にすると、デバッグログも出力されるようになります。"),t("br")],-1)),n(Z,{class:"settings__item-switch",color:"primary",id:"debug","hide-details":"",modelValue:s.value.general.debug,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.general.debug=l)},null,8,["modelValue"])]),t("div",lt,[e[42]||(e[42]=t("label",{class:"settings__item-heading",for:"debug_encoder"},"エンコーダーのログを有効にする",-1)),e[43]||(e[43]=t("label",{class:"settings__item-label",for:"debug_encoder"},[o(" 有効にすると、ライブ視聴時のエンコーダーのログが KonomiTV/server/logs/ 以下に保存されます。"),t("br"),o(" さらにデバッグモード有効時は、サーバーログにエンコーダーのログがリアルタイム出力されます。"),t("br")],-1)),n(Z,{class:"settings__item-switch",color:"primary",id:"debug_encoder","hide-details":"",modelValue:s.value.general.debug_encoder,"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.general.debug_encoder=l)},null,8,["modelValue"])]),t("div",nt,[n(a,{icon:"fluent:server-surface-16-filled",width:"22px"}),e[44]||(e[44]=t("span",{class:"ml-2"},"サーバー",-1))]),t("div",it,[e[45]||(e[45]=t("div",{class:"settings__item-heading"},"KonomiTV サーバーのリッスンポート",-1)),e[46]||(e[46]=t("div",{class:"settings__item-label"},[o(" デフォルトのリッスンポートは 7000 です。"),t("br")],-1)),n(K,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",density:E(i)?"compact":"default",modelValue:s.value.server.port,"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.server.port=l)},null,8,["density","modelValue"])]),t("div",at,[e[47]||(e[47]=t("div",{class:"settings__item-heading"},"HTTPS リバースプロキシのカスタム HTTPS 証明書/秘密鍵ファイルへの絶対パス",-1)),e[48]||(e[48]=t("div",{class:"settings__item-label"},[o(" 設定すると、カスタム HTTPS 証明書を使って HTTPS リバースプロキシを開始します。"),t("br"),o(" カスタム HTTPS 証明書を有効化すると、https://192-168-x-xx.local.konomi.tv:7000/ の URL では KonomiTV にアクセスできなくなります。"),t("br"),o(" 基本空欄のままで問題ありません。HTTPS 証明書について詳細に理解している方のみ設定してください。"),t("br")],-1)),n(K,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",label:"例: C:\\path\\to\\cert.pem",density:E(i)?"compact":"default",modelValue:s.value.server.custom_https_certificate,"onUpdate:modelValue":e[9]||(e[9]=l=>s.value.server.custom_https_certificate=l)},null,8,["density","modelValue"]),n(K,{class:"settings__item-form",color:"primary",variant:"outlined","hide-details":"",label:"例: C:\\path\\to\\key.pem",density:E(i)?"compact":"default",modelValue:s.value.server.custom_https_private_key,"onUpdate:modelValue":e[10]||(e[10]=l=>s.value.server.custom_https_private_key=l)},null,8,["density","modelValue"])]),t("div",ot,[n(a,{icon:"fluent:tv-20-filled",width:"22px"}),e[49]||(e[49]=t("span",{class:"ml-2"},"テレビのライブストリーミング",-1))]),t("div",rt,[e[50]||(e[50]=t("label",{class:"settings__item-heading",for:"always_receive_tv_from_mirakurun"},"常に Mirakurun / mirakc から放送波を受信する",-1)),e[51]||(e[51]=t("label",{class:"settings__item-label",for:"always_receive_tv_from_mirakurun"},[o(" 利用するバックエンドが EDCB のとき、常に Mirakurun / mirakc から放送波を受信するかを設定します。 バックエンドに Mirakurun が選択されているときは効果がありません。"),t("br")],-1)),e[52]||(e[52]=t("label",{class:"settings__item-label mt-1",for:"always_receive_tv_from_mirakurun"},[o(" KonomiTV から EDCB と Mirakurun / mirakc 両方にアクセスできる必要があります。"),t("br"),o(" EDCB はチューナー起動やチャンネル切り替えに時間がかかるため、Mirakurun / mirakc が利用できる環境であれば、この設定を有効にするとより快適に使えます。"),t("br")],-1)),n(Z,{class:"settings__item-switch",color:"primary",id:"always_receive_tv_from_mirakurun","hide-details":"",modelValue:s.value.general.always_receive_tv_from_mirakurun,"onUpdate:modelValue":e[11]||(e[11]=l=>s.value.general.always_receive_tv_from_mirakurun=l)},null,8,["modelValue"])]),t("div",dt,[e[53]||(e[53]=t("div",{class:"settings__item-heading"},"誰も見ていないチャンネルのエンコードタスクを維持する秒数",-1)),e[54]||(e[54]=t("div",{class:"settings__item-label"},[o(" 10 秒に設定したなら、10 秒間誰も見ていない状態が継続したらエンコードタスク（エンコーダー）を終了します。"),t("br")],-1)),e[55]||(e[55]=t("div",{class:"settings__item-label mt-1"},[o(" 0 秒に設定すると、ネット回線が瞬断したりリロードしただけでチューナーとエンコーダーの再起動が必要になり、再生復帰までに時間がかかります。余裕をもたせておく事をおすすめします。"),t("br")],-1)),n(de,{class:"settings__item-form",color:"primary","show-ticks":"always","thumb-label":"","hide-details":"",min:0,max:60,step:1,density:E(i)?"compact":"default",modelValue:s.value.tv.max_alive_time,"onUpdate:modelValue":e[12]||(e[12]=l=>s.value.tv.max_alive_time=l)},null,8,["density","modelValue"])]),t("div",ut,[n(a,{icon:"fluent:movies-and-tv-20-filled",width:"22px"}),e[56]||(e[56]=t("span",{class:"ml-2"},"ビデオのオンデマンドストリーミング",-1))]),t("div",mt,[e[59]||(e[59]=t("div",{class:"settings__item-heading"},"録画済み番組の保存先フォルダの絶対パス",-1)),e[60]||(e[60]=t("div",{class:"settings__item-label",style:{"padding-bottom":"2px"}},[o(" 指定フォルダ以下に保存されている MPEG-TS 形式の録画ファイルを KonomiTV サーバーが自動的に見つけ出し、メタデータの解析とサムネイルの作成を行います。"),t("br"),o(" 解析が完了すると、録画番組一覧から再生できるようになります。"),t("br")],-1)),e[61]||(e[61]=t("div",{class:"settings__item-label mt-1",style:{"padding-bottom":"2px"}},[o(" 複数の保存先フォルダを指定できます。フォルダやファイルのシンボリックリンクにも対応しています。"),t("br"),o(" シンボリックリンクは実体のパスに変換されるため、同じ録画ファイルが重複スキャンされることはありません。"),t("br")],-1)),(C(!0),$(j,null,z(s.value.video.recorded_folders,(l,b)=>(C(),$("div",{key:"recorded-folder-"+b},[t("div",vt,[n(K,{class:"settings__item-form mt-0",color:"primary",variant:"outlined","hide-details":"",placeholder:"例: E:\\TV-Record",density:E(i)?"compact":"default",modelValue:s.value.video.recorded_folders[b],"onUpdate:modelValue":m=>s.value.video.recorded_folders[b]=m},null,8,["density","modelValue","onUpdate:modelValue"]),O((C(),$("button",{class:"settings__item-delete-button",onClick:m=>s.value.video.recorded_folders.splice(b,1)},[...e[57]||(e[57]=[t("svg",{class:"iconify iconify--fluent",width:"20px",height:"20px",viewBox:"0 0 16 16"},[t("path",{fill:"currentColor",d:"M7 3h2a1 1 0 0 0-2 0ZM6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1h4Zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0v-5ZM9.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 1 0v-5a.5.5 0 0 0-.5-.5Z"})],-1)])],8,ct)),[[N]])])]))),128)),n(I,{class:"mt-3",color:"background-lighten-2",variant:"flat",height:"40px",onClick:e[13]||(e[13]=l=>s.value.video.recorded_folders.push(""))},{default:v(()=>[n(a,{icon:"fluent:add-12-filled",height:"17px"}),e[58]||(e[58]=t("span",{class:"ml-1"},"保存先フォルダを追加",-1))]),_:1})]),t("div",gt,[n(a,{icon:"fluent:image-multiple-16-filled",width:"22px"}),e[62]||(e[62]=t("span",{class:"ml-2"},"キャプチャ",-1))]),t("div",ft,[e[68]||(e[68]=t("div",{class:"settings__item-heading"},"アップロードしたキャプチャ画像の保存先フォルダの絶対パス",-1)),t("div",pt,[n(T,{class:"link",to:"/settings/capture"},{default:v(()=>[...e[63]||(e[63]=[o("[キャプチャ]",-1)])]),_:1}),e[64]||(e[64]=o(" → [キャプチャの保存先] で [KonomiTV サーバーにアップロード] または [ブラウザでのダウンロードと、KonomiTV サーバーへのアップロードを両方行う] が選択されているときに利用されます。",-1)),e[65]||(e[65]=t("br",null,null,-1))]),e[69]||(e[69]=t("div",{class:"settings__item-label mt-1",style:{"padding-bottom":"2px"}},[o(" 複数の保存先フォルダを指定できます。"),t("br"),o(" 先頭から順に利用され、保存先フォルダがいっぱいになったら次の保存先フォルダに保存されます。"),t("br")],-1)),(C(!0),$(j,null,z(s.value.capture.upload_folders,(l,b)=>(C(),$("div",{key:"upload-folder-"+b},[t("div",_t,[n(K,{class:"settings__item-form mt-0",color:"primary",variant:"outlined","hide-details":"",placeholder:"例: E:\\TV-Capture",density:E(i)?"compact":"default",modelValue:s.value.capture.upload_folders[b],"onUpdate:modelValue":m=>s.value.capture.upload_folders[b]=m},null,8,["density","modelValue","onUpdate:modelValue"]),O((C(),$("button",{class:"settings__item-delete-button",onClick:m=>s.value.capture.upload_folders.splice(b,1)},[...e[66]||(e[66]=[t("svg",{class:"iconify iconify--fluent",width:"20px",height:"20px",viewBox:"0 0 16 16"},[t("path",{fill:"currentColor",d:"M7 3h2a1 1 0 0 0-2 0ZM6 3a2 2 0 1 1 4 0h4a.5.5 0 0 1 0 1h-.564l-1.205 8.838A2.5 2.5 0 0 1 9.754 15H6.246a2.5 2.5 0 0 1-2.477-2.162L2.564 4H2a.5.5 0 0 1 0-1h4Zm1 3.5a.5.5 0 0 0-1 0v5a.5.5 0 0 0 1 0v-5ZM9.5 6a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 1 0v-5a.5.5 0 0 0-.5-.5Z"})],-1)])],8,bt)),[[N]])])]))),128)),n(I,{class:"mt-3",color:"background-lighten-2",variant:"flat",height:"40px",onClick:e[14]||(e[14]=l=>s.value.capture.upload_folders.push(""))},{default:v(()=>[n(a,{icon:"fluent:add-12-filled",height:"17px"}),e[67]||(e[67]=t("span",{class:"ml-1"},"保存先フォルダを追加",-1))]),_:1})]),n(I,{class:"settings__save-button bg-secondary mt-6",variant:"flat",onClick:e[15]||(e[15]=l=>w())},{default:v(()=>[n(a,{icon:"fluent:save-16-filled",class:"mr-2",height:"23px"}),e[70]||(e[70]=o("サーバー設定を更新 ",-1))]),_:1}),t("div",Vt,[n(a,{icon:"fluent:person-board-20-filled",width:"22px"}),e[71]||(e[71]=t("span",{class:"ml-2"},"アカウント",-1))]),t("div",yt,[e[76]||(e[76]=t("div",{class:"settings__item-heading"},"アカウントの管理",-1)),e[77]||(e[77]=t("div",{class:"settings__item-label"},[o(" 現在 KonomiTV に登録されているすべてのアカウントの一覧の確認、管理者権限の付与/剥奪、アカウントの削除ができます。"),t("br")],-1)),t("div",kt,[e[73]||(e[73]=o(" ログイン中ユーザーの設定変更は、別途 ",-1)),n(T,{class:"link",to:"/settings/account"},{default:v(()=>[...e[72]||(e[72]=[o("アカウント設定画面",-1)])]),_:1}),e[74]||(e[74]=o(" から行ってください。",-1)),e[75]||(e[75]=t("br",null,null,-1))])]),n(I,{class:"settings__save-button mt-4",variant:"flat",onClick:e[16]||(e[16]=l=>r.value=!r.value)},{default:v(()=>[n(a,{icon:"fluent:person-board-20-filled",height:"20px"}),e[78]||(e[78]=t("span",{class:"ml-1"},"アカウントの管理設定を開く",-1))]),_:1})],2),t("div",wt,[t("div",xt,[n(a,{icon:"fluent:wrench-settings-20-filled",width:"22px"}),e[79]||(e[79]=t("span",{class:"ml-2"},"メンテナンス",-1))])]),t("div",{class:R(["settings__content",{"settings__content--disabled":d.value}])},[e[81]||(e[81]=t("div",{class:"settings__item"},[t("div",{class:"settings__item-heading"},"サーバーログの表示"),t("div",{class:"settings__item-label"},[o(" KonomiTV サーバーの動作ログとアクセスログをリアルタイムで表示します。"),t("br"),o(" サーバーの動作状況の確認やトラブルシューティングに役立ちます。"),t("br")])],-1)),n(I,{class:"settings__save-button mt-5",color:"background-lighten-2",variant:"flat",onClick:e[17]||(e[17]=l=>_.value=!_.value)},{default:v(()=>[n(a,{icon:"fluent:document-text-16-regular",height:"20px"}),e[80]||(e[80]=t("span",{class:"ml-2"},"サーバーログを表示",-1))]),_:1})],2),t("div",Tt,[e[85]||(e[85]=t("div",{class:"settings__item"},[t("div",{class:"settings__item-heading"},"KonomiTV のデータベースを更新"),t("div",{class:"settings__item-label"},[o(" KonomiTV のデータベースに保存されている、チャンネル情報・番組情報・Twitter アカウント情報などの外部 API に依存するデータをすべて更新します。"),t("br"),o(" 即座に外部 API からのデータ更新を反映させたいときに利用してください。"),t("br")])],-1)),n(I,{class:"settings__save-button mt-5",color:"background-lighten-2",variant:"flat",onClick:e[18]||(e[18]=l=>p())},{default:v(()=>[n(a,{icon:"iconoir:database-backup",height:"20px"}),e[82]||(e[82]=t("span",{class:"ml-2"},"データベースを更新",-1))]),_:1}),e[86]||(e[86]=t("div",{class:"settings__item"},[t("div",{class:"settings__item-heading"},"録画フォルダの一括スキャンを手動実行"),t("div",{class:"settings__item-label"},[o(" 録画フォルダ内のファイルは、通常 KonomiTV サーバーの起動時に自動的にスキャンされます。"),t("br"),o(" 録画ファイルが KonomiTV に正しく反映されていない場合にのみ実行してみてください。"),t("br")]),t("div",{class:"settings__item-label mt-1"},[t("strong",null,"大量の録画ファイルが保存されている環境では、処理完了まで数時間〜数日以上かかることがあります。"),t("br")])],-1)),n(I,{class:"settings__save-button mt-5",color:"background-lighten-2",variant:"flat",onClick:e[19]||(e[19]=l=>y())},{default:v(()=>[n(a,{icon:"fluent:folder-sync-20-regular",height:"20px"}),e[83]||(e[83]=t("span",{class:"ml-2"},"録画フォルダの一括スキャンを手動実行",-1))]),_:1}),e[87]||(e[87]=t("div",{class:"settings__item"},[t("div",{class:"settings__item-heading"},"録画ファイルのバックグラウンド解析タスクを再実行"),t("div",{class:"settings__item-label"},[o(" 録画ファイルのメタデータ解析やサムネイル作成が完了していない場合に、これらの処理を再度実行します。"),t("br"),o(" PC のシャットダウンなどで途中で中断してしまった場合は、このボタンから処理を再開できます。"),t("br")]),t("div",{class:"settings__item-label mt-1"},[t("strong",null,"大量の録画ファイルが保存されている環境では、処理完了まで数時間〜数日以上かかることがあります。"),t("br")])],-1)),n(I,{class:"settings__save-button mt-5",color:"background-lighten-2",variant:"flat",onClick:e[20]||(e[20]=l=>k())},{default:v(()=>[n(a,{icon:"fluent:book-arrow-clockwise-20-regular",height:"20px"}),e[84]||(e[84]=t("span",{class:"ml-2"},"バックグラウンド解析タスクを再実行",-1))]),_:1})]),t("div",{class:R(["settings__content",{"settings__content--disabled":d.value}])},[e[90]||(e[90]=t("div",{class:"settings__item"},[t("div",{class:"settings__item-heading text-error-lighten-1"},"KonomiTV サーバーを再起動"),t("div",{class:"settings__item-label"},[o(" KonomiTV サーバーを再起動します。サーバー設定の変更を反映するには再起動が必要です。"),t("br"),t("strong",null,"再起動を実行すると、すべての視聴中セッションが切断されます。"),o("十分注意してください。"),t("br")])],-1)),n(I,{class:"settings__save-button bg-error mt-5",variant:"flat",onClick:e[21]||(e[21]=l=>x())},{default:v(()=>[n(a,{icon:"fluent:arrow-counterclockwise-20-filled",height:"20px"}),e[88]||(e[88]=t("span",{class:"ml-2"},"KonomiTV サーバーを再起動",-1))]),_:1}),e[91]||(e[91]=t("div",{class:"settings__item"},[t("div",{class:"settings__item-heading text-error-lighten-1"},"KonomiTV サーバーをシャットダウン"),t("div",{class:"settings__item-label"},[o(" KonomiTV サーバーをシャットダウンします。"),t("br"),t("strong",null,"シャットダウンを実行すると、再度手動で KonomiTV サーバーを起動するまで KonomiTV にアクセスできなくなります。"),o("十分注意してください。"),t("br")]),t("div",{class:"settings__item-label mt-1"},[o(" なお、Linux 版 KonomiTV サーバーはプロセス管理を PM2 / Docker に委譲しているため、シャットダウン後は自動で再起動されます。完全にシャットダウンするには、PM2 / Docker 側でサービスを停止してください。"),t("br")])],-1)),n(I,{class:"settings__save-button bg-error mt-5",variant:"flat",onClick:e[22]||(e[22]=l=>M())},{default:v(()=>[n(a,{icon:"fluent:power-20-filled",height:"20px"}),e[89]||(e[89]=t("span",{class:"ml-2"},"KonomiTV サーバーをシャットダウン",-1))]),_:1})],2),n(Ie,{modelValue:r.value,"onUpdate:modelValue":e[23]||(e[23]=l=>r.value=l)},null,8,["modelValue"]),n(ze,{modelValue:_.value,"onUpdate:modelValue":e[24]||(e[24]=l=>_.value=l)},null,8,["modelValue"])]),_:1})}}});export{Rt as default};
