import{aC as h}from"./SnackbarsStore-Buj_rJWA.js";import{m as y}from"./mpegts-Do4znBaD.js";const f=document.getElementById("wrap"),b=document.getElementById("chlist"),w=document.getElementById("control"),m=document.getElementById("volumebutton"),L=document.getElementById("keepshowsw"),p=document.getElementById("fsbutton"),T=()=>{let e=0,l=0;const o=()=>{clearTimeout(e),clearTimeout(l),f.classList.remove("hide-ui"),f.classList.remove("hide-info"),e=setTimeout(()=>{f.classList.add("hide-ui"),!L.checked&&(l=setTimeout(()=>{f.classList.add("hide-info")},3e3))},3e3)};window.addEventListener("pointerdown",o),window.addEventListener("pointermove",o),window.addEventListener("scroll",o),L.addEventListener("change",o),window.addEventListener("keydown",t=>{switch(t.key){case"A":case"a":m.click();break;case"F":case"f":p.click();break;case"ArrowUp":u(-3);break;case"ArrowLeft":u(-1);break;case"ArrowRight":u(1);break;case"ArrowDown":u(3);break}o()}),m.addEventListener("click",()=>u("toggle-all")),window.addEventListener("scroll",()=>{function t(){const s=window.document.body,c=window.document.documentElement,a=s.scrollTop||c.scrollTop;return c.scrollHeight-window.innerHeight-a}t()<=10?w.classList.add("slide"):w.classList.remove("slide")}),o()},E=async()=>{v=await fetch(`${h.getApiBaseUrl()}/channels`).then(e=>(e.status!==200&&console.log("error or no content",e.status),e.json())).catch(e=>(console.error("Failed to load",e),null))},k=()=>v==null?void 0:v.GR,_=()=>k().filter(e=>e.is_display===!0);let v;(async()=>await E())();const g=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),u=e=>{const l=i.filter(a=>!a.video.muted),o=l.length===0,t=l.length===i.length,s=Array(i.length).fill(!0);if(e==="all")s.fill(!1);else if(e==="toggle-all")t||s.fill(!1);else if(typeof e=="number")if(o)s[0]=!1;else{let r=(l[0].index+e)%i.length;r<0&&(r=i.length+r),s[r]=!1}else if(typeof e=="object"){const a=e;(t||a.video.muted)&&(s[a.index]=!1)}i.forEach((a,n)=>{a.video.muted=s[n]}),i.filter(a=>!a.video.muted).length===1?b.classList.add("choiced"):b.classList.remove("choiced")},i=[];_().forEach((e,l)=>{var c;const o=`<div class="chframe">
        <video playsinline controlsList="noremoteplayback"></video>
        <div class="broadcast-wrap">
            <div class="broadcast-channel-box">
                <span class="broadcast-channel">${e.remocon_id}</span>
                <img class="broadcast-logo" src="${h.getApiBaseUrl()}/channels/${e.id}/logo" alt="${e.name}">
            </div>
            <div class="broadcast-title">
                <span class="broadcast-title-id">${((c=e.program_present)==null?void 0:c.title)??"(情報なし)"}</span>
                <div class="broadcast-time">
                    <span class="broadcast-start">${e.program_present?g(e.program_present.start_time):"--:--"}</span>
                    <span class="broadcast-to">～</span>
                    <span class="broadcast-end">${e.program_present?g(e.program_present.end_time):"--:--"}</span>
                </div>
            </div>
        </div>
        <div class="control">
            <button type="button" class="reload btn" title="再読み込み"><i class="material-icons">refresh</i></button>
        </div>
    </div>
    `;b.insertAdjacentHTML("beforeend",o);const t=b.lastElementChild,s={chFrame:t,index:l,video:t.querySelector("video"),reloadButton:t.querySelector(".reload"),broadcastTitle:t.querySelector(".broadcast-title"),title:t.querySelector(".broadcast-title-id"),startTime:t.querySelector(".broadcast-start"),endTime:t.querySelector(".broadcast-end")};if(i.push(s),t.addEventListener("click",()=>u(s)),s.video.addEventListener("volumechange",a=>{a.target.muted?t.classList.remove("listening"):t.classList.add("listening");const n=i.some(d=>!d.video.muted),r=i.every(d=>!d.video.muted);n?(m.innerHTML='<i class="material-icons">volume_up</i>',r?m.title="ミュートする":m.title="全ch聴く"):(m.innerHTML='<i class="material-icons">volume_off</i>',m.title="全ch聴く")}),y.getFeatureList().mseLivePlayback){const a=`${h.getApiBaseUrl()}/streams/live/${e.display_channel_id}/360p/mpegts`,n=y.createPlayer({type:"mse",isLive:!0,url:a});n.attachMediaElement(s.video),s.reloadButton.addEventListener("click",r=>{if(r.stopPropagation(),n.unload(),r.shiftKey){alert("Shiftキーを押しながらクリックしたため、読み込み停止をしました。");return}n.load(),n.play()}),n.load(),n.play().then(()=>{u("all")}).catch(()=>{n.muted=!0,n.play()})}});T();setInterval(async()=>{await E(),_().forEach((e,l)=>{var n,r;const o=i[l],t={title:o.title,startTime:o.startTime,endTime:o.endTime},s=Object.values(t).map(d=>d.textContent),c=[((n=e.program_present)==null?void 0:n.title)??"(情報なし)",e.program_present?g(e.program_present.start_time):"--:--",e.program_present?g(e.program_present.end_time):"--:--"];if(s.toString()!==c.toString()){const d=`<span class="broadcast-title-id">${((r=e.program_present)==null?void 0:r.title)??"(情報なし)"}</span>
                <div class="broadcast-time">
                    <span class="broadcast-start">${e.program_present?g(e.program_present.start_time):"--:--"}</span>
                    <span class="broadcast-to">～</span>
                    <span class="broadcast-end">${e.program_present?g(e.program_present.end_time):"--:--"}</span>
                </div>
            </div>`;o.broadcastTitle.innerHTML=d}})},30*1e3);p.addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen().catch(e=>{alert("ご利用のブラウザは全画面表示に対応していません"+e.name)})});const F=()=>{document.fullscreenElement?(screen.orientation.lock("landscape").catch(()=>{}),p.innerHTML='<i class="material-icons">fullscreen_exit</i>',p.title="全画面表示を終了"):(screen.orientation.unlock&&screen.orientation.unlock(),p.innerHTML='<i class="material-icons">fullscreen</i>',p.title="全画面表示")};document.addEventListener("fullscreenchange",F);
