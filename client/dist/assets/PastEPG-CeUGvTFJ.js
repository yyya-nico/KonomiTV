import{a as L,R as P,_ as E,u as T}from"./top-uzWCSzPo.js";import{V as I,B as $}from"./VPagination-B7dM6L2m.js";import{H as C,N}from"./Navigation-CG9pVYcy.js";import{I as H,V as m,N as f,ah as b,a4 as l,a5 as y,aw as s,a3 as D,p as _,a1 as S,ay as h,ac as M,F as k,a8 as B,Z as R,a7 as q,ax as G,ad as z,_ as r,M as F}from"./SnackbarsStore-Buj_rJWA.js";import{V as U}from"./Videos-D7fTiRjA.js";import"./logo-B_6dj-cp.js";import"./ssrBoot-Rwtrc-Q1.js";import"./VersionStore-fcAF5g0F.js";const j={class:"past-epg-viewer"},O={key:0,class:"past-epg-viewer__header"},Z={class:"past-epg-viewer__title"},x={class:"past-epg-viewer__title-text"},A={key:1,class:"past-epg-viewer__pagination"},J={class:"past-epg-viewer__empty-content"},K=["innerHTML"],W=["innerHTML"],X={id:"epg-container"},Y={id:"channels"},Q={id:"times"},ee={id:"schedule"},te={class:"start-time"},ae=H({__name:"PastEPGViewer",props:{title:{},programs:{},total:{},page:{default:1},hideHeader:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:warning-20-regular"},emptyMessage:{default:"録画番組が見つかりませんでした。"},emptySubMessage:{default:'サーバー設定で録画フォルダのパスを<br class="d-sm-none">正しく設定できているか確認してください。'},isLoading:{type:Boolean,default:!1}},emits:["update:page"],setup(V){L();const i=V,g=m(i.page),n=m([...i.programs]),d=m(i.total);f(()=>i.page,e=>{g.value=e}),f(()=>i.programs,e=>{n.value=[...e]}),f(()=>i.total,e=>{d.value=e});const p=b(()=>[...new Set(n.value.toSorted((e,t)=>e.channel&&t.channel?e.channel.remocon_id-t.channel.remocon_id:0).map(e=>{var t;return(t=e.channel)==null?void 0:t.name}))]),c=b(()=>{if(n.value.length===0)return[];const e=new Date(n.value.reduce((o,a)=>new Date(o.start_time)<new Date(a.start_time)?o:a).start_time),t=new Date(n.value.reduce((o,a)=>new Date(o.end_time)>new Date(a.end_time)?o:a).end_time),u=[];for(let o=new Date(e.setMinutes(0,0,0));o<=t;o.setHours(o.getHours()+1))u.push(new Date(o));return u}),w=e=>{var t;switch((t=e.genres[0])==null?void 0:t.major){case"スポーツ":return"genre_sports";case"ドラマ":return"genre_drama";case"音楽":return"genre_music";case"映画":return"genre_movie";case"アニメ・特撮":return"genre_anime";default:return"genre_none"}};return(e,t)=>{const u=S("Icon"),o=S("router-link");return r(),l("div",j,[e.hideHeader?y("",!0):(r(),l("div",O,[s("h2",Z,[e.showBackButton?D((r(),l("div",{key:0,class:"past-epg-viewer__title-back",onClick:t[0]||(t[0]=a=>e.$router.back())},[_(u,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[P]]):y("",!0),s("span",x,h(e.title),1)])])),!e.hidePagination&&d.value>0?(r(),l("div",A,[_(I,{modelValue:g.value,"onUpdate:modelValue":[t[1]||(t[1]=a=>g.value=a),t[2]||(t[2]=a=>e.$emit("update:page",a))],"active-color":"primary",density:"comfortable",length:Math.ceil(d.value/90),"total-visible":7},null,8,["modelValue","length"])])):y("",!0),s("div",{class:M(["past-epg-viewer__grid",{"past-epg-viewer__grid--loading":e.isLoading,"past-epg-viewer__grid--empty":d.value===0&&e.showEmptyMessage}])},[s("div",{class:M(["past-epg-viewer__empty",{"past-epg-viewer__empty--show":d.value===0&&e.showEmptyMessage}])},[s("div",J,[_(u,{class:"past-epg-viewer__empty-icon",icon:e.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),s("h2",{innerHTML:e.emptyMessage},null,8,K),e.emptySubMessage?(r(),l("div",{key:0,class:"past-epg-viewer__empty-submessage",innerHTML:e.emptySubMessage},null,8,W)):y("",!0)])],2),s("div",X,[s("div",Y,[t[3]||(t[3]=s("div",{class:"dummy"},null,-1)),(r(!0),l(k,null,B(p.value,a=>(r(),l("div",{key:a,class:"channel-name"},h(a),1))),128))]),s("div",Q,[(r(!0),l(k,null,B(c.value,(a,v)=>(r(),l("div",{key:v,class:"time-label"},h(a.getHours()===0||v===0?a.toLocaleString([],{month:"numeric",day:"numeric",weekday:"short",hour:"numeric"}):a.toLocaleTimeString([],{hour:"numeric"})),1))),128))]),s("div",ee,[(r(!0),l(k,null,B(n.value,a=>{var v;return D((r(),R(o,{class:M(["program",["program",w(a)]]),key:a.id,title:a.title,style:z({gridColumn:p.value.indexOf((v=a.channel)==null?void 0:v.name)+1,gridRowStart:Math.floor((new Date(a.start_time).getTime()-new Date(c.value[0]).getTime())/(60*1e3))+1,gridRowEnd:`span ${Math.ceil(a.duration/60)}`}),to:a.recorded_video.status==="Recording"||!a.recorded_video.has_key_frames?{path:""}:`/videos/watch/${a.id}`},{default:q(()=>[s("div",te,h(new Date(a.start_time).getMinutes().toString().padStart(2,"0")),1),G(" "+h(a.title),1)]),_:2},1032,["title","class","style","to"])),[[P]])}),128))])])],2)])}}}),se=E(ae,[["__scopeId","data-v-46e2024c"]]),ne={class:"route-container"},oe={class:"pastepg-container-wrapper"},re={class:"pastepg-container"},ie=H({__name:"PastEPG",setup(V){const i=T(),g=L(),n=m([]),d=m(1/0),p=m(!0),c=m(1),w=async()=>{n.value=[];for(let t=(c.value-1)*3+1;t<=c.value*3;t++){const u=await U.fetchVideos("desc",t);u&&(n.value=[...n.value,...u.recorded_programs],d.value=u.total)}n.value=n.value.reverse(),p.value=!1},e=async t=>{c.value=t,p.value=!0,await g.replace({query:{...i.query,page:t.toString()}})};return f(()=>i.query,async t=>{t.page&&(c.value=parseInt(t.page)),await w()},{deep:!0}),F(async()=>{i.query.page&&(c.value=parseInt(i.query.page)),await w()}),(t,u)=>(r(),l("div",ne,[_(C),s("main",null,[_(N),s("div",oe,[s("div",re,[_($,{crumbs:[{name:"ホーム",path:"/"},{name:"過去番組表",path:"/pastepg/",disabled:!0}]}),_(se,{title:"過去番組表",programs:n.value,total:d.value,isLoading:p.value,showBackButton:!0,showEmptyMessage:!p.value,"onUpdate:page":e},null,8,["programs","total","isLoading","showEmptyMessage"])])])])]))}}),ve=E(ie,[["__scopeId","data-v-adfd710b"]]);export{ve as default};
