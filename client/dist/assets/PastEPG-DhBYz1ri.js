import{a as E,R as P,_ as H,u as D}from"./top-BBoHVxKv.js";import{V as I,B as $}from"./VPagination-BWtqEOnZ.js";import{H as C,N}from"./Navigation-KZu7F7W5.js";import{I as T,V as m,N as f,ah as S,a4 as l,a5 as w,aw as s,a3 as b,p as _,a1 as L,ay as g,ac as M,F as k,a8 as B,Z as R,a7 as q,ax as G,ad as z,_ as r,M as F}from"./SnackbarsStore-Buj_rJWA.js";import{V as U}from"./Videos-D7fTiRjA.js";import"./logo-c9ONfmW5.js";import"./ssrBoot-lAuKXnyx.js";import"./VersionStore-fcAF5g0F.js";const j={class:"past-epg-viewer"},O={key:0,class:"past-epg-viewer__header"},Z={class:"past-epg-viewer__title"},x={class:"past-epg-viewer__title-text"},A={key:1,class:"past-epg-viewer__pagination"},J={class:"past-epg-viewer__empty-content"},K=["innerHTML"],W=["innerHTML"],X={class:"past-epg-viewer__grid-content"},Y={id:"epg-container"},Q={id:"channels"},ee={id:"times"},te={id:"schedule"},ae={class:"program-title"},se={class:"program-start-time"},ne={class:"program-description"},oe=T({__name:"PastEPGViewer",props:{title:{},programs:{},total:{},page:{default:1},hideHeader:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:warning-20-regular"},emptyMessage:{default:"録画番組が見つかりませんでした。"},emptySubMessage:{default:'サーバー設定で録画フォルダのパスを<br class="d-sm-none">正しく設定できているか確認してください。'},isLoading:{type:Boolean,default:!1}},emits:["update:page"],setup(V){E();const i=V,v=m(i.page),o=m([...i.programs]),c=m(i.total);f(()=>i.page,e=>{v.value=e}),f(()=>i.programs,e=>{o.value=[...e]}),f(()=>i.total,e=>{c.value=e});const p=S(()=>[...new Set(o.value.toSorted((e,t)=>e.channel&&t.channel?e.channel.remocon_id-t.channel.remocon_id:0).map(e=>{var t;return(t=e.channel)==null?void 0:t.name}))]),d=S(()=>{if(o.value.length===0)return[];const e=o.value.map(n=>new Date(n.start_time)).reduce((n,a)=>n<a?n:a),t=o.value.map(n=>new Date(n.end_time)).reduce((n,a)=>n>a?n:a),u=[];for(let n=new Date(e.setMinutes(0,0,0));n<=t;n.setHours(n.getHours()+1))u.push(new Date(n));return u}),y=e=>{var t;switch((t=e.genres[0])==null?void 0:t.major){case"スポーツ":return"genre_sports";case"ドラマ":return"genre_drama";case"音楽":return"genre_music";case"映画":return"genre_movie";case"アニメ・特撮":return"genre_anime";default:return"genre_none"}};return(e,t)=>{const u=L("Icon"),n=L("router-link");return r(),l("div",j,[e.hideHeader?w("",!0):(r(),l("div",O,[s("h2",Z,[e.showBackButton?b((r(),l("div",{key:0,class:"past-epg-viewer__title-back",onClick:t[0]||(t[0]=a=>e.$router.back())},[_(u,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[P]]):w("",!0),s("span",x,g(e.title),1)])])),!e.hidePagination&&c.value>0?(r(),l("div",A,[_(I,{modelValue:v.value,"onUpdate:modelValue":[t[1]||(t[1]=a=>v.value=a),t[2]||(t[2]=a=>e.$emit("update:page",a))],"active-color":"primary",density:"comfortable",length:Math.ceil(c.value/90),"total-visible":7},null,8,["modelValue","length"])])):w("",!0),s("div",{class:M(["past-epg-viewer__grid",{"past-epg-viewer__grid--loading":e.isLoading,"past-epg-viewer__grid--empty":c.value===0&&e.showEmptyMessage}])},[s("div",{class:M(["past-epg-viewer__empty",{"past-epg-viewer__empty--show":c.value===0&&e.showEmptyMessage}])},[s("div",J,[_(u,{class:"past-epg-viewer__empty-icon",icon:e.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),s("h2",{innerHTML:e.emptyMessage},null,8,K),e.emptySubMessage?(r(),l("div",{key:0,class:"past-epg-viewer__empty-submessage",innerHTML:e.emptySubMessage},null,8,W)):w("",!0)])],2),s("div",X,[s("div",Y,[s("div",Q,[t[3]||(t[3]=s("div",{class:"dummy"},null,-1)),(r(!0),l(k,null,B(p.value,a=>(r(),l("div",{key:a,class:"channel-name"},g(a),1))),128))]),s("div",ee,[(r(!0),l(k,null,B(d.value,(a,h)=>(r(),l("div",{key:h,class:"time-label"},g(a.getHours()===0||h===0?a.toLocaleString([],{month:"numeric",day:"numeric",weekday:"short",hour:"numeric"}):a.toLocaleTimeString([],{hour:"numeric"})),1))),128))]),s("div",te,[(r(!0),l(k,null,B(o.value,a=>{var h;return b((r(),R(n,{class:M(["program",["program",y(a)]]),key:a.id,title:a.title,style:z({gridColumn:p.value.indexOf((h=a.channel)==null?void 0:h.name)+1,gridRowStart:Math.floor((new Date(a.start_time).getTime()-new Date(d.value[0]).getTime())/(60*1e3))+1,gridRowEnd:`span ${Math.ceil(a.duration/60)}`}),to:a.recorded_video.status==="Recording"||!a.recorded_video.has_key_frames?{path:""}:`/videos/watch/${a.id}`},{default:q(()=>[s("div",ae,[s("div",se,g(new Date(a.start_time).getMinutes().toString().padStart(2,"0")),1),G(" "+g(a.title),1)]),s("div",ne,g(a.description),1)]),_:2},1032,["title","class","style","to"])),[[P]])}),128))])])])],2)])}}}),re=H(oe,[["__scopeId","data-v-f469f4ac"]]),ie={class:"route-container"},le={class:"pastepg-container-wrapper"},ue={class:"pastepg-container"},de=T({__name:"PastEPG",setup(V){const i=D(),v=E(),o=m([]),c=m(0),p=m(!0),d=m(1),y=async()=>{o.value=[];for(let t=(d.value-1)*3+1;t<=d.value*3;t++){const u=await U.fetchVideos("desc",t);u&&(o.value=[...o.value,...u.recorded_programs],c.value=u.total)}o.value=o.value.reverse(),p.value=!1},e=async t=>{d.value=t,p.value=!0,await v.replace({query:{...i.query,page:t.toString()}})};return f(()=>i.query,async t=>{t.page&&(d.value=parseInt(t.page)),await y()},{deep:!0}),F(async()=>{i.query.page&&(d.value=parseInt(i.query.page)),await y()}),(t,u)=>(r(),l("div",ie,[_(C),s("main",null,[_(N),s("div",le,[s("div",ue,[_($,{crumbs:[{name:"ホーム",path:"/"},{name:"過去番組表",path:"/pastepg/",disabled:!0}]}),_(re,{title:"過去番組表",programs:o.value,total:c.value,page:d.value,isLoading:p.value,showBackButton:!0,showEmptyMessage:!p.value,"onUpdate:page":e},null,8,["programs","total","page","isLoading","showEmptyMessage"])])])])]))}}),we=H(de,[["__scopeId","data-v-faaa1920"]]);export{we as default};
