import{g as Y,p as ee,k as te,l as ne,n as ae,e as U,m as se,q as ie,s as re,t as oe,j as z,V as le,a as Z,R as A,_ as J,u as ce}from"./top-CIIa_EmQ.js";import{B as ue}from"./Breadcrumbs-BCW2xBdJ.js";import{H as de,N as me}from"./Navigation-A1Ay89fy.js";import{V as S,ak as P,ah as H,M as K,N as V,p as c,ax as D,D as F,I as Q,a4 as h,a5 as T,aw as o,a3 as q,a1 as G,ay as M,ac as b,Z as j,a7 as L,F as C,a8 as E,ad as O,_ as p}from"./SnackbarsStore-DAN45liE.js";import{V as ve}from"./Videos-Cypipphm.js";import"./logo-CFs7zq1h.js";import"./ssrBoot-s1A44MpN.js";import"./VersionStore-CjPLQxzu.js";const ge=ee({color:String,direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},side:{type:String,default:"end",validator:e=>["start","end","both"].includes(e)},mode:{type:String,default:"intersect",validator:e=>["intersect","manual"].includes(e)},margin:[Number,String],loadMoreText:{type:String,default:"$vuetify.infiniteScroll.loadMore"},emptyText:{type:String,default:"$vuetify.infiniteScroll.empty"},...ie(),...se()},"VInfiniteScroll"),W=re({name:"VInfiniteScrollIntersect",props:{side:{type:String,required:!0},rootMargin:String},emits:{intersect:(e,l)=>!0},setup(e,l){let{emit:u}=l;const{intersectionRef:m,isIntersecting:s}=oe();return V(s,async f=>{u("intersect",e.side,f)}),U(()=>c("div",{class:"v-infinite-scroll-intersect",style:{"--v-infinite-margin-size":e.rootMargin},ref:m},[D(" ")])),{}}}),pe=Y()({name:"VInfiniteScroll",props:ge(),emits:{load:e=>!0},setup(e,l){let{slots:u,emit:m}=l;const s=S(),f=P("ok"),y=P("ok"),v=H(()=>te(e.margin)),w=P(!1);function t(a){if(!s.value)return;const d=e.direction==="vertical"?"scrollTop":"scrollLeft";s.value[d]=a}function r(){if(!s.value)return 0;const a=e.direction==="vertical"?"scrollTop":"scrollLeft";return s.value[a]}function _(){if(!s.value)return 0;const a=e.direction==="vertical"?"scrollHeight":"scrollWidth";return s.value[a]}function i(){if(!s.value)return 0;const a=e.direction==="vertical"?"clientHeight":"clientWidth";return s.value[a]}K(()=>{s.value&&(e.side==="start"?t(_()):e.side==="both"&&t(_()/2-i()/2))});function n(a,d){a==="start"?f.value=d:a==="end"&&(y.value=d)}function I(a){return a==="start"?f.value:y.value}let $=0;function R(a,d){w.value=d,w.value&&B(a)}function B(a){if(e.mode!=="manual"&&!w.value)return;const d=I(a);if(!s.value||["empty","loading"].includes(d))return;$=_(),n(a,"loading");function k(g){n(a,g),F(()=>{g==="empty"||g==="error"||(g==="ok"&&a==="start"&&t(_()-$+r()),e.mode!=="manual"&&F(()=>{window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{B(a)})})})}))})}m("load",{side:a,done:k})}const{t:N}=ne();function x(a,d){if(e.side!==a&&e.side!=="both")return;const k=()=>B(a),g={side:a,props:{onClick:k,color:e.color}};return d==="error"?u.error?.(g):d==="empty"?u.empty?.(g)??c("div",null,[N(e.emptyText)]):e.mode==="manual"?d==="loading"?u.loading?.(g)??c(z,{indeterminate:!0,color:e.color},null):u["load-more"]?.(g)??c(le,{variant:"outlined",color:e.color,onClick:k},{default:()=>[N(e.loadMoreText)]}):u.loading?.(g)??c(z,{indeterminate:!0,color:e.color},null)}const{dimensionStyles:X}=ae(e);U(()=>{const a=e.tag,d=e.side==="start"||e.side==="both",k=e.side==="end"||e.side==="both",g=e.mode==="intersect";return c(a,{ref:s,class:["v-infinite-scroll",`v-infinite-scroll--${e.direction}`,{"v-infinite-scroll--start":d,"v-infinite-scroll--end":k}],style:X.value},{default:()=>[c("div",{class:"v-infinite-scroll__side"},[x("start",f.value)]),d&&g&&c(W,{key:"start",side:"start",onIntersect:R,rootMargin:v.value},null),u.default?.(),k&&g&&c(W,{key:"end",side:"end",onIntersect:R,rootMargin:v.value},null),c("div",{class:"v-infinite-scroll__side"},[x("end",y.value)])]})})}}),fe={class:"past-epg-viewer"},_e={key:0,class:"past-epg-viewer__header"},he={class:"past-epg-viewer__title"},ye={class:"past-epg-viewer__title-text"},we={class:"past-epg-viewer__empty-content"},Se=["innerHTML"],ke=["innerHTML"],Me={class:"past-epg-viewer__grid-content"},Ie={id:"channels"},Te={id:"times"},Ve={class:"program-title"},Be={class:"program-start-time"},Pe={class:"program-description"},be=Q({__name:"PastEPGViewer",props:{title:{},programs:{},total:{},updatePage:{},page:{default:1},hideHeader:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:warning-20-regular"},emptyMessage:{default:"録画番組が見つかりませんでした。"},emptySubMessage:{default:'サーバー設定で録画フォルダのパスを<br class="d-sm-none">正しく設定できているか確認してください。'},isLoading:{type:Boolean,default:!1}},setup(e){Z();const l=e,u=S(l.page),m=S([...l.programs]),s=S(l.total);V(()=>l.page,t=>{u.value=t}),V(()=>l.programs,t=>{m.value=[...t]}),V(()=>l.total,t=>{s.value=t});const f=H(()=>[...new Set(m.value.toSorted((t,r)=>t.channel&&r.channel?t.channel.display_channel_id.localeCompare(r.channel.display_channel_id):0).map(t=>t.channel?.name))]),y=H(()=>{if(m.value.length===0)return[];const t=m.value.map(i=>new Date(i.start_time)).reduce((i,n)=>i<n?i:n),r=m.value.map(i=>new Date(i.end_time)).reduce((i,n)=>i>n?i:n),_=[];for(let i=new Date(t.setMinutes(0,0,0));i<=r;i.setHours(i.getHours()+1))_.push(new Date(i));return _}),v=t=>{switch(t.genres[0]?.major){case"スポーツ":return"genre_sports";case"ドラマ":return"genre_drama";case"音楽":return"genre_music";case"映画":return"genre_movie";case"アニメ・特撮":return"genre_anime";default:return"genre_none"}},w=async({done:t})=>{if(u.value>=Math.ceil(s.value/90)){t("empty");return}await l.updatePage(u.value+1),t("ok")};return(t,r)=>{const _=G("Icon"),i=G("router-link");return p(),h("div",fe,[t.hideHeader?T("",!0):(p(),h("div",_e,[o("h2",he,[t.showBackButton?q((p(),h("div",{key:0,class:"past-epg-viewer__title-back",onClick:r[0]||(r[0]=n=>t.$router.back())},[c(_,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[A]]):T("",!0),o("span",ye,M(t.title),1)])])),o("div",{class:b(["past-epg-viewer__grid",{"past-epg-viewer__grid--loading":t.isLoading,"past-epg-viewer__grid--empty":s.value===0&&t.showEmptyMessage}])},[o("div",{class:b(["past-epg-viewer__empty",{"past-epg-viewer__empty--show":s.value===0&&t.showEmptyMessage}])},[o("div",we,[c(_,{class:"past-epg-viewer__empty-icon",icon:t.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),o("h2",{innerHTML:t.emptyMessage},null,8,Se),t.emptySubMessage?(p(),h("div",{key:0,class:"past-epg-viewer__empty-submessage",innerHTML:t.emptySubMessage},null,8,ke)):T("",!0)])],2),o("div",Me,[t.isLoading?T("",!0):(p(),j(pe,{key:0,id:"epg-container",side:"start",onLoad:w},{empty:L(()=>r[1]||(r[1]=[D("すべて読み込みました")])),default:L(()=>[o("div",Ie,[r[2]||(r[2]=o("div",{class:"dummy"},null,-1)),(p(!0),h(C,null,E(f.value,n=>(p(),h("div",{key:n,class:"channel-name"},M(n),1))),128))]),o("div",Te,[(p(!0),h(C,null,E(y.value,(n,I)=>(p(),h("div",{key:I,class:"time-label"},M(n.getHours()===0||I===0?n.toLocaleString([],{month:"numeric",day:"numeric",weekday:"short",hour:"numeric"}):n.toLocaleTimeString([],{hour:"numeric"})),1))),128))]),o("div",{id:"schedule",style:O({"--minute-sum":60*y.value.length})},[(p(!0),h(C,null,E(m.value,n=>q((p(),j(i,{class:b(["program",["program",v(n)]]),key:n.id,title:n.title,style:O({gridColumn:f.value.indexOf(n.channel?.name)+1,gridRowStart:Math.floor((new Date(n.start_time).getTime()-new Date(y.value[0]).getTime())/(60*1e3))+1,gridRowEnd:`span ${Math.ceil(n.duration/60)}`}),to:n.recorded_video.status==="Recording"||!n.recorded_video.has_key_frames?{path:""}:`/videos/watch/${n.id}`},{default:L(()=>[o("div",Ve,[o("div",Be,M(new Date(n.start_time).getMinutes().toString().padStart(2,"0")),1),D(" "+M(n.title),1)]),o("div",Pe,M(n.description),1)]),_:2},1032,["title","class","style","to"])),[[A]])),128))],4)]),_:1}))])],2)])}}}),Le=J(be,[["__scopeId","data-v-75c39cfa"]]),Ce={class:"route-container"},Ee={class:"pastepg-container-wrapper"},He={class:"pastepg-container"},De=Q({__name:"PastEPG",setup(e){ce(),Z();const l=S([]),u=S(0),m=S(!0),s=S(1),f=async()=>{let v=[];const w=s.value;for(let t=(w-1)*3+1;t<=w*3;t++){const r=await ve.fetchVideos("desc",t);r&&(v=[...v,...r.recorded_programs],u.value=r.total)}v=v.reverse(),l.value=[...v,...l.value],m.value=!1},y=async v=>{s.value=v,await f()};return K(async()=>{await f()}),(v,w)=>(p(),h("div",Ce,[c(de),o("main",null,[c(me),o("div",Ee,[o("div",He,[c(ue,{crumbs:[{name:"ホーム",path:"/"},{name:"過去番組表",path:"/pastepg/",disabled:!0}]}),c(Le,{title:"過去番組表",programs:l.value,total:u.value,page:s.value,isLoading:m.value,showBackButton:!0,showEmptyMessage:!m.value,updatePage:y},null,8,["programs","total","page","isLoading","showEmptyMessage"])])])])]))}}),Ge=J(De,[["__scopeId","data-v-ad38e667"]]);export{Ge as default};
