import{aD as b}from"./SnackbarsStore-BWrzfOQC.js";import{m as h}from"./mpegts-DuuhU9Ut.js";const p=document.getElementById("wrap"),f=document.getElementById("chlist"),y=document.getElementById("control"),c=document.getElementById("volumebutton"),v=document.getElementById("keepshowsw"),d=document.getElementById("fsbutton"),_=()=>{let e=0,r=0;const n=()=>{clearTimeout(e),clearTimeout(r),p.classList.remove("hide-ui"),p.classList.remove("hide-info"),e=setTimeout(()=>{p.classList.add("hide-ui"),!v.checked&&(r=setTimeout(()=>{p.classList.add("hide-info")},3e3))},3e3)};window.addEventListener("pointerdown",n),window.addEventListener("pointermove",n),window.addEventListener("scroll",n),v.addEventListener("change",n),window.addEventListener("keydown",s=>{switch(s.key){case"V":case"v":c.click();break;case"D":case"d":v.click();break;case"F":case"f":d.click();break;case"ArrowUp":case"ArrowLeft":g(-1);break;case"ArrowRight":case"ArrowDown":g(1);break}n()}),c.addEventListener("click",()=>g("toggle-all")),window.addEventListener("scroll",()=>{function s(){const a=window.document.body,l=window.document.documentElement,t=a.scrollTop||l.scrollTop;return l.scrollHeight-window.innerHeight-t}s()<=10?y.classList.add("slide"):y.classList.remove("slide")}),n()},L=async()=>{E=await fetch(`${b.getApiBaseUrl()}/channels`).then(e=>(e.status!==200&&console.log("error or no content",e.status),e.json())).catch(e=>(console.error("Failed to load",e),null))},T=()=>E?.GR,w=()=>T().filter(e=>e.is_display===!0);let E;await L();const m=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),g=e=>{const r=o.filter(t=>!t.video.muted),n=r.length===0,s=r.length===o.length,a=Array(o.length).fill(!0);if(e==="all")a.fill(!1);else if(e==="toggle-all")s||a.fill(!1);else if(typeof e=="number")if(n)a[0]=!1;else{let u=(r[0].index+e+o.length)%o.length;a[u]=!1}else if(typeof e=="object"){const t=e;(s||t.video.muted)&&(a[t.index]=!1)}o.forEach((t,i)=>{t.video.muted=a[i]}),o.filter(t=>!t.video.muted).length===1?f.classList.add("choiced"):f.classList.remove("choiced")},o=[];w().forEach((e,r)=>{const n=`<div class="chframe">
        <video playsinline controlsList="noremoteplayback" autoplay muted></video>
        <div class="broadcast-wrap">
            <div class="broadcast-channel-box">
                <span class="broadcast-channel">${e.remocon_id}</span>
                <img class="broadcast-logo" src="${b.getApiBaseUrl()}/channels/${e.id}/logo" alt="${e.name}">
            </div>
            <div class="broadcast-title">
                <span class="broadcast-title-id">${e.program_present?.title??"(情報なし)"}</span>
                <div class="broadcast-time">
                    <span class="broadcast-start">${e.program_present?m(e.program_present.start_time):"--:--"}</span>
                    <span class="broadcast-to">～</span>
                    <span class="broadcast-end">${e.program_present?m(e.program_present.end_time):"--:--"}</span>
                </div>
            </div>
        </div>
        <div class="control">
            <button type="button" class="reload btn" title="再読み込み"><i class="material-icons">refresh</i></button>
        </div>
    </div>
    `;f.insertAdjacentHTML("beforeend",n);const s=f.lastElementChild,a={chFrame:s,index:r,video:s.querySelector("video"),reloadButton:s.querySelector(".reload"),broadcastTitle:s.querySelector(".broadcast-title"),title:s.querySelector(".broadcast-title-id"),startTime:s.querySelector(".broadcast-start"),endTime:s.querySelector(".broadcast-end")};if(o.push(a),s.addEventListener("click",()=>g(a)),a.video.addEventListener("volumechange",l=>{l.target.muted?s.classList.remove("listening"):s.classList.add("listening");const t=o.some(u=>!u.video.muted),i=o.every(u=>!u.video.muted);t?(c.innerHTML='<i class="material-icons">volume_up</i>',i?c.title="ミュートする(V)":c.title="全ch聴く(V)"):(c.innerHTML='<i class="material-icons">volume_off</i>',c.title="全ch聴く(V)")}),h.getFeatureList().mseLivePlayback){const l=`${b.getApiBaseUrl()}/streams/live/${e.display_channel_id}/360p/mpegts`,t=h.createPlayer({type:"mse",isLive:!0,url:l});t.attachMediaElement(a.video),a.reloadButton.addEventListener("click",i=>{if(i.stopPropagation(),t.unload(),i.shiftKey){alert("Shiftキーを押しながらクリックしたため、読み込み停止をしました。");return}t.load(),t.play()}),t.load()}});_();setInterval(async()=>{await L(),w().forEach((e,r)=>{const n=o[r],s={title:n.title,startTime:n.startTime,endTime:n.endTime},a=Object.values(s).map(i=>i.textContent),l=[e.program_present?.title??"(情報なし)",e.program_present?m(e.program_present.start_time):"--:--",e.program_present?m(e.program_present.end_time):"--:--"];if(a.toString()!==l.toString()){const i=`<span class="broadcast-title-id">${e.program_present?.title??"(情報なし)"}</span>
                <div class="broadcast-time">
                    <span class="broadcast-start">${e.program_present?m(e.program_present.start_time):"--:--"}</span>
                    <span class="broadcast-to">～</span>
                    <span class="broadcast-end">${e.program_present?m(e.program_present.end_time):"--:--"}</span>
                </div>
            </div>`;n.broadcastTitle.innerHTML=i}})},30*1e3);d.addEventListener("click",()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen().catch(e=>{alert("ご利用のブラウザは全画面表示に対応していません"+e.name)})});const k=()=>{document.fullscreenElement?(screen.orientation.lock("landscape").catch(()=>{}),d.innerHTML='<i class="material-icons">fullscreen_exit</i>',d.title="全画面表示を終了(F)"):(screen.orientation.unlock&&screen.orientation.unlock(),d.innerHTML='<i class="material-icons">fullscreen</i>',d.title="全画面表示(F)")};document.addEventListener("fullscreenchange",k);
