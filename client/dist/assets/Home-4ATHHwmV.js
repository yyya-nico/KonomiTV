import{x as z,P as A,ac as q,d as R,am as W,Y as h,T as a,$ as r,F as E,_ as p,U as k,a2 as C,k as u,at as e,a8 as b,Q as V,R as L,az as I,aJ as O,aH as $,aI as K,aB as Z,Z as J,a7 as M,a3 as H,a1 as U,au as g,av as v,aK as Q}from"./SnackbarsStore-DxiM_ro_.js";import{S as X,a as Y}from"./swiper-J-5quNN2.js";import{H as G,N as ee}from"./Navigation-C-HHrto5.js";import{u as te,a as se,v as ne,R as f,_ as j,b as ae,V as ie,w as T}from"./top-9dEQeN3N.js";import{_ as oe}from"./logo-CioTUuQQ.js";import{V as N}from"./ssrBoot-B4nD-5Wo.js";import{C as re,u as le}from"./ChannelsStore-BJKXa_sT.js";import"./VersionStore-DPzwN7Gd.js";const ue=t=>(V("data-v-5c476abc"),t=t(),L(),t),ce=ue(()=>e("img",{class:"konomitv-logo__image",src:oe,height:"21"},null,-1)),de={key:1,class:"search-box"},_e=["placeholder"],he=z({__name:"SPHeaderBar",setup(t){const n=te(),i=se(),c=A(!1),m=A(""),D=A(null),F=q(()=>i.path.startsWith("/videos")||i.path.startsWith("/mylist")||i.path.startsWith("/viewing-history")?"録画番組を検索...":"放送予定の番組を検索..."),x=()=>i.path.startsWith("/videos")||i.path.startsWith("/mylist")||i.path.startsWith("/viewing-history")?"/videos/search":"/tv/search",P=()=>{c.value=!0,setTimeout(()=>{var d;(d=D.value)==null||d.focus()},0)},y=()=>{c.value=!1,m.value=""},S=d=>{if(d.key==="Enter"&&!d.isComposing){if(m.value.trim()){const w=x();n.push(`${w}?query=${encodeURIComponent(m.value.trim())}`)}}else d.key==="Escape"&&y()},B=()=>{i.path.endsWith("/search")&&i.query.query&&(m.value=decodeURIComponent(i.query.query),c.value=!0)};return R(()=>{B()}),W(()=>i.fullPath,B),(d,w)=>{const o=h("router-link"),_=h("Icon");return a(),r("header",{class:b(["header",{"search-active":c.value}])},[c.value?(a(),r("div",de,[p(e("input",{ref_key:"search_input",ref:D,type:"text",placeholder:F.value,"onUpdate:modelValue":w[0]||(w[0]=s=>m.value=s),onKeydown:S},null,40,_e),[[ne,m.value]]),p((a(),r("div",{class:"search-box__close",onClick:y},[u(_,{icon:"fluent:dismiss-20-filled",height:"24px"})])),[[f]])])):(a(),r(E,{key:0},[p((a(),k(o,{class:"konomitv-logo",to:"/tv/"},{default:C(()=>[ce]),_:1})),[[f]]),u(N),p((a(),r("div",{class:"search-button",onClick:P},[u(_,{icon:"fluent:search-20-filled",height:"24px"})])),[[f]])],64))],2)}}}),pe=j(he,[["__scopeId","data-v-5c476abc"]]),ge=z({name:"TV-Home",components:{SPHeaderBar:pe,HeaderBar:G,Navigation:ee,Swiper:X,SwiperSlide:Y},data(){return{Utils:Object.freeze(I),ChannelUtils:Object.freeze(re),ProgramUtils:Object.freeze(O),Message:Object.freeze($),active_tab_index:0,swiper_instance:null,scroll_abort_controller:new AbortController,is_loading:!0,interval_ids:[]}},computed:{...K(le,Z)},watch:{active_tab_index(){var t,n;(t=this.swiper_instance)==null||t.updateAutoHeight(),(n=this.swiper_instance)==null||n.slideTo(this.active_tab_index,this.is_loading===!0?0:void 0)}},async mounted(){var n,i;this.settingsStore.settings.pinned_channel_ids.length===0&&(this.active_tab_index=1);const t=60-new Date().getSeconds();this.interval_ids.push(window.setTimeout(()=>{this.channelsStore.update(!0),this.interval_ids.push(window.setInterval(()=>this.channelsStore.update(!0),30*1e3))},t*1e3)),await this.channelsStore.update(),((n=this.channelsStore.channels_list_with_pinned.get("ピン留め"))==null?void 0:n.length)===0&&(this.active_tab_index=1),(i=this.swiper_instance)==null||i.updateAutoHeight(),window.addEventListener("scroll",()=>{var c;(c=this.swiper_instance)==null||c.updateAutoHeight()},{passive:!0,signal:this.scroll_abort_controller.signal}),await I.sleep(.01),this.is_loading=!1},beforeUnmount(){for(const t of this.interval_ids)window.clearInterval(t);this.scroll_abort_controller.abort(),this.scroll_abort_controller=new AbortController},methods:{addPinnedChannel(t){this.settingsStore.settings.pinned_channel_ids=[...this.settingsStore.settings.pinned_channel_ids,t.id],$.show(`${t.name}をピン留めしました。`)},removePinnedChannel(t){var n;this.settingsStore.settings.pinned_channel_ids=this.settingsStore.settings.pinned_channel_ids.filter(i=>i!==t.id),((n=this.channelsStore.channels_list_with_pinned.get("ピン留め"))==null?void 0:n.length)===0&&(this.active_tab_index=1),$.show(`${t.name}のピン留めを外しました。`)},isPinnedChannel(t){return this.settingsStore.settings.pinned_channel_ids.includes(t.id)}}}),l=t=>(V("data-v-4f35d945"),t=t(),L(),t),me={class:"route-container"},ve={class:"channels-tab"},fe=l(()=>e("div",{class:"channels-tab__highlight"},null,-1)),we={class:"channel__broadcaster"},Ce=["src"],be={class:"channel__broadcaster-content"},ye={class:"channel__broadcaster-name"},Se={class:"channel__broadcaster-status"},Be=l(()=>e("svg",{class:"iconify iconify--fa-solid",width:"10.5px",height:"12px",viewBox:"0 0 448 512"},[e("path",{fill:"currentColor",d:"M323.56 51.2c-20.8 19.3-39.58 39.59-56.22 59.97C240.08 73.62 206.28 35.53 168 0C69.74 91.17 0 209.96 0 281.6C0 408.85 100.29 512 224 512s224-103.15 224-230.4c0-53.27-51.98-163.14-124.44-230.4zm-19.47 340.65C282.43 407.01 255.72 416 226.86 416C154.71 416 96 368.26 96 290.75c0-38.61 24.31-72.63 72.79-130.75c6.93 7.98 98.83 125.34 98.83 125.34l58.63-66.88c4.14 6.85 7.91 13.55 11.27 19.97c27.35 52.19 15.81 118.97-33.43 153.42z"})],-1)),Ee=l(()=>e("span",{class:"ml-1"},"勢い:",-1)),ke={class:"ml-1"},De=l(()=>e("span",{style:{"margin-left":"3px"}}," コメ/分",-1)),Fe={class:"channel__broadcaster-status-viewers ml-4"},xe=l(()=>e("svg",{class:"iconify iconify--fa-solid",width:"15.75px",height:"14px",viewBox:"0 0 576 512"},[e("path",{fill:"currentColor",d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144a143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79a47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"})],-1)),Pe=l(()=>e("span",{class:"ml-1"},"視聴数:",-1)),Ae={class:"ml-1"},$e=["onClick"],He=l(()=>e("svg",{class:"iconify iconify--fluent",width:"24px",height:"24px",viewBox:"0 0 20 20"},[e("path",{fill:"currentColor",d:"M13.325 2.617a2 2 0 0 0-3.203.52l-1.73 3.459a1.5 1.5 0 0 1-.784.721l-3.59 1.436a1 1 0 0 0-.335 1.636L6.293 13L3 16.292V17h.707L7 13.706l2.61 2.61a1 1 0 0 0 1.636-.335l1.436-3.59a1.5 1.5 0 0 1 .722-.784l3.458-1.73a2 2 0 0 0 .52-3.203l-4.057-4.057Z"})],-1)),Ue=[He],Ie={class:"channel__program-present"},Me={class:"channel__program-present-title-wrapper"},Te=["innerHTML"],ze={class:"channel__program-present-time"},Ve=["innerHTML"],Le={class:"channel__program-following"},je={class:"channel__program-following-title"},Ne=l(()=>e("span",{class:"channel__program-following-title-decorate"},"NEXT",-1)),qe=l(()=>e("svg",{class:"channel__program-following-title-icon iconify iconify--fluent",width:"16px",height:"16px",viewBox:"0 0 20 20"},[e("path",{fill:"currentColor",d:"M10.018 5.486a1 1 0 0 1 1.592-.806l5.88 4.311a1.25 1.25 0 0 1 0 2.017l-5.88 4.311a1 1 0 0 1-1.592-.806v-3.16L4.61 15.319a1 1 0 0 1-1.592-.806V5.486A1 1 0 0 1 4.61 4.68l5.408 3.966v-3.16Z"})],-1)),Re=["innerHTML"],We={class:"channel__program-following-time"},Oe={class:"channel__progressbar"},Ke={key:0,class:"channel custom-link d-flex justify-center align-center",draggable:"false",href:"/konomitv/wholech/"},Ze={key:1,class:"pinned-container d-flex justify-center align-center w-100"},Je={class:"d-flex justify-center align-center flex-column"},Qe=l(()=>e("h2",null,[g("ピン留めされているチャンネルが"),e("br"),g("ありません。")],-1)),Xe={class:"mt-4 text-text-darken-1"},Ye=l(()=>e("br",null,null,-1)),Ge=l(()=>e("div",{class:"mt-2 text-text-darken-1"},[g("チャンネルをピン留めすると、"),e("br"),g("このタブが最初に表示されます。")],-1)),et={key:0,class:"channels-list pinned-container d-flex justify-center align-center w-100",style:{"flex-grow":"1"}},tt=Q('<div class="d-flex justify-center align-center flex-column" data-v-4f35d945><h2 data-v-4f35d945>視聴可能なチャンネルが<br class="d-sm-none" data-v-4f35d945>ありません。</h2><div class="mt-4 text-text-darken-1" data-v-4f35d945>前回チャンネルスキャンしたときに<br class="d-sm-none" data-v-4f35d945>受信可能なチャンネルを見つけられませんでした。</div><div class="mt-1 text-text-darken-1" data-v-4f35d945>再度チャンネルスキャンを行ってください。</div></div>',1),st=[tt],nt={class:"floating-button__content"},at=l(()=>e("div",{class:"floating-button__text"},"番組表",-1));function it(t,n,i,c,m,D){const F=h("HeaderBar"),x=h("Navigation"),P=h("SPHeaderBar"),y=h("router-link"),S=h("Icon"),B=h("SwiperSlide"),d=h("Swiper"),w=J("ftooltip");return a(),r("div",me,[u(F),e("main",null,[u(x),e("div",{class:b(["channels-container channels-container--home",{"channels-container--loading":t.is_loading}])},[u(P),e("div",ve,[e("div",{class:"channels-tab__buttons",style:M({"--tab-length":Array.from(t.channelsStore.channels_list_with_pinned).length,"--active-tab-index":t.active_tab_index})},[(a(!0),r(E,null,H(Array.from(t.channelsStore.channels_list_with_pinned),([o],_)=>(a(),k(ie,{variant:"flat",class:"channels-tab__button",key:o,onClick:s=>t.active_tab_index=_},{default:C(()=>[g(v(o),1)]),_:2},1032,["onClick"]))),128)),fe],4)]),p(u(d,{class:"channels-list","space-between":32,"auto-height":!0,"touch-start-prevent-default":!1,observer:!0,"observe-parents":!0,onSwiper:n[1]||(n[1]=o=>t.swiper_instance=o),onSlideChange:n[2]||(n[2]=o=>t.active_tab_index=o.activeIndex)},{default:C(()=>[(a(!0),r(E,null,H(Array.from(t.channelsStore.channels_list_with_pinned),([o,_])=>(a(),k(B,{key:o},{default:C(()=>[e("div",{class:b(["channels",`channels--tab-${o} channels--length-${_.length}`])},[(a(!0),r(E,null,H(_,s=>p((a(),k(y,{class:"channel",draggable:"false",key:s.id,to:`/tv/watch/${s.display_channel_id}`},{default:C(()=>[e("div",we,[e("img",{class:"channel__broadcaster-icon",src:`${t.Utils.getApiBaseUrl()}/channels/${s.id}/logo`},null,8,Ce),e("div",be,[e("span",ye,"Ch: "+v(s.channel_number)+" "+v(s.name),1),e("div",Se,[e("div",{class:b(["channel__broadcaster-status-force",`channel__broadcaster-status-force--${t.ChannelUtils.getChannelForceType(s.jikkyo_force)}`])},[Be,Ee,e("span",ke,v(s.jikkyo_force??"--"),1),De],2),e("div",Fe,[xe,Pe,e("span",Ae,v(s.viewer_count),1)])])]),p((a(),r("div",{class:b(["channel__broadcaster-pin",{"channel__broadcaster-pin--pinned":t.isPinnedChannel(s)}]),onClick:T(ot=>t.isPinnedChannel(s)?t.removePinnedChannel(s):t.addPinnedChannel(s),["prevent","stop"]),onMousedown:n[0]||(n[0]=T(()=>{},["prevent","stop"]))},Ue,42,$e)),[[f],[w,t.isPinnedChannel(s)?"ピン留めを外す":"ピン留めする"]])]),e("div",Ie,[e("div",Me,[e("span",{class:"channel__program-present-title",innerHTML:t.ProgramUtils.decorateProgramInfo(s.program_present,"title")},null,8,Te),e("span",ze,v(t.ProgramUtils.getProgramTime(s.program_present)),1)]),e("span",{class:"channel__program-present-description",innerHTML:t.ProgramUtils.decorateProgramInfo(s.program_present,"description")},null,8,Ve)]),u(N),e("div",Le,[e("div",je,[Ne,qe,e("span",{class:"channel__program-following-title-text",innerHTML:t.ProgramUtils.decorateProgramInfo(s.program_following,"title")},null,8,Re)]),e("span",We,v(t.ProgramUtils.getProgramTime(s.program_following)),1)]),e("div",Oe,[e("div",{class:"channel__progressbar-progress",style:M(`width:${t.ProgramUtils.getProgramProgress(s.program_present)}%;`)},null,4)])]),_:2},1032,["to"])),[[f]])),128)),o==="地デジ"&&_.length!==0?p((a(),r("a",Ke,[g(" 全てのチャンネルを視聴 ")])),[[f]]):U("",!0),o==="ピン留め"&&_.length===0?(a(),r("div",Ze,[e("div",Je,[Qe,e("div",Xe,[g("各チャンネルの "),u(S,{style:{position:"relative",bottom:"-5px"},icon:"fluent:pin-20-filled",width:"22px"}),g(" アイコンから、よくみる"),Ye,g("チャンネルをこのタブにピン留めできます。")]),Ge])])):U("",!0)],2)]),_:2},1024))),128))]),_:1},512),[[ae,Array.from(t.channelsStore.channels_list_with_pinned).length>0]]),Array.from(t.channelsStore.channels_list_with_pinned).length===0?(a(),r("div",et,st)):U("",!0)],2)]),p((a(),r("div",{class:"floating-button",onClick:n[3]||(n[3]=o=>t.Message.warning("番組表は現在開発中です。"))},[e("div",nt,[u(S,{class:"floating-button__icon",icon:"fluent:calendar-20-regular",width:"26px"}),at])])),[[f]])])}const gt=j(ge,[["render",it],["__scopeId","data-v-4f35d945"]]);export{gt as default};
