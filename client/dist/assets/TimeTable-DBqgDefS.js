import{H as _a,N as ba,S as ka}from"./SPHeaderBar-Bmzq-aaB.js";import{u as Sa,R as Ta,a as Fe,I as Mt}from"./ReservationDetailDrawer-B5_v2CdJ.js";import{T as ye,a as wa}from"./TimeTableSettings-oJNHP8pX.js";import{d as Ie,G as c,U as ge,w as dt,j as zt,k as he,r as Ze,f as me,h as K,b as A,B as Xe,t as Te,o as $,_ as Oe,ac as Da,u as We,q as k,ad as Ye,N as U,s as _e,ae as xa,x as et,z as mt,c as X,e as de,P as Ee,n as Je,a as o,p as Vt,V as Q,a2 as Ce,F as pe,g as Be,aa as Pa,af as Bt,D as we,E as ke,O as Me,X as Ke,ag as ft,ah as tt,ai as Ca,aj as Le,T as He,ak as Qe,al as Ha,l as vt,Y as Ne,am as Ft,an as Gt,Q as fe,ao as jt,ap as Ma,aq as Va,ar as qt,as as Ba,at as Ia,au as Oa,av as Ra,aw as Aa,ax as $a,ay as Ea,I as Ya,az as Na,aA as Wa,aB as La,aC as Ua,aD as za,J as Fa,aE as Ga,aF as ja,aG as qa,M as ct}from"./top-BkmcGQoa.js";import{u as Xa,P as Ka}from"./ChannelsStore-Zt4yyXyS.js";import{c as Ge,d as It}from"./VSelect-CeJnqVAd.js";import{V as Qa,c as Ja}from"./ssrBoot-CnM8PyRy.js";import{M as Xt}from"./VAvatar-Dw6SnBvd.js";import{b as Za}from"./VTextField-DZ6j4zyt.js";import"./VSwitch-DW7J4p3j.js";import"./VChip-ClS500rk.js";import"./VSlider-CKDLHny8.js";import"./VDialog-Co7ZY523.js";import"./VCard-CieSn-Si.js";import"./_commonjsHelpers-CSPQI3rM.js";const el={class:"timetable-channel-header__logo-wrapper"},tl=["src","alt"],al={class:"timetable-channel-header__info"},ll={class:"timetable-channel-header__number"},nl={class:"timetable-channel-header__name"},il=Ie({__name:"TimeTableChannelHeader",props:{channel:{},width:{},height:{},resizeTrigger:{}},setup(e){const a=e,v=c(()=>Math.round(Math.min(46,Math.max(32,a.width*.27)))),u=c(()=>Math.round(v.value*(3/4))),t=c(()=>Math.min(14,Math.max(13,a.width*.06))),d=c(()=>(a.resizeTrigger,Math.min(13.5,Math.max(ge.isSmartphoneVertical()?10:12,a.width*.08)))),r=c(()=>`${a.channel.name} を視聴`);return(n,i)=>{const s=Ze("router-link"),h=zt("ftooltip");return dt(($(),he(s,{class:"timetable-channel-header",to:`/tv/watch/${e.channel.display_channel_id}`,style:me({width:`${e.width}px`,height:`${e.height}px`,"--timetable-channel-logo-width":`${v.value}px`,"--timetable-channel-logo-height":`${u.value}px`,"--timetable-channel-number-size":`${t.value}px`,"--timetable-channel-name-size":`${d.value}px`})},{default:K(()=>[A("div",el,[A("img",{class:"timetable-channel-header__logo",loading:"lazy",decoding:"async",src:`${Xe(ge).api_base_url}/channels/${e.channel.id}/logo`,alt:e.channel.name},null,8,tl)]),A("div",al,[A("span",ll,Te(e.channel.channel_number),1),A("span",nl,Te(e.channel.name),1)])]),_:1},8,["to","style"])),[[h,r.value,void 0,{bottom:!0}]])}}}),sl=Oe(il,[["__scopeId","data-v-6ab34174"]]),Kt=["ピン留め","地デジ","BS","CS","CATV","SKY","BS4K"],ol=new Map([["地デジ","GR"],["BS","BS"],["CS","CS"],["CATV","CATV"],["SKY","SKY"],["BS4K","BS4K"]]),Ue=Da("timetable",()=>{const e=We(),a=Xa(),v=k(null),u=k(T()),t=Ye([]),d=k(null),r=k(!1),n=k(!1),i=k(!1),s=k(0),h=k(null);function _(){const y=U(),R=T();if(u.value.isSame(R,"day")===!1)return!1;let p=y.hour();return p<4&&(p+=24),p>=17}function V(){const y=U(),R=T();if(u.value.isSame(R,"day")===!1)return null;const p=y.startOf("hour").subtract(1,"hour"),O=z();return p.isBefore(O)?O:p}function z(){return i.value?u.value.add(12,"hour"):u.value}function S(y){return y.subtract(1,"millisecond").subtract(4,"hour").startOf("day").add(4,"hour")}function T(){const y=U();let R=y.hour(4).minute(0).second(0).millisecond(0);return y.hour()<4&&(R=R.subtract(1,"day")),R}function x(y,R=!1){return R?y.add(36,"hour"):y.add(1,"day")}const m=c(()=>i.value?u.value.add(12,"hour"):u.value),B=c(()=>{const y=new Set;if(a.is_channels_list_initial_updated===!1)return y;for(const R of a.channels_list_with_pinned.keys()){if(R==="ピン留め"){const p=a.channels_list_with_pinned.get("ピン留め");if(p===void 0||p.length===0)continue}y.add(R)}return y});function N(){return v.value===null?F():B.value.has(v.value)?null:F()}function F(){if(B.value.has("ピン留め"))return"ピン留め";if(B.value.has("地デジ"))return"地デジ";for(const y of Kt)if(B.value.has(y))return y;return"地デジ"}async function G(y,R,p,O){i.value=_(),h.value=V();const E=y??z(),ue=R??x(E,i.value),le=p??v.value??"地デジ",ne=le==="ピン留め"?O??e.settings.pinned_channel_ids:void 0,ve=ol.get(le),ce=await Ka.fetchTimeTable(E,ue,ve,ne);return ce===null?!1:(t.value=ce.channels,d.value={earliest:U(ce.date_range.earliest),latest:U(ce.date_range.latest)},!0)}async function J(){r.value=!0,n.value=!1;try{if(await a.update(),u.value=T(),v.value=F(),await G()===!1){r.value=!1;return}n.value=!0}finally{r.value=!1}}async function L(y){r.value=!0;try{u.value=y,await G()}finally{r.value=!1}}async function Z(y){r.value=!0;try{v.value=y,await G()}finally{r.value=!1}}function b(){let R=U().hour();return R<4&&(R+=24),R>=17}async function I(){if(d.value===null)return;const y=T(),R=b();let p;if(i.value)p=u.value.subtract(1,"day");else if(R){const E=u.value.subtract(1,"day");E.isSame(y.add(1,"day"),"day")?p=y:p=E}else p=u.value.subtract(1,"day");const O=S(d.value.earliest);p.isBefore(O,"day")||await L(p)}async function j(){if(d.value===null)return;let y;i.value?y=u.value.add(2,"day"):y=u.value.add(1,"day");const R=S(d.value.latest);y.isAfter(R,"day")||await L(y)}async function ee(){const y=T();u.value.isSame(y,"day")===!1&&await L(y)}function oe(y){s.value=y}const ie=c(()=>{if(d.value===null)return!1;const y=T(),R=b();let p;if(i.value)p=u.value.subtract(1,"day");else if(R){const E=u.value.subtract(1,"day");E.isSame(y.add(1,"day"),"day")?p=y:p=E}else p=u.value.subtract(1,"day");const O=S(d.value.earliest);return p.isSameOrAfter(O,"day")}),te=c(()=>{if(d.value===null)return!1;let y;i.value?y=u.value.add(2,"day"):y=u.value.add(1,"day");const R=S(d.value.latest);return y.isSameOrBefore(R,"day")});function q(){t.value=[],d.value=null,r.value=!1,n.value=!1,i.value=!1,s.value=0,h.value=null,v.value=null}return _e(()=>e.settings.pinned_channel_ids,async(y,R)=>{v.value==="ピン留め"&&n.value!==!1&&xa(y,R)===!1&&await G()},{deep:!0}),_e(()=>a.channels_list_with_pinned,async()=>{if(n.value===!1)return;const y=N();y!==null&&await Z(y)},{deep:!0}),{selected_channel_type:v,selected_date:u,channels_data:t,date_range:d,is_loading:r,is_initial_load_completed:n,is_36hour_display:i,date_display_offset:s,scroll_top_limit_time:h,available_channel_types:B,display_start_time:m,can_go_previous_day:ie,can_go_next_day:te,getBroadcastDate:S,getTodayStartTime:T,getDayEndTime:x,getDisplayStartTime:z,setDateDisplayOffset:oe,fetchTimeTableData:G,initialLoad:J,changeDate:L,changeChannelType:Z,goToPreviousDay:I,goToNextDay:j,goToCurrentTime:ee,reset:q}}),rl=Ie({__name:"TimeTableCurrentTimeLine",props:{hourHeight:{},totalWidth:{},channelHeaderHeight:{}},setup(e){const a=e,v=Ue(),u=k(U());let t=null,d=null;const r=c(()=>{const i=u.value,s=v.getDisplayStartTime(),h=v.getDayEndTime(s,v.is_36hour_display);return i.isSameOrAfter(s)&&i.isBefore(h)}),n=c(()=>{if(!r.value)return 0;const i=v.getDisplayStartTime();return ye.calculateCurrentTimeY(u.value,i,a.hourHeight,a.channelHeaderHeight)-a.channelHeaderHeight});return et(()=>{const i=U(),s=i.add(1,"minute").startOf("minute"),h=Math.max(0,s.valueOf()-i.valueOf());d=setTimeout(()=>{u.value=U(),t=setInterval(()=>{u.value=U()},60*1e3)},h)}),mt(()=>{d!==null&&clearTimeout(d),t!==null&&clearInterval(t)}),(i,s)=>r.value?($(),X("div",{key:0,class:"timetable-current-time-line",style:me({top:`${n.value}px`,width:`${e.totalWidth}px`})},[...s[0]||(s[0]=[A("div",{class:"timetable-current-time-line__indicator"},null,-1),A("div",{class:"timetable-current-time-line__line"},null,-1)])],4)):de("",!0)}}),ul=Oe(rl,[["__scopeId","data-v-8d4f4a9f"]]),cl={class:"timetable-program-cell__content"},dl={class:"timetable-program-cell__header"},vl={class:"timetable-program-cell__start-minute"},ml={key:0,class:"timetable-program-cell__reservation-icon"},fl={key:0,class:"timetable-program-cell__recording-icon"},hl=["innerHTML"],gl=["innerHTML"],pl={key:0,class:"timetable-program-cell__actions"},yl="fluent:timer-16-filled",_l="mdi:timer-pause-outline",bl=Ie({__name:"TimeTableProgramCell",props:{program:{},channel:{},hourHeight:{},channelWidth:{},fullChannelWidth:{},viewportHeight:{},channelHeaderHeight:{},isScrollAtBottom:{type:Boolean},isSubchannel:{type:Boolean},isSplit:{type:Boolean},isSelected:{type:Boolean},isPast:{type:Boolean},is36HourDisplay:{type:Boolean},isNextReserved:{type:Boolean},resizeTrigger:{}},emits:["click","show-detail","quick-reserve"],setup(e,{emit:a}){const v=new Map;function u(p,O){const E=p.title,ue=p.description;if(E===null||ue===null)return Ee.decorateProgramInfo(p,O);const le=v.get(p.id);if(le===void 0||le.raw_title!==E||le.raw_description!==ue){const ve=Ee.decorateProgramInfo(p,"title"),ce=Ee.decorateProgramInfo(p,"description");v.set(p.id,{raw_title:E,raw_description:ue,title:ve,description:ce})}const ne=v.get(p.id);return ne===void 0?Ee.decorateProgramInfo(p,O):O==="title"?ne.title:ne.description}const t=e,d=a,r=We(),n=Ue(),i=k(!1),s=k(null),h=k(0),_=c(()=>(t.resizeTrigger,ge.isTouchDevice()?t.isSelected:t.isSelected||r.settings.timetable_hover_expand&&i.value)),V=c(()=>t.program.reservation!==null),z=c(()=>t.program.reservation?.status==="Recording"),S=c(()=>t.program.reservation?.status==="Disabled"),T=c(()=>t.program.reservation?.recording_availability==="Partial"),x=c(()=>t.program.reservation?.recording_availability==="Unavailable"),m=c(()=>r.settings.timetable_dim_shopping_programs===!1?!1:Ee.isShoppingProgram(t.program)),B=c(()=>x.value?"rgb(var(--v-theme-error))":T.value?"rgb(var(--v-theme-warning))":S.value?"rgb(var(--v-theme-text-darken-2))":"rgb(var(--v-theme-secondary))"),N=c(()=>S.value?_l:yl),F=c(()=>V.value?S.value?"mdi:timer-play-outline":"mdi:timer-pause-outline":"mdi:timer-plus-outline"),G=c(()=>{if(t.resizeTrigger,!V.value)return"録画予約";const p=r.settings.timetable_channel_width==="Narrow",O=r.settings.timetable_channel_width!=="Wide",E=ge.isSmartphoneVertical()&&O||(ge.isSmartphoneHorizontal()||ge.isTabletVertical())&&p;return S.value?E?"有効化":"予約を有効化":E?"無効化":"予約を無効化"}),J=c(()=>U(t.program.start_time).minute().toString().padStart(2,"0")),L=c(()=>{const p=t.program.genres?.[0]?.major;return ye.getGenreColors(p,r.settings.timetable_genre_colors).highlight}),Z=c(()=>{if(x.value)return"#f8d7da";if(T.value)return"#fff3cd";const p=t.program.genres?.[0]?.major;return ye.getGenreColors(p,r.settings.timetable_genre_colors).background}),b=c(()=>{const p=U(t.program.start_time),O=n.getDisplayStartTime();return ye.calculateProgramY(p,O,t.hourHeight,t.channelHeaderHeight)-t.channelHeaderHeight}),I=c(()=>(t.is36HourDisplay?36:24)*t.hourHeight),j=c(()=>{const p=ye.calculateProgramHeight(t.program.duration,t.hourHeight);return b.value+p>I.value?Math.max(0,I.value-b.value):Math.max(p,20)}),ee=c(()=>{const p=t.fullChannelWidth??t.channelWidth,O=t.isSplit===!0&&t.channelWidth<p,E=_.value&&h.value>0?h.value:j.value,ue=t.isSubchannel&&O?t.channelWidth:0,le=_.value&&O?0:ue,ne=_.value&&O?p:t.channelWidth,ve={top:`${b.value}px`,left:`${le}px`,width:`${ne}px`,minHeight:`${j.value}px`,"--timetable-cell-height":`${E}px`,"--timetable-program-base-background":Z.value,"--timetable-program-base-highlight":L.value};if(_.value||(ve.height=`${j.value}px`),_.value&&t.viewportHeight>0&&t.isScrollAtBottom===!0){const ce=h.value>0?h.value:j.value,Se=Math.max(0,I.value-t.viewportHeight),ae=Se+t.viewportHeight,H=b.value+ce,g=b.value+j.value>=I.value-1;if(H>ae&&g){const w=H-ae,se=Math.max(0,b.value-Se),P=Math.min(w,se);P>0&&(ve.transform=`translateY(-${P}px)`)}}return ve}),oe=c(()=>u(t.program,"title")),ie=c(()=>u(t.program,"description"));function te(){d("click")}function q(){i.value=!0}function y(){i.value=!1}function R(){d("quick-reserve")}return _e(_,async p=>{if(p===!1){h.value=0;return}await Ce(),s.value!==null&&(h.value=Math.max(s.value.getBoundingClientRect().height,j.value))}),(p,O)=>{const E=Ze("Icon");return $(),X("div",{class:Je(["timetable-program-cell",{"timetable-program-cell--selected":e.isSelected,"timetable-program-cell--expanded":_.value,"timetable-program-cell--past":e.isPast,"timetable-program-cell--subchannel":e.isSubchannel,"timetable-program-cell--reserved":V.value,"timetable-program-cell--recording":z.value,"timetable-program-cell--partial":T.value,"timetable-program-cell--unavailable":x.value,"timetable-program-cell--disabled":S.value,"timetable-program-cell--shopping":m.value,"timetable-program-cell--next-reserved":V.value&&e.isNextReserved}]),ref_key:"cellRef",ref:s,style:me(ee.value),onClick:te,onMouseenter:q,onMouseleave:y},[O[2]||(O[2]=A("div",{class:"timetable-program-cell__highlight"},null,-1)),A("div",cl,[A("div",dl,[A("span",vl,Te(J.value),1),V.value?($(),X("div",ml,[o(E,{icon:N.value,width:"14px",style:me({color:B.value})},null,8,["icon","style"]),z.value?($(),X("div",fl)):de("",!0),T.value?($(),he(E,{key:1,icon:"fluent:warning-16-filled",width:"12px",class:"timetable-program-cell__warning-icon"})):de("",!0),x.value?($(),he(E,{key:2,icon:"fluent:dismiss-circle-16-filled",width:"12px",class:"timetable-program-cell__error-icon"})):de("",!0)])):de("",!0)]),A("div",{class:"timetable-program-cell__title",innerHTML:oe.value},null,8,hl),A("div",{class:"timetable-program-cell__description",innerHTML:ie.value},null,8,gl),_.value?($(),X("div",pl,[o(Q,{variant:"flat",size:"small",class:"timetable-program-cell__action-button",onClick:O[0]||(O[0]=Vt(ue=>p.$emit("show-detail"),["stop"]))},{default:K(()=>[o(E,{icon:"fluent:info-12-regular",width:"16px"}),O[1]||(O[1]=A("span",null,"番組詳細",-1))]),_:1}),e.isPast?de("",!0):($(),he(Q,{key:0,variant:"flat",size:"small",class:Je(["timetable-program-cell__action-button",{"timetable-program-cell__action-button--reserved":V.value&&!S.value,"timetable-program-cell__action-button--disabled-reservation":S.value}]),onClick:Vt(R,["stop"])},{default:K(()=>[o(E,{icon:F.value,width:"16px"},null,8,["icon"]),A("span",null,Te(G.value),1)]),_:1},8,["class"]))])):de("",!0)])],38)}}}),Ot=Oe(bl,[["__scopeId","data-v-8603e6bf"]]),kl={class:"timetable-time-scale"},Sl=["data-hour"],Tl={class:"timetable-time-scale__label"},wl={key:0,class:"timetable-time-scale__date"},Dl={class:"timetable-time-scale__hour-number"},xl=Ie({__name:"TimeTableTimeScale",props:{hourHeight:{},is36HourDisplay:{type:Boolean}},setup(e){const a=e,v=We(),u=Ue(),t=c(()=>{const i=a.is36HourDisplay?36:24,s=u.display_start_time,h=[];for(let _=0;_<i;_++)h.push(s.add(_,"hour"));return h});function d(i){const s=i.hour();return v.settings.use_28hour_clock&&s>=0&&s<=3?(s+24).toString().padStart(2,"0"):s.toString().padStart(2,"0")}function r(i){const s=i.hour(),h=u.display_start_time;return!([0,4,8,12,16,20].includes(s)===!1||a.is36HourDisplay&&s===4&&h.hour()===4)}function n(i){return`${i.month()+1}/${i.date()}`}return(i,s)=>($(),X("div",kl,[($(!0),X(pe,null,Be(t.value,h=>($(),X("div",{class:"timetable-time-scale__hour",key:h.valueOf(),style:me({height:`${a.hourHeight}px`}),"data-hour":h.hour()},[A("div",Tl,[r(h)?($(),X("span",wl,Te(n(h)),1)):de("",!0),A("span",Dl,Te(d(h)),1),s[0]||(s[0]=A("span",{class:"timetable-time-scale__hour-label"},"時",-1))])],12,Sl))),128))]))}}),Pl=Oe(xl,[["__scopeId","data-v-fe795608"]]),Cl={class:"timetable-grid__channel-headers"},Hl={class:"timetable-grid__content"},Ml=2,Vl=3,Bl=.5,Il=60,Ol=2,Rl=500,Al=120,Rt=.95,je=.5,qe=5,$l=100,El=Ie({__name:"TimeTableGrid",props:{channels:{},is36HourDisplay:{type:Boolean},canGoPreviousDay:{type:Boolean},canGoNextDay:{type:Boolean}},emits:["time-slot-change","date-display-offset-change","show-program-detail","quick-reserve","go-to-next-day","go-to-previous-day"],setup(e,{expose:a,emit:v}){const u=e,t=v,d=We(),r=Ue(),n=k(null),i=k(null),s=k(!1),h=k(!1);let _=0;const V=k(0),z=k(!1),S=k(0),T=k(0),x=k(0),m=k(0),B=k(null);let N=null,F=null;const G=k(0),J=new Set;let L=null,Z=null,b=null;const I=k(0),j=k(0),ee=k(!1),oe=k(!1),ie=k(!1),te=k(null),q=k(0),y=k(0),R=k(0),p=k(0),O=k(!1),E=k(!1),ue=k(0),le=k(0),ne=k(0),ve=k(0),ce=k(0),Se=k(0),ae=k(null),H=c(()=>(I.value,ye.getDeviceType())),g=c(()=>ye.getChannelWidth(d.settings.timetable_channel_width,H.value)),w=c(()=>ye.getHourHeight(d.settings.timetable_hour_height,H.value)),se=c(()=>H.value==="Smartphone"?Vl:Ml),P=c(()=>ye.getChannelHeaderHeight(g.value)),De=c(()=>(I.value,ye.getTimeScaleWidth(H.value,ge.isSmartphoneVertical()))),xe=c(()=>u.channels.length*g.value),Re=c(()=>(u.is36HourDisplay?36:24)*w.value);function at(l){return l.subchannels===null||l.subchannels.length===0?!1:l.subchannels.some(f=>f.programs.length>0)}const lt=new Map,Ae=new Map;function nt(l){if(l==null)return{start:0,end:0};const f=lt.get(l.id);if(f!==void 0)return f;const C={start:U(l.start_time).valueOf(),end:U(l.end_time).valueOf()};return lt.set(l.id,C),C}function ht(l,f){const C=nt(l);return f.some(D=>{const W=nt(D);return W.start<C.end&&W.end>C.start})}function it(l,f,C){const D=`${f.id}:${C?"sub":"main"}`,W=Ae.get(D);if(W!==void 0)return W;const M=yt(l);if(M.length===0)return Ae.set(D,!1),!1;if(C){const re=ht(f,l.programs);return Ae.set(D,re),re}const Y=ht(f,M);return Ae.set(D,Y),Y}function gt(l,f,C){return it(l,f,C)?g.value/2:g.value}function Ve(l){const f=w.value*se.value;S.value=Math.max(0,l-f),T.value=l+V.value+f}function la(l){const C=w.value*se.value*Bl,D=l+V.value;return V.value<=0||T.value===0||l<S.value+C||D>T.value-C?(Ve(l),!0):!1}function pt(l){const f=nt(l),C=(f.start-G.value)/(1e3*60*60)*w.value;return(f.end-G.value)/(1e3*60*60)*w.value>=S.value&&C<=T.value}function na(l){return l.subchannels===null?[]:l.subchannels}function yt(l){return l.subchannels===null?[]:l.subchannels.flatMap(f=>f.programs)}function _t(l){return U(l.end_time).isBefore(U())}function bt(l,f,C){const D=C?yt(l):l.programs,W=U(f.end_time).valueOf(),M=D.find(Y=>U(Y.start_time).valueOf()===W);return M!==void 0&&M.reservation!==null}function kt(){if(n.value===null)return;x.value;const l=m.value;_=l;const f=n.value.clientHeight-P.value;V.value!==f&&(V.value=f);const C=n.value.scrollHeight-n.value.clientHeight,D=l>=C-1;z.value!==D&&(z.value=D),la(l)&&$e();const M=l>C-100&&u.canGoNextDay,Y=l<100&&u.canGoPreviousDay;s.value!==M&&(s.value=M),h.value!==Y&&(h.value=Y);const re=r.getDisplayStartTime(),be=Math.floor(l/w.value);let ot=re.add(be,"hour").hour();ot<4&&(ot+=24);const ga=Math.floor((ot-4)/4)*4+4,rt=Math.max(4,Math.min(24,ga));if(N!==rt&&(t("time-slot-change",rt),N=rt),u.is36HourDisplay){const pa=d.settings.use_28hour_clock?4:0;let ze=re.hour(pa).minute(0).second(0).millisecond(0);ze.isSameOrBefore(re)&&(ze=ze.add(1,"day"));const ya=(ze.valueOf()-re.valueOf())/(1e3*60*60)*w.value,ut=l>=ya?1:0;F!==ut&&(t("date-display-offset-change",ut),F=ut)}else F!==0&&(t("date-display-offset-change",0),F=0);St()}function ia(){B.value===null&&(B.value=requestAnimationFrame(()=>{B.value=null,kt()}))}function $e(){b===null&&(b=requestAnimationFrame(()=>{b=null,Tt()}))}function St(){Z===null&&(Z=requestAnimationFrame(()=>{Z=null,sa()}))}function Tt(){n.value!==null&&(L!==null&&(L.disconnect(),J.clear()),L=new IntersectionObserver(l=>{for(const f of l){const C=f.target,D=f.rootBounds;if(D===null)continue;const W=f.intersectionRect.top<=D.top,M=f.intersectionRect.height<f.boundingClientRect.height,Y=D.height<f.boundingClientRect.height;if(f.isIntersecting&&W&&(M||Y))J.add(C),C.classList.add("timetable-program-cell--fixed");else{J.delete(C),C.classList.remove("timetable-program-cell--fixed");const be=C.querySelector(".timetable-program-cell__content");be!==null&&(be.style.paddingTop="")}}St()},{root:n.value,rootMargin:`-${P.value}px 0px 0px 0px`,threshold:[0,1]}),n.value.querySelectorAll(".timetable-program-cell").forEach(l=>{L?.observe(l)}))}function sa(){if(n.value===null||J.size===0)return;const l=n.value.getBoundingClientRect().top+P.value;J.forEach(f=>{const C=f.querySelector(".timetable-program-cell__content");if(C===null)return;const D=f.getBoundingClientRect().top,W=l-D;if(W<=0){C.style.paddingTop="";return}const M=f.style.getPropertyValue("--timetable-cell-height"),Y=M?Number.parseFloat(M):f.getBoundingClientRect().height,re=Math.max(0,Y-Il),be=f.classList.contains("timetable-program-cell--reserved")?3:0,Ht=Math.min(W,re);C.style.paddingTop=`${Ol+Math.max(Ht-be,0)}px`})}let Pe=null;function wt(){Pe!==null&&clearTimeout(Pe),Pe=window.setTimeout(()=>{I.value++,Pe=null},$l)}function Dt(){j.value=performance.now()}function oa(){n.value!==null&&(x.value=n.value.scrollLeft,m.value=n.value.scrollTop,ia())}function xt(l){n.value!==null&&(ae.value!==null&&(cancelAnimationFrame(ae.value),ae.value=null),l.deltaX!==0&&(l.preventDefault(),n.value.scrollLeft+=l.deltaX),l.shiftKey&&l.deltaY!==0?(l.preventDefault(),n.value.scrollLeft+=l.deltaY):l.deltaY!==0&&l.deltaX===0&&(l.preventDefault(),n.value.scrollTop+=l.deltaY))}function ra(l){if(l.pointerType==="mouse"===!1)return;const C=l.sourceCapabilities?.firesTouchEvents===!0,W=performance.now()-j.value<=Rl;if(C||W||n.value===null)return;const M=l.target;M.closest(".v-btn")||M.closest("a")||(oe.value=!0,ee.value=!1,O.value=!1,q.value=l.clientX,y.value=l.clientY,R.value=n.value.scrollLeft,p.value=n.value.scrollTop,ae.value!==null&&(cancelAnimationFrame(ae.value),ae.value=null),le.value=0,ne.value=0,ve.value=performance.now(),ce.value=l.clientX,Se.value=l.clientY)}function ua(l){if(l.pointerType!=="mouse"||oe.value===!1||n.value===null)return;const f=q.value-l.clientX,C=y.value-l.clientY;if((Math.abs(f)>qe||Math.abs(C)>qe)&&ee.value===!1&&n.value!==null&&(ee.value=!0,O.value=!0,n.value.setPointerCapture(l.pointerId),ie.value=!0,te.value=l.pointerId),ee.value===!1)return;l.preventDefault(),(Math.abs(f)>qe||Math.abs(C)>qe)&&(O.value=!0),n.value.scrollLeft=R.value+f,n.value.scrollTop=p.value+C;const D=performance.now(),W=D-ve.value;if(W>0){const M=l.clientX-ce.value,Y=l.clientY-Se.value;le.value=-M/W*16,ne.value=-Y/W*16}ve.value=D,ce.value=l.clientX,Se.value=l.clientY}function Pt(l){if(l.pointerType==="mouse"&&oe.value!==!1){if(oe.value=!1,ee.value=!1,n.value!==null&&ie.value&&te.value!==null)try{n.value.releasePointerCapture(te.value)}catch{}ie.value=!1,te.value=null,O.value?(da(),E.value=!0,ue.value=performance.now()):(E.value=!1,ue.value=0)}}function ca(l){if(E.value===!1)return;performance.now()-ue.value<=Al&&(l.preventDefault(),l.stopPropagation()),E.value=!1}function da(){if(n.value===null||Math.abs(le.value)<je&&Math.abs(ne.value)<je)return;const l=()=>{if(n.value!==null){if(le.value*=Rt,ne.value*=Rt,n.value.scrollLeft+=le.value,n.value.scrollTop+=ne.value,Math.abs(le.value)<je&&Math.abs(ne.value)<je){ae.value=null;return}ae.value=requestAnimationFrame(l)}};ae.value=requestAnimationFrame(l)}function Ct(l){i.value===l.id?i.value=null:i.value=l.id}function va(l){if(n.value===null)return;const C=r.getDisplayStartTime().hour();let W=(l===24?0:l)-C;W<0&&(W+=24);const M=W*w.value;n.value.scrollTo({top:M,behavior:"smooth"})}function ma(){const l=r.scroll_top_limit_time;if(l===null)return 0;const f=r.getDisplayStartTime(),D=(l.valueOf()-f.valueOf())/(1e3*60*60);return Math.max(0,D*w.value)}function st(l=!0,f=!1){if(n.value===null)return;const C=U(),D=r.getDisplayStartTime(),W=ma(),re=(C.subtract(30,"minute").valueOf()-D.valueOf())/(1e3*60*60),be=Math.max(W,re*w.value);if(f){n.value.scrollTo({top:be,behavior:l?"smooth":"instant"});return}if(W===0){n.value.scrollTo({top:0,behavior:"instant"});return}n.value.scrollTo({top:W,behavior:"instant"}),l&&setTimeout(()=>{n.value!==null&&n.value.scrollTo({top:be,behavior:"smooth"})},50)}function fa(){n.value!==null&&n.value.scrollTo({top:0,behavior:"instant"})}function ha(){if(n.value===null)return;const l=n.value.scrollHeight-n.value.clientHeight;n.value.scrollTo({top:l,behavior:"instant"})}return a({scrollToHour:va,scrollToCurrentTime:st,scrollToStart:fa,scrollToEnd:ha}),et(async()=>{window.addEventListener("resize",wt),n.value!==null&&n.value.addEventListener("wheel",xt,{passive:!1}),window.addEventListener("touchstart",Dt,{passive:!0}),await Ce(),n.value!==null&&(x.value=n.value.scrollLeft,m.value=n.value.scrollTop,kt(),Tt()),setTimeout(()=>{st(),Ve(_)},100)}),Pa(()=>{window.removeEventListener("resize",wt),window.removeEventListener("touchstart",Dt),Pe!==null&&(clearTimeout(Pe),Pe=null),n.value!==null&&n.value.removeEventListener("wheel",xt),B.value!==null&&cancelAnimationFrame(B.value),Z!==null&&cancelAnimationFrame(Z),b!==null&&cancelAnimationFrame(b),L!==null&&(L.disconnect(),L=null,J.clear()),ae.value!==null&&cancelAnimationFrame(ae.value)}),mt(()=>{ae.value!==null&&cancelAnimationFrame(ae.value)}),_e(()=>u.channels,async(l,f)=>{lt.clear(),Ae.clear(),Ve(_),$e(),f.length===0&&l.length>0&&(await Ce(),setTimeout(()=>{st(),$e()},100))},{deep:!1}),_e([w,V],()=>{Ve(_),$e()}),_e(P,()=>{$e()}),_e(()=>r.display_start_time,l=>{G.value=l.valueOf()},{immediate:!0}),(l,f)=>{const C=Ze("Icon");return $(),X("div",{class:"timetable-grid",style:me({"--timetable-channel-header-height":`${P.value}px`})},[A("div",{class:Je(["timetable-grid__scroll-area",{"timetable-grid__scroll-area--dragging":ee.value}]),ref_key:"scrollAreaRef",ref:n,onScroll:oa,onPointerdown:ra,onPointermove:ua,onPointerup:Pt,onPointercancel:Pt,onClickCapture:ca},[A("div",{class:"timetable-grid__layout",style:me({width:`${De.value+xe.value}px`,height:`${P.value+Re.value}px`})},[A("div",{class:"timetable-grid__header-row",style:me({height:`${P.value}px`})},[A("div",{class:"timetable-grid__corner",style:me({width:`${De.value}px`})},null,4),A("div",Cl,[($(!0),X(pe,null,Be(e.channels,D=>($(),he(sl,{key:D.channel.id,channel:D.channel,width:g.value,height:P.value,resizeTrigger:I.value},null,8,["channel","width","height","resizeTrigger"]))),128))])],4),A("div",{class:"timetable-grid__body-row",style:me({height:`${Re.value}px`})},[A("div",{class:"timetable-grid__time-scale",style:me({width:`${De.value}px`})},[o(Pl,{hourHeight:w.value,is36HourDisplay:u.is36HourDisplay},null,8,["hourHeight","is36HourDisplay"])],4),A("div",Hl,[($(!0),X(pe,null,Be(e.channels,(D,W)=>($(),X("div",{class:"timetable-grid__channel-column",key:D.channel.id,style:me({left:`${W*g.value}px`,width:`${g.value}px`,height:`${Re.value}px`})},[A("div",{class:"timetable-grid__channel-background",style:me({height:`${Re.value}px`})},null,4),($(!0),X(pe,null,Be(D.programs,M=>($(),X(pe,{key:M.id},[pt(M)?($(),he(Ot,{key:0,program:M,channel:D.channel,hourHeight:w.value,channelWidth:gt(D,M,!1),fullChannelWidth:g.value,isSplit:it(D,M,!1),viewportHeight:V.value,channelHeaderHeight:P.value,isScrollAtBottom:z.value,isSelected:i.value===M.id,isPast:_t(M),is36HourDisplay:u.is36HourDisplay,isNextReserved:bt(D,M,!1),resizeTrigger:I.value,onClick:Y=>Ct(M),onShowDetail:Y=>l.$emit("show-program-detail",M.id,D.channel,M),onQuickReserve:Y=>l.$emit("quick-reserve",M.id,D.channel,M)},null,8,["program","channel","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","isNextReserved","resizeTrigger","onClick","onShowDetail","onQuickReserve"])):de("",!0)],64))),128)),at(D)?($(!0),X(pe,{key:0},Be(na(D),M=>($(),X(pe,{key:M.channel.id},[($(!0),X(pe,null,Be(M.programs,Y=>($(),X(pe,{key:Y.id},[pt(Y)?($(),he(Ot,{key:0,program:Y,channel:M.channel,hourHeight:w.value,channelWidth:gt(D,Y,!0),fullChannelWidth:g.value,isSplit:it(D,Y,!0),viewportHeight:V.value,channelHeaderHeight:P.value,isScrollAtBottom:z.value,isSubchannel:!0,isSelected:i.value===Y.id,isPast:_t(Y),is36HourDisplay:u.is36HourDisplay,isNextReserved:bt(D,Y,!0),resizeTrigger:I.value,onClick:re=>Ct(Y),onShowDetail:re=>l.$emit("show-program-detail",Y.id,M.channel,Y),onQuickReserve:re=>l.$emit("quick-reserve",Y.id,M.channel,Y)},null,8,["program","channel","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","isNextReserved","resizeTrigger","onClick","onShowDetail","onQuickReserve"])):de("",!0)],64))),128))],64))),128)):de("",!0)],4))),128)),o(ul,{hourHeight:w.value,totalWidth:xe.value,channelHeaderHeight:P.value},null,8,["hourHeight","totalWidth","channelHeaderHeight"])])],4)],4)],34),o(Bt,{name:"fade"},{default:K(()=>[s.value?($(),he(Q,{key:0,class:"timetable-grid__next-day-button",variant:"elevated",color:"background-lighten-1",onClick:f[0]||(f[0]=D=>l.$emit("go-to-next-day"))},{default:K(()=>[o(C,{icon:"fluent:chevron-down-20-regular",width:"20px"}),f[2]||(f[2]=A("span",null,"次の日を見る",-1))]),_:1})):de("",!0)]),_:1}),o(Bt,{name:"fade"},{default:K(()=>[h.value?($(),he(Q,{key:0,class:"timetable-grid__prev-day-button",variant:"elevated",color:"background-lighten-1",onClick:f[1]||(f[1]=D=>l.$emit("go-to-previous-day"))},{default:K(()=>[o(C,{icon:"fluent:chevron-up-20-regular",width:"20px"}),f[3]||(f[3]=A("span",null,"前の日を見る",-1))]),_:1})):de("",!0)]),_:1})],4)}}}),Yl=Oe(El,[["__scopeId","data-v-4bfd07bf"]]),Qt=ke({active:{type:[String,Array],default:void 0},disabled:{type:[Boolean,String,Array],default:null},nextIcon:{type:Ke,default:"$next"},prevIcon:{type:Ke,default:"$prev"},modeIcon:{type:Ke,default:"$subgroup"},text:String,viewMode:{type:String,default:"month"}},"VDatePickerControls"),At=we()({name:"VDatePickerControls",props:Qt(),emits:{"click:year":()=>!0,"click:month":()=>!0,"click:prev":()=>!0,"click:next":()=>!0,"click:text":()=>!0},setup(e,a){let{emit:v}=a;const u=c(()=>Array.isArray(e.disabled)?e.disabled.includes("text"):!!e.disabled),t=c(()=>Array.isArray(e.disabled)?e.disabled.includes("mode"):!!e.disabled),d=c(()=>Array.isArray(e.disabled)?e.disabled.includes("prev"):!!e.disabled),r=c(()=>Array.isArray(e.disabled)?e.disabled.includes("next"):!!e.disabled);function n(){v("click:prev")}function i(){v("click:next")}function s(){v("click:year")}function h(){v("click:month")}return Me(()=>o("div",{class:["v-date-picker-controls"]},[o(Q,{class:"v-date-picker-controls__month-btn","data-testid":"month-btn",disabled:u.value,text:e.text,variant:"text",rounded:!0,onClick:h},null),o(Q,{class:"v-date-picker-controls__mode-btn","data-testid":"year-btn",disabled:t.value,density:"comfortable",icon:e.modeIcon,variant:"text",onClick:s},null),o(Qa,null,null),o("div",{class:"v-date-picker-controls__month"},[o(Q,{"data-testid":"prev-month",disabled:d.value,icon:e.prevIcon,variant:"text",onClick:n},null),o(Q,{"data-testid":"next-month",disabled:r.value,icon:e.nextIcon,variant:"text",onClick:i},null)])])),{}}}),Nl=ke({appendIcon:Ke,color:String,header:String,transition:String,onClick:Ca()},"VDatePickerHeader"),$t=we()({name:"VDatePickerHeader",props:Nl(),emits:{click:()=>!0,"click:append":()=>!0},setup(e,a){let{emit:v,slots:u}=a;const{backgroundColorClasses:t,backgroundColorStyles:d}=ft(e,"color");function r(){v("click")}function n(){v("click:append")}return Me(()=>{const i=!!(u.default||e.header),s=!!(u.append||e.appendIcon);return o("div",{class:["v-date-picker-header",{"v-date-picker-header--clickable":!!e.onClick},t.value],style:d.value,onClick:r},[u.prepend&&o("div",{key:"prepend",class:"v-date-picker-header__prepend"},[u.prepend()]),i&&o(Xt,{key:"content",name:e.transition},{default:()=>[o("div",{key:e.header,class:"v-date-picker-header__content"},[u.default?.()??e.header])]}),s&&o("div",{class:"v-date-picker-header__append"},[u.append?o(tt,{key:"append-defaults",disabled:!e.appendIcon,defaults:{VBtn:{icon:e.appendIcon,variant:"text"}}},{default:()=>[u.append?.()]}):o(Q,{key:"append-btn",icon:e.appendIcon,variant:"text",onClick:n},null)])])}),{}}}),Wl=ke({allowedDates:[Array,Function],disabled:{type:Boolean,default:null},displayValue:null,modelValue:Array,month:[Number,String],max:null,min:null,showAdjacentMonths:Boolean,year:[Number,String],weekdays:{type:Array,default:()=>[0,1,2,3,4,5,6]},weeksInMonth:{type:String,default:"dynamic"},firstDayOfWeek:[Number,String]},"calendar");function Ll(e){const a=Le(),v=He(e,"modelValue",[],S=>Qe(S).map(T=>a.date(T))),u=c(()=>e.displayValue?a.date(e.displayValue):v.value.length>0?a.date(v.value[0]):e.min?a.date(e.min):Array.isArray(e.allowedDates)?a.date(e.allowedDates[0]):a.date()),t=He(e,"year",void 0,S=>{const T=S!=null?Number(S):a.getYear(u.value);return a.startOfYear(a.setYear(a.date(),T))},S=>a.getYear(S)),d=He(e,"month",void 0,S=>{const T=S!=null?Number(S):a.getMonth(u.value),x=a.setYear(a.startOfMonth(a.date()),a.getYear(t.value));return a.setMonth(x,T)},S=>a.getMonth(S)),r=c(()=>e.firstDayOfWeek??e.weekdays[0]),n=c(()=>{const S=Number(e.firstDayOfWeek??0);return e.weekdays.map(T=>(T+S)%7)}),i=c(()=>{const S=a.getWeekArray(d.value,r.value),T=S.flat(),x=6*7;if(e.weeksInMonth==="static"&&T.length<x){const m=T[T.length-1];let B=[];for(let N=1;N<=x-T.length;N++)B.push(a.addDays(m,N)),N%7===0&&(S.push(B),B=[])}return S});function s(S,T){return S.filter(x=>n.value.includes(a.toJsDate(x).getDay())).map((x,m)=>{const B=a.toISO(x),N=!a.isSameMonth(x,d.value),F=a.isSameDay(x,a.startOfMonth(d.value)),G=a.isSameDay(x,a.endOfMonth(d.value)),J=a.isSameDay(x,d.value);return{date:x,isoDate:B,formatted:a.format(x,"keyboardDate"),year:a.getYear(x),month:a.getMonth(x),isDisabled:z(x),isWeekStart:m%7===0,isWeekEnd:m%7===6,isToday:a.isSameDay(x,T),isAdjacent:N,isHidden:N&&!e.showAdjacentMonths,isStart:F,isSelected:v.value.some(L=>a.isSameDay(x,L)),isEnd:G,isSame:J,localized:a.format(x,"dayOfMonth")}})}const h=c(()=>{const S=a.startOfWeek(u.value,e.firstDayOfWeek),T=[];for(let m=0;m<=6;m++)T.push(a.addDays(S,m));const x=a.date();return s(T,x)}),_=c(()=>{const S=i.value.flat(),T=a.date();return s(S,T)}),V=c(()=>i.value.map(S=>S.length?Ha(a,S[0]):null));function z(S){if(e.disabled)return!0;const T=a.date(S);return e.min&&a.isAfter(a.date(e.min),T)||e.max&&a.isAfter(T,a.date(e.max))?!0:Array.isArray(e.allowedDates)&&e.allowedDates.length>0?!e.allowedDates.some(x=>a.isSameDay(a.date(x),T)):typeof e.allowedDates=="function"?!e.allowedDates(T):!1}return{displayValue:u,daysInMonth:_,daysInWeek:h,genDays:s,model:v,weeksInMonth:i,weekDays:n,weekNumbers:V}}const Jt=ke({color:String,hideWeekdays:Boolean,multiple:[Boolean,Number,String],showWeek:Boolean,transition:{type:String,default:"picker-transition"},reverseTransition:{type:String,default:"picker-reverse-transition"},...Ne(Wl(),["displayValue"])},"VDatePickerMonth"),Et=we()({name:"VDatePickerMonth",props:Jt(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0},setup(e,a){let{emit:v,slots:u}=a;const t=k(),{daysInMonth:d,model:r,weekNumbers:n}=Ll(e),i=Le(),s=Ye(),h=Ye(),_=Ye(!1),V=c(()=>_.value?e.reverseTransition:e.transition);e.multiple==="range"&&r.value.length>0&&(s.value=r.value[0],r.value.length>1&&(h.value=r.value[r.value.length-1]));const z=c(()=>{const m=["number","string"].includes(typeof e.multiple)?Number(e.multiple):1/0;return r.value.length>=m});_e(d,(m,B)=>{B&&(_.value=i.isBefore(m[0].date,B[0].date))});function S(m){const B=i.startOfDay(m);if(r.value.length===0?s.value=void 0:r.value.length===1&&(s.value=r.value[0],h.value=void 0),!s.value)s.value=B,r.value=[s.value];else if(h.value)s.value=m,h.value=void 0,r.value=[s.value];else{if(i.isSameDay(B,s.value)){s.value=void 0,r.value=[];return}else i.isBefore(B,s.value)?(h.value=i.endOfDay(s.value),s.value=B):h.value=i.endOfDay(B);const N=i.getDiff(h.value,s.value,"days"),F=[s.value];for(let G=1;G<N;G++){const J=i.addDays(s.value,G);F.push(J)}F.push(h.value),r.value=F}}function T(m){const B=r.value.findIndex(N=>i.isSameDay(N,m));if(B===-1)r.value=[...r.value,m];else{const N=[...r.value];N.splice(B,1),r.value=N}}function x(m){e.multiple==="range"?S(m):e.multiple?T(m):r.value=[m]}return()=>o("div",{class:"v-date-picker-month"},[e.showWeek&&o("div",{key:"weeks",class:"v-date-picker-month__weeks"},[!e.hideWeekdays&&o("div",{key:"hide-week-days",class:"v-date-picker-month__day"},[vt(" ")]),n.value.map(m=>o("div",{class:["v-date-picker-month__day","v-date-picker-month__day--adjacent"]},[m]))]),o(Xt,{name:V.value},{default:()=>[o("div",{ref:t,key:d.value[0].date?.toString(),class:"v-date-picker-month__days"},[!e.hideWeekdays&&i.getWeekdays(e.firstDayOfWeek).map(m=>o("div",{class:["v-date-picker-month__day","v-date-picker-month__weekday"]},[m])),d.value.map((m,B)=>{const N={props:{onClick:()=>x(m.date)},item:m,i:B};return z.value&&!m.isSelected&&(m.isDisabled=!0),o("div",{class:["v-date-picker-month__day",{"v-date-picker-month__day--adjacent":m.isAdjacent,"v-date-picker-month__day--hide-adjacent":m.isHidden,"v-date-picker-month__day--selected":m.isSelected,"v-date-picker-month__day--week-end":m.isWeekEnd,"v-date-picker-month__day--week-start":m.isWeekStart}],"data-v-date":m.isDisabled?void 0:m.isoDate},[(e.showAdjacentMonths||!m.isAdjacent)&&o(tt,{defaults:{VBtn:{class:"v-date-picker-month__day-btn",color:(m.isSelected||m.isToday)&&!m.isDisabled?e.color:void 0,disabled:m.isDisabled,icon:!0,ripple:!1,text:m.localized,variant:m.isDisabled?m.isToday?"outlined":"text":m.isToday&&!m.isSelected?"outlined":"flat",onClick:()=>x(m.date)}}},{default:()=>[u.day?.(N)??o(Q,N.props,null)]})])})])]})])}}),Zt=ke({color:String,height:[String,Number],min:null,max:null,modelValue:Number,year:Number},"VDatePickerMonths"),Yt=we()({name:"VDatePickerMonths",props:Zt(),emits:{"update:modelValue":e=>!0},setup(e,a){let{emit:v,slots:u}=a;const t=Le(),d=He(e,"modelValue"),r=c(()=>{let n=t.startOfYear(t.date());return e.year&&(n=t.setYear(n,e.year)),Ft(12).map(i=>{const s=t.format(n,"monthShort"),h=!!(e.min&&t.isAfter(t.startOfMonth(t.date(e.min)),n)||e.max&&t.isAfter(n,t.startOfMonth(t.date(e.max))));return n=t.getNextMonth(n),{isDisabled:h,text:s,value:i}})});return Gt(()=>{d.value=d.value??t.getMonth(t.date())}),Me(()=>o("div",{class:"v-date-picker-months",style:{height:jt(e.height)}},[o("div",{class:"v-date-picker-months__content"},[r.value.map((n,i)=>{const s={active:d.value===i,color:d.value===i?e.color:void 0,disabled:n.isDisabled,rounded:!0,text:n.text,variant:d.value===n.value?"flat":"text",onClick:()=>h(i)};function h(_){if(d.value===_){v("update:modelValue",d.value);return}d.value=_}return u.month?.({month:n,i,props:s})??o(Q,fe({key:"month"},s),null)})])])),{}}}),ea=ke({color:String,height:[String,Number],min:null,max:null,modelValue:Number},"VDatePickerYears"),Nt=we()({name:"VDatePickerYears",props:ea(),emits:{"update:modelValue":e=>!0},setup(e,a){let{emit:v,slots:u}=a;const t=Le(),d=He(e,"modelValue"),r=c(()=>{const i=t.getYear(t.date());let s=i-100,h=i+52;e.min&&(s=t.getYear(t.date(e.min))),e.max&&(h=t.getYear(t.date(e.max)));let _=t.startOfYear(t.date());return _=t.setYear(_,s),Ft(h-s+1,s).map(V=>{const z=t.format(_,"year");return _=t.setYear(_,t.getYear(_)+1),{text:z,value:V}})});Gt(()=>{d.value=d.value??t.getYear(t.date())});const n=Ma();return et(async()=>{await Ce(),n.el?.scrollIntoView({block:"center"})}),Me(()=>o("div",{class:"v-date-picker-years",style:{height:jt(e.height)}},[o("div",{class:"v-date-picker-years__content"},[r.value.map((i,s)=>{const h={ref:d.value===i.value?n:void 0,active:d.value===i.value,color:d.value===i.value?e.color:void 0,rounded:!0,text:i.text,variant:d.value===i.value?"flat":"text",onClick:()=>{if(d.value===i.value){v("update:modelValue",d.value);return}d.value=i.value}};return u.year?.({year:i,i:s,props:h})??o(Q,fe({key:"month"},h),null)})])])),{}}}),Ul=Ja("v-picker-title"),ta=ke({color:String,...Ga(),...Fa(),...za(),...Ua(),...La(),...Wa(),...Na(),...Ya(),...Ea()},"VSheet"),Wt=we()({name:"VSheet",props:ta(),setup(e,a){let{slots:v}=a;const{themeClasses:u}=Va(e),{backgroundColorClasses:t,backgroundColorStyles:d}=ft(qt(e,"color")),{borderClasses:r}=Ba(e),{dimensionStyles:n}=Ia(e),{elevationClasses:i}=Oa(e),{locationStyles:s}=Ra(e),{positionClasses:h}=Aa(e),{roundedClasses:_}=$a(e);return Me(()=>o(e.tag,{class:["v-sheet",u.value,t.value,r.value,i.value,h.value,_.value,e.class],style:[d.value,n.value,s.value,e.style]},v)),{}}}),aa=ke({bgColor:String,landscape:Boolean,title:String,hideHeader:Boolean,...ta()},"VPicker"),Lt=we()({name:"VPicker",props:aa(),setup(e,a){let{slots:v}=a;const{backgroundColorClasses:u,backgroundColorStyles:t}=ft(qt(e,"color"));return Me(()=>{const d=Wt.filterProps(e),r=!!(e.title||v.title);return o(Wt,fe(d,{color:e.bgColor,class:["v-picker",{"v-picker--landscape":e.landscape,"v-picker--with-actions":!!v.actions},e.class],style:e.style}),{default:()=>[!e.hideHeader&&o("div",{key:"header",class:[u.value],style:[t.value]},[r&&o(Ul,{key:"picker-title"},{default:()=>[v.title?.()??e.title]}),v.header&&o("div",{class:"v-picker__header"},[v.header()])]),o("div",{class:"v-picker__body"},[v.default?.()]),v.actions&&o(tt,{defaults:{VBtn:{slim:!0,variant:"text"}}},{default:()=>[o("div",{class:"v-picker__actions"},[v.actions()])]})]})}),{}}}),zl=ke({header:{type:String,default:"$vuetify.datePicker.header"},...Qt(),...Jt({weeksInMonth:"static"}),...Ne(Zt(),["modelValue"]),...Ne(ea(),["modelValue"]),...aa({title:"$vuetify.datePicker.title"}),modelValue:null},"VDatePicker"),Ut=we()({name:"VDatePicker",props:zl(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0,"update:viewMode":e=>!0},setup(e,a){let{emit:v,slots:u}=a;const t=Le(),{t:d}=ja(),r=He(e,"modelValue",void 0,b=>Qe(b).map(I=>t.date(I)),b=>e.multiple?b:b[0]),n=He(e,"viewMode"),i=c(()=>{const b=t.date(e.min);return e.min&&t.isValid(b)?b:null}),s=c(()=>{const b=t.date(e.max);return e.max&&t.isValid(b)?b:null}),h=c(()=>{const b=t.date();let I=b;return r.value?.[0]?I=t.date(r.value[0]):i.value&&t.isBefore(b,i.value)?I=i.value:s.value&&t.isAfter(b,s.value)&&(I=s.value),I&&t.isValid(I)?I:b}),_=k(Number(e.month??t.getMonth(t.startOfMonth(h.value)))),V=k(Number(e.year??t.getYear(t.startOfYear(t.setMonth(h.value,_.value))))),z=Ye(!1),S=c(()=>e.multiple&&r.value.length>1?d("$vuetify.datePicker.itemsSelected",r.value.length):r.value[0]&&t.isValid(r.value[0])?t.format(t.date(r.value[0]),"normalDateWithWeekday"):d(e.header)),T=c(()=>{let b=t.date();return b=t.setDate(b,1),b=t.setMonth(b,_.value),b=t.setYear(b,V.value),t.format(b,"monthAndYear")}),x=c(()=>`date-picker-header${z.value?"-reverse":""}-transition`),m=c(()=>{if(e.disabled)return!0;const b=[];if(n.value!=="month")b.push("prev","next");else{let I=t.date();if(I=t.startOfMonth(I),I=t.setMonth(I,_.value),I=t.setYear(I,V.value),i.value){const j=t.addDays(t.startOfMonth(I),-1);t.isAfter(i.value,j)&&b.push("prev")}if(s.value){const j=t.addDays(t.endOfMonth(I),1);t.isAfter(j,s.value)&&b.push("next")}}return b});function B(){_.value<11?_.value++:(V.value++,_.value=0,Z(V.value)),L(_.value)}function N(){_.value>0?_.value--:(V.value--,_.value=11,Z(V.value)),L(_.value)}function F(){n.value="month"}function G(){n.value=n.value==="months"?"month":"months"}function J(){n.value=n.value==="year"?"month":"year"}function L(b){n.value==="months"&&G(),v("update:month",b)}function Z(b){n.value==="year"&&J(),v("update:year",b)}return _e(r,(b,I)=>{const j=Qe(I),ee=Qe(b);if(!ee.length)return;const oe=t.date(j[j.length-1]),ie=t.date(ee[ee.length-1]),te=t.getMonth(ie),q=t.getYear(ie);te!==_.value&&(_.value=te,L(_.value)),q!==V.value&&(V.value=q,Z(V.value)),z.value=t.isBefore(oe,ie)}),Me(()=>{const b=Lt.filterProps(e),I=At.filterProps(e),j=$t.filterProps(e),ee=Et.filterProps(e),oe=Ne(Yt.filterProps(e),["modelValue"]),ie=Ne(Nt.filterProps(e),["modelValue"]),te={header:S.value,transition:x.value};return o(Lt,fe(b,{class:["v-date-picker",`v-date-picker--${n.value}`,{"v-date-picker--show-week":e.showWeek},e.class],style:e.style}),{title:()=>u.title?.()??o("div",{class:"v-date-picker__title"},[d(e.title)]),header:()=>u.header?o(tt,{defaults:{VDatePickerHeader:{...te}}},{default:()=>[u.header?.(te)]}):o($t,fe({key:"header"},j,te,{onClick:n.value!=="month"?F:void 0}),{...u,default:void 0}),default:()=>o(pe,null,[o(At,fe(I,{disabled:m.value,text:T.value,"onClick:next":B,"onClick:prev":N,"onClick:month":G,"onClick:year":J}),null),o(Za,{hideOnLeave:!0},{default:()=>[n.value==="months"?o(Yt,fe({key:"date-picker-months"},oe,{modelValue:_.value,"onUpdate:modelValue":[q=>_.value=q,L],min:i.value,max:s.value,year:V.value}),null):n.value==="year"?o(Nt,fe({key:"date-picker-years"},ie,{modelValue:V.value,"onUpdate:modelValue":[q=>V.value=q,Z],min:i.value,max:s.value}),null):o(Et,fe({key:"date-picker-month"},ee,{modelValue:r.value,"onUpdate:modelValue":q=>r.value=q,month:_.value,"onUpdate:month":[q=>_.value=q,L],year:V.value,"onUpdate:year":[q=>V.value=q,Z],min:i.value,max:s.value}),null)]})]),actions:u.actions})}),{}}}),Fl={class:"route-container"},Gl={class:"timetable-controls"},jl={class:"timetable-controls__date"},ql={key:0,class:"timetable-controls-mobile"},Xl={class:"timetable-controls-mobile__inner"},Kl={class:"timetable-controls-mobile__date"},Ql=100,Jl=Ie({__name:"TimeTable",setup(e){We();const a=Ue(),v=k(null),u=Sa(),t=c(()=>u.server_settings),d=c(()=>t.value.general.backend==="EDCB"),r=k(!1),n=k(!1),i=k(0);let s=null;function h(){s!==null&&clearTimeout(s),s=window.setTimeout(()=>{i.value++,s=null},Ql)}const _=c(()=>(i.value,ge.isSmartphoneVertical()||ge.isSmartphoneHorizontal()||ge.isTabletVertical())),V=c(()=>(i.value,!ge.isSmartphoneVertical())),z=c(()=>a.date_display_offset),S=k(!1),T=k(null),x=k(null),m=k(null),B=k(!1),N=c(()=>{const H=[],g=a.available_channel_types;for(const w of Kt)g.has(w)&&H.push({title:w,value:w});return H}),F=c({get:()=>a.selected_channel_type,set:H=>{a.changeChannelType(H)}}),G=c(()=>{const H=[],g=a.is_36hour_display&&z.value===0;for(let w=4;w<=24;w+=4){const se=w,P=w<=12;H.push({title:`${se.toString().padStart(2,"0")}時`,value:w,...g&&P?{props:{disabled:!0}}:{}})}return H});function J(){let g=U().hour();return g<4&&(g+=24),Math.floor((g-4)/4)*4+4}const L=k(J()),Z=c(()=>{const H=a.selected_date.add(z.value,"day"),g=H.month()+1,w=H.date(),se=["日","月","火","水","木","金","土"][H.day()];return`${g}/${w} (${se})`}),b=c({get:()=>a.selected_date.toDate(),set:H=>{const g=U(H).hour(4).minute(0).second(0).millisecond(0);a.changeDate(g)}}),I=c(()=>a.can_go_previous_day),j=c(()=>a.can_go_next_day),ee=c(()=>a.date_range===null?void 0:a.getBroadcastDate(a.date_range.earliest).startOf("day").toDate()),oe=c(()=>a.date_range===null?void 0:a.getBroadcastDate(a.date_range.latest).endOf("day").toDate());function ie(H){if(a.date_range===null)return!1;const g=U(H),w=a.getBroadcastDate(a.date_range.earliest),se=a.getBroadcastDate(a.date_range.latest);return g.isSameOrAfter(w,"day")&&g.isSameOrBefore(se,"day")}function te(H){a.changeChannelType(H)}function q(H){n.value=!1;const g=U(H).hour(4).minute(0).second(0).millisecond(0);a.changeDate(g)}function y(H){H===null||v.value===null||v.value.scrollToHour(H)}async function R(){await a.goToPreviousDay(),await Ce(),v.value!==null&&v.value.scrollToEnd()}async function p(){await a.goToNextDay(),await Ce(),v.value!==null&&v.value.scrollToStart()}async function O(){await a.goToCurrentTime(),await Ce(),v.value!==null&&v.value.scrollToCurrentTime(!0,!0)}function E(H){const g=Math.floor((H-4)/4)*4+4,w=Math.max(4,Math.min(24,g));L.value=w}function ue(H){a.setDateDisplayOffset(H)}async function le(H,g,w){const se=U(w.end_time);if(B.value=se.isBefore(U()),w.reservation!==null){const P=await Fe.fetchReservation(w.reservation.id);P!==null?(T.value=P,x.value=null,m.value=null):(T.value=ne(w,g),x.value=null,m.value=null)}else T.value=ne(w,g),x.value=null,m.value=null;S.value=!0}function ne(H,g){return{id:-1,channel:g,program:H,is_recording_in_progress:!1,recording_availability:"Full",comment:"",scheduled_recording_file_name:"",estimated_recording_file_size:0,record_settings:structuredClone(Mt)}}async function ve(){await a.fetchTimeTableData()}async function ce(){await a.fetchTimeTableData()}async function Se(){await a.fetchTimeTableData()}async function ae(H,g,w){if(U(w.end_time).isBefore(U()))return;if(d.value===!1){ct.warning("録画予約機能は EDCB バックエンド選択時のみ利用できます。");return}if(w.reservation!==null){const De=await Fe.fetchReservation(w.reservation.id);if(De===null)return;const xe=structuredClone(De.record_settings);if(xe.is_enabled=!xe.is_enabled,await Fe.updateReservation(De.id,xe)!==null){const at=xe.is_enabled?`録画予約を有効にしました。
番組開始時刻になると自動的に録画が開始されます。`:`録画予約を無効にしました。
番組開始時刻までに再度予約を有効にしない限り、この番組は録画されません。`;ct.success(at),await a.fetchTimeTableData()}return}await Fe.addReservation(H,structuredClone(Mt))&&(ct.success("録画予約を追加しました。"),await a.fetchTimeTableData())}return et(async()=>{window.addEventListener("resize",h),await u.fetchServerSettingsOnce(),await a.initialLoad()}),mt(()=>{window.removeEventListener("resize",h),s!==null&&(clearTimeout(s),s=null),a.reset()}),_e(()=>a.selected_date,()=>{a.setDateDisplayOffset(0)}),(H,g)=>{const w=Ze("Icon"),se=zt("ftooltip");return $(),X("div",Fl,[o(_a,null,qa({_:2},[_.value?void 0:{name:"timetable-controls",fn:K(()=>[A("div",Gl,[o(Ge,{class:"timetable-controls__channel-type",variant:"outlined",density:"compact","hide-details":"",items:N.value,modelValue:F.value,"onUpdate:modelValue":[g[0]||(g[0]=P=>F.value=P),te]},null,8,["items","modelValue"]),A("div",jl,[o(Q,{variant:"flat",icon:"",size:"small",disabled:!I.value,onClick:R},{default:K(()=>[o(w,{icon:"fluent:chevron-left-20-regular",width:"20px"})]),_:1},8,["disabled"]),o(It,{modelValue:n.value,"onUpdate:modelValue":g[2]||(g[2]=P=>n.value=P),"close-on-content-click":!1},{activator:K(({props:P})=>[o(Q,fe({variant:"flat",class:"timetable-controls__date-button"},P),{default:K(()=>[vt(Te(Z.value),1)]),_:1},16)]),default:K(()=>[o(Ut,{modelValue:b.value,"onUpdate:modelValue":[g[1]||(g[1]=P=>b.value=P),q],color:"primary",min:ee.value,max:oe.value,"allowed-dates":ie},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"]),o(Q,{variant:"flat",icon:"",size:"small",disabled:!j.value,onClick:p},{default:K(()=>[o(w,{icon:"fluent:chevron-right-20-regular",width:"20px"})]),_:1},8,["disabled"])]),o(Ge,{class:"timetable-controls__time",variant:"outlined",density:"compact","hide-details":"",items:G.value,modelValue:L.value,"onUpdate:modelValue":[g[3]||(g[3]=P=>L.value=P),y]},null,8,["items","modelValue"]),dt(($(),he(Q,{variant:"flat",class:"timetable-controls__now-button",icon:"",onClick:O},{default:K(()=>[o(w,{icon:"fluent:clock-20-regular",width:"22px"})]),_:1})),[[se,"現在時刻に移動",void 0,{bottom:!0}]]),dt(($(),he(Q,{variant:"flat",class:"timetable-controls__settings-button",icon:"",onClick:g[4]||(g[4]=P=>r.value=!0)},{default:K(()=>[o(w,{icon:"fluent:settings-20-regular",width:"22px"})]),_:1})),[[se,"番組表の表示設定",void 0,{bottom:!0}]])])]),key:"0"}]),1024),A("main",null,[o(ba,{"icon-only":V.value},null,8,["icon-only"]),A("div",{class:Je(["timetable-container",{"timetable-container--loading":Xe(a).is_loading}])},[o(ka),_.value?($(),X("div",ql,[A("div",Xl,[o(Ge,{class:"timetable-controls-mobile__channel-type",variant:"outlined",density:"compact","hide-details":"",items:N.value,modelValue:F.value,"onUpdate:modelValue":[g[5]||(g[5]=P=>F.value=P),te]},null,8,["items","modelValue"]),A("div",Kl,[o(It,{modelValue:n.value,"onUpdate:modelValue":g[7]||(g[7]=P=>n.value=P),"close-on-content-click":!1},{activator:K(({props:P})=>[o(Q,fe({variant:"flat",class:"timetable-controls-mobile__date-button",size:"small"},P),{default:K(()=>[vt(Te(Z.value),1)]),_:1},16)]),default:K(()=>[o(Ut,{modelValue:b.value,"onUpdate:modelValue":[g[6]||(g[6]=P=>b.value=P),q],color:"primary",min:ee.value,max:oe.value,"allowed-dates":ie},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"])]),o(Ge,{class:"timetable-controls-mobile__time",variant:"outlined",density:"compact","hide-details":"",items:G.value,modelValue:L.value,"onUpdate:modelValue":[g[8]||(g[8]=P=>L.value=P),y]},null,8,["items","modelValue"]),o(Q,{variant:"flat",class:"timetable-controls-mobile__now-button",icon:"",size:"small",onClick:O},{default:K(()=>[o(w,{icon:"fluent:clock-20-regular",width:"18px"})]),_:1}),o(Q,{variant:"flat",class:"timetable-controls-mobile__settings-button",icon:"",size:"small",onClick:g[9]||(g[9]=P=>r.value=!0)},{default:K(()=>[o(w,{icon:"fluent:settings-20-regular",width:"18px"})]),_:1})])])):de("",!0),o(Yl,{ref_key:"timetableGridRef",ref:v,channels:Xe(a).channels_data,is36HourDisplay:Xe(a).is_36hour_display,canGoPreviousDay:I.value,canGoNextDay:j.value,onTimeSlotChange:E,onDateDisplayOffsetChange:ue,onShowProgramDetail:le,onQuickReserve:ae,onGoToNextDay:p,onGoToPreviousDay:R},null,8,["channels","is36HourDisplay","canGoPreviousDay","canGoNextDay"])],2)]),o(wa,{isOpen:r.value,"onUpdate:isOpen":g[10]||(g[10]=P=>r.value=P)},null,8,["isOpen"]),o(Ta,{modelValue:S.value,"onUpdate:modelValue":g[11]||(g[11]=P=>S.value=P),reservation:T.value,program:x.value,channel:m.value,isPastProgram:B.value,onAdded:ve,onUpdated:ce,onDeleted:Se},null,8,["modelValue","reservation","program","channel","isPastProgram"])])}}}),pn=Oe(Jl,[["__scopeId","data-v-b97ebe40"]]);export{pn as default};
