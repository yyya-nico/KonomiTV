import{B as L}from"./Breadcrumbs-DtcSQut2.js";import{H as V,N as H}from"./Navigation-CGc7K7Ss.js";import{S as $}from"./SPHeaderBar-X4olii2T.js";import{R as h}from"./RecordedProgramList-CHEUvxCm.js";import{V as v}from"./Videos-fhNRhef3.js";import{I as N,W as a,aF as k,N as S,M as A,aP as U,P as C,a5 as x,p as r,ay as l,a4 as F,ad as W,_ as O,a8 as T,a2 as P,$ as b}from"./SnackbarsStore-BWrzfOQC.js";import{R as j,_ as z}from"./top-7EynTrEK.js";import"./logo-Ba04xXMp.js";import"./ssrBoot-CvCvKyJs.js";import"./VersionStore-CY9AnbST.js";import"./VDialog-BTuyyxm5.js";import"./VChip-BlJr6k6u.js";import"./VTextField-Bm6rC6ci.js";import"./VAvatar-CobBwRxf.js";import"./VCard-7by9Y2XW.js";import"./VSelect-6xRYMkTj.js";import"./VPagination-zdFMwRc3.js";const D={class:"route-container"},q={class:"videos-home-container-wrapper"},G={class:"videos-home-container"},J={class:"floating-button__content"},K=30*1e3,Q=N({__name:"Home",setup(X){const u=a([]),_=a(0),m=a([]),d=a(0),p=a([]),g=a(0),o=a(!0),n=a(null),c=k();S(()=>c.settings.mylist,async()=>{await f()},{deep:!0}),S(()=>c.settings.watched_history,async()=>{await y()},{deep:!0});const R=async()=>{const e=await v.fetchVideos("desc",1);e&&(u.value=e.recorded_programs.slice(0,10),_.value=e.total)},f=async()=>{const e=c.settings.mylist.filter(s=>s.type==="RecordedProgram").sort((s,i)=>i.created_at-s.created_at).map(s=>s.id);if(e.length===0){m.value=[],d.value=0;return}const t=await v.fetchVideos("ids",1,e);t&&(m.value=t.recorded_programs.slice(0,4),d.value=t.total)},y=async()=>{const e=c.settings.watched_history.sort((s,i)=>i.updated_at-s.updated_at).map(s=>s.video_id);if(e.length===0){p.value=[],g.value=0;return}const t=await v.fetchVideos("ids",1,e);t&&(p.value=t.recorded_programs.slice(0,4),g.value=t.total)},B={recentPrograms:R,mylistPrograms:f,watchedPrograms:y},w=async()=>{try{await Promise.all(Object.values(B).map(e=>e())),o.value=!1}catch(e){console.error("Failed to update sections:",e),o.value=!1}},E=()=>{n.value===null&&(w(),n.value=window.setInterval(w,K))},I=()=>{n.value!==null&&(clearInterval(n.value),n.value=null)};return A(async()=>{await U().fetchUser(),E()}),C(()=>{I()}),(e,t)=>{const s=P("Icon"),i=P("router-link");return b(),x("div",D,[r(V),l("main",null,[r(H),l("div",q,[r($),l("div",G,[r(L,{crumbs:[{name:"ホーム",path:"/"},{name:"ビデオをみる",path:"/videos/",disabled:!0}]}),r(h,{class:W(["videos-home-container__recent-programs",{"videos-home-container__recent-programs--loading":u.value.length===0&&o.value}]),title:"新着の録画番組",programs:u.value,total:_.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,showSearch:!0,isLoading:o.value,showEmptyMessage:!o.value,onMore:t[0]||(t[0]=M=>e.$router.push("/videos/programs"))},null,8,["class","programs","total","isLoading","showEmptyMessage"]),r(h,{title:"マイリスト",programs:m.value,total:d.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,showEmptyMessage:!o.value,emptyIcon:"ic:round-playlist-play",emptyMessage:"あとで観たい番組を<br class='d-sm-none'>マイリストに保存できます。",emptySubMessage:"録画番組の右上にある ＋ ボタンから、<br class='d-sm-none'>番組をマイリストに追加できます。",isLoading:o.value,forMylist:!0,onMore:t[1]||(t[1]=M=>e.$router.push("/mylist/"))},null,8,["programs","total","showEmptyMessage","isLoading"]),r(h,{title:"視聴履歴",programs:p.value,total:g.value,hideSort:!0,hidePagination:!0,showMoreButton:!0,showEmptyMessage:!o.value,emptyIcon:"fluent:history-20-regular",emptyMessage:"まだ視聴履歴がありません。",emptySubMessage:"録画番組を30秒以上みると、<br class='d-sm-none'>視聴履歴に追加されます。",isLoading:o.value,forWatchedHistory:!0,onMore:t[2]||(t[2]=M=>e.$router.push("/watched-history/"))},null,8,["programs","total","showEmptyMessage","isLoading"]),F((b(),O(i,{class:"floating-button",to:"/pastepg/"},{default:T(()=>[l("div",J,[r(s,{class:"floating-button__icon",icon:"fluent:calendar-20-regular",width:"26px"}),t[3]||(t[3]=l("div",{class:"floating-button__text"},"過去番組表",-1))])]),_:1})),[[j]])])])])])}}}),he=z(Q,[["__scopeId","data-v-90b7153e"]]);export{he as default};
